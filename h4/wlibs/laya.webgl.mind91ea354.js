!function(t,e,i){{var _=(i.un,i.uns,i.static),r=i.class,a=i.getset,n=(i.__newvec,laya.maths.Bezier),s=laya.resource.Bitmap,o=laya.utils.Browser,h=(laya.display.css.CacheStyle,laya.filters.ColorFilter),u=laya.utils.ColorUtils,l=i.Config,c=laya.resource.Context,f=laya.display.cmd.DrawCanvasCmd,d=laya.display.cmd.DrawImageCmd,E=(laya.events.Event,laya.display.cmd.FillTextCmd),A=laya.filters.Filter,D=laya.utils.FontInfo,R=laya.display.Graphics,m=laya.resource.HTMLCanvas,T=(laya.utils.HTMLChar,laya.resource.HTMLImage),v=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),P=laya.display.Node,p=laya.maths.Point,C=laya.utils.Pool,M=laya.maths.Rectangle,O=laya.renders.Render,L=laya.renders.RenderSprite,y=laya.resource.Resource,S=(laya.resource.ResourceManager,laya.display.cmd.RestoreCmd),g=laya.display.cmd.RotateCmd,b=laya.utils.RunDriver,B=laya.display.cmd.SaveCmd,I=laya.display.cmd.ScaleCmd,x=laya.display.Sprite,N=(laya.display.SpriteConst,laya.display.css.SpriteStyle,laya.display.Stage),F=laya.utils.Stat,V=laya.utils.StringKey,w=laya.system.System,U=laya.display.Text,W=laya.resource.Texture,G=laya.display.cmd.TransformCmd,X=laya.display.cmd.TranslateCmd,k=laya.utils.VectorGraphManager;laya.utils.WordText}i.interface("laya.webgl.submit.ISubmit"),i.interface("laya.webgl.canvas.save.ISaveData");var z=function(){function t(){}r(t,"laya.webgl.canvas.save.SaveBase");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){this._dataObj[this._valueName]=this._value,t.POOL[t.POOL._length++]=this,this._newSubmit&&(e._curSubmit=ve.RENDERBASE)},t._createArray=function(){var t=[];return t._length=0,t},t._init=function(){var e=t._namemap={};return e[1]="ALPHA",e[2]="fillStyle",e[8]="font",e[256]="lineWidth",e[512]="strokeStyle",e[8192]="_mergeID",e[1024]=e[2048]=e[4096]=[],e[16384]="textBaseline",e[32768]="textAlign",e[65536]="_nBlendType",e[1048576]="shader",e[2097152]="filters",e[8388608]="_colorFiler",e},t.save=function(e,i,_,r){if((e._saveMark._saveuse&i)!==i){e._saveMark._saveuse|=i;var a=t.POOL,n=a._length>0?a[--a._length]:new t;n._value=_[n._valueName=t._namemap[i]],n._dataObj=_,n._newSubmit=r;var s=e._save;s[s._length++]=n}},t.POOL=laya.webgl.canvas.save.SaveBase._createArray(),t._namemap=t._init(),t}(),Y=function(){function t(e,i){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this.ref=1,this._cacheID=0,this.clipMatDir=[99999999,0,0,99999999],this.clipMatPos=[0,0],this.defines=new we,this.mainID=e,this.subID=i,this.textureHost=null,this.texture=null,this.color=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=e|i,this._inClassCache=t._cache[this._cacheID],e>0&&!this._inClassCache&&(this._inClassCache=t._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}r(t,"laya.webgl.shader.d2.value.Value2D");var e=t.prototype;return e.setValue=function(){},e._ShaderWithCompile=function(){var t=Ke.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,ti.create,this._attribLocation);return t},e.upload=function(){var t=Le;Le.worldMatrix4===Le.TEMPMAT4_ARRAY||this.defines.addInt(128),this.mmat=t.worldMatrix4;var e=Ke.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height?(this.size[0]=t.width,this.size[1]=t.height,e._shaderValueWidth=t.width,e._shaderValueHeight=t.height,e.upload(this,null)):e.upload(this,e._params2dQuick2||e._make2dQuick2())},e.setFilters=function(t){if(this.filters=t,t)for(var e,i=t.length,_=0;i>_;_++)e=t[_],e&&(this.defines.add(e.type),e.action.setValue(this))},e.clear=function(){this.defines._value=this.subID+(Se.shaderHighPrecision?1024:0)},e.release=function(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1)},t._initone=function(e,i){t._typeClass[e]=i,t._cache[e]=[],t._cache[e]._length=0},t.__init__=function(){t._initone(4,xe),t._initone(512,Ie),t._initone(1,Ne),t._initone(9,Ne)},t.create=function(e,i){var _=t._cache[e|i];return _._length?_[--_._length]:new t._typeClass[e|i](i)},t._cache=[],t._typeClass=[],t.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t}(),H=(function(){function t(){this._paramData=new ParamData(4,!0)}r(t,"laya.layagl.cmdNative.AlphaCmdNative");var e=t.prototype;return e.recover=function(){C.recover("AlphaCmd",this)},e.run=function(t){t.alpha(this._alpha)},a(0,e,"cmdID",function(){return"Alpha"}),a(0,e,"alpha",function(){return this._alpha},function(t){t=t>1?1:t,t=0>t?0:t,this._alpha=t;var e=16777215;e=255*t<<24|e,this._paramData._int32Data[0]=e,K.syncBufferToRenderThread(this._paramData)}),t.create=function(e){var i=C.getItemByClass("AlphaCmd",t),_=i._graphicsCmdEncoder=this._commandEncoder;return i.alpha=e,_.setGlobalValueEx(te.GLOBALVALUE_DRAWTEXTURE_COLOR,15,i._paramData.getPtrID(),0),K.syncBufferToRenderThread(_),i},t.ID="Alpha",t}(),function(){function t(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(16,!0)}r(t,"laya.layagl.cmdNative.ClipRectCmdNative");var e=t.prototype;return e.recover=function(){C.recover("ClipRectCmd",this)},a(0,e,"cmdID",function(){return"ClipRect"}),a(0,e,"width",function(){return 0},function(){}),a(0,e,"x",function(){return 0},function(){}),a(0,e,"y",function(){return 0},function(){}),a(0,e,"height",function(){return 0},function(){}),t.create=function(e,i,_,r){var a=C.getItemByClass("ClipRectCmd",t);a._graphicsCmdEncoder=this._commandEncoder;var n=a._graphicsCmdEncoder,s=a._paramData._float32Data;s[0]=e,s[1]=i,s[2]=_,s[3]=r;var o=a._paramData.getPtrID();return K.syncBufferToRenderThread(a._paramData),n.setClipValueEx(te.GLOBALVALUE_CLIP_MAT_DIR,te.GLOBALVALUE_CLIP_MAT_POS,te.GLOBALVALUE_MATRIX32,o),K.syncBufferToRenderThread(n),a},t.ID="ClipRect",t}(),function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=0/0,this._y=0/0,this._width=0/0,this._height=0/0}r(t,"laya.layagl.cmdNative.DrawCanvasCmdNative");var e=t.prototype;return e.recover=function(){this._graphicsCmdEncoder=null,C.recover("DrawCanvasCmd",this)},a(0,e,"cmdID",function(){return"DrawCanvas"}),a(0,e,"y",function(){return this._y},function(e){this._y=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,i[t._PARAM_CLIP_SIZE+1]=e+16,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"texture",function(){return this._texture},function(e){this._texture=e,this._paramData._int32Data[t._PARAM_TEXTURE_POS_]=this._texture._getSource().id;var i=this._paramData._float32Data,_=$e.flipyuv;i[t._PARAM_VB_POS_+2]=_[0],i[t._PARAM_VB_POS_+3]=_[1],i[t._PARAM_VB_POS_+8]=_[2],i[t._PARAM_VB_POS_+9]=_[3],i[t._PARAM_VB_POS_+14]=_[4],i[t._PARAM_VB_POS_+15]=_[5],i[t._PARAM_VB_POS_+20]=_[6],i[t._PARAM_VB_POS_+21]=_[7],K.syncBufferToRenderThread(this._paramData)}),a(0,e,"width",function(){return this._width},function(e){this._width=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,i[t._PARAM_CLIP_SIZE+2]=e-32,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"x",function(){return this._x},function(e){this._x=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,i[t._PARAM_CLIP_SIZE]=e+16,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"height",function(){return this._height},function(e){this._height=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,i[t._PARAM_CLIP_SIZE+3]=e-32,K.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,_,r,a){var n=C.getItemByClass("DrawCanvasCmd",t);n._graphicsCmdEncoder=this._commandEncoder,t.createCommandEncoder(),n._paramData||(n._paramData=new ParamData(132,!0)),n._texture=e,n._x=i,n._y=_,n._width=r,n._height=a,t.setParamData(n._paramData,e,i,_,r,a);var s=t._DRAW_CANVAS_CMD_ENCODER_.getPtrID(),o=n._paramData.getPtrID();return n._graphicsCmdEncoder.useCommandEncoder(s,o,-1),K.syncBufferToRenderThread(n._graphicsCmdEncoder),n},t.createCommandEncoder=function(){t._DRAW_CANVAS_CMD_ENCODER_||(t._DRAW_CANVAS_CMD_ENCODER_=K.instance.createCommandEncoder(124,32,!0),t._DRAW_CANVAS_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_CANVAS_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),t._DRAW_CANVAS_CMD_ENCODER_.useVDO(te.VDO_MESHQUADTEXTURE),t._DRAW_CANVAS_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_CANVAS_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_CANVAS_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_CANVAS_CMD_ENCODER_.uniformTextureByParamData(0,4,4*t._PARAM_TEXTURE_POS_),t._DRAW_CANVAS_CMD_ENCODER_.setRectMeshByParamData(12,4*t._PARAM_VB_POS_,16),t._DRAW_CANVAS_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_CANVAS_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_CANVAS_CMD_ENCODER_))},t.setParamData=function(e,i,_,r,a,n){var s=e._float32Data,o=e._int32Data;o[0]=3,o[1]=33984,o[t._PARAM_TEXTURE_POS_]=i._getSource().id,o[3]=1,o[4]=96;var h=0!=a?a:i.width,u=0!=n?n:i.height,l=$e.flipyuv,c=t._PARAM_VB_POS_;s[c++]=_,s[c++]=r,s[c++]=l[0],s[c++]=l[1],o[c++]=4294967295,o[c++]=4294967295,s[c++]=_+h,s[c++]=r,s[c++]=l[2],s[c++]=l[3],o[c++]=4294967295,o[c++]=4294967295,s[c++]=_+h,s[c++]=r+u,s[c++]=l[4],s[c++]=l[5],o[c++]=4294967295,o[c++]=4294967295,s[c++]=_,s[c++]=r+u,s[c++]=l[6],s[c++]=l[7],o[c++]=4294967295,o[c++]=4294967295,s[t._PARAM_CLIP_SIZE]=_+16,s[t._PARAM_CLIP_SIZE+1]=r+16,s[t._PARAM_CLIP_SIZE+2]=a-32,s[t._PARAM_CLIP_SIZE+3]=n-32,K.syncBufferToRenderThread(e)},t.ID="DrawCanvas",t._DRAW_CANVAS_CMD_ENCODER_=null,t._PARAM_TEXTURE_POS_=2,t._PARAM_VB_POS_=5,t._PARAM_CLIP_SIZE=29,t}()),Z=(function(){function t(){this._graphicsCmdEncoder=null,this._paramData=null,this._paramID=null,this._x=0/0,this._y=0/0,this._radius=0/0,this._fillColor=null,this._lineColor=null,this._lineWidth=0/0,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}r(t,"laya.layagl.cmdNative.DrawCircleCmdNative");var e=t.prototype;return e._arc=function(t,e,i,_,r){void 0===_&&(_=!1),void 0===r&&(r=!0);var a=[],n=0,s=2*Math.PI,o=0,h=0,u=0,l=0,c=0,f=0,d=0,E=0,A=0,D=0,R=0;if(h=s-n,_)if(Math.abs(h)>=2*Math.PI)h=2*-Math.PI;else for(;h>0;)h-=2*Math.PI;else if(Math.abs(h)>=2*Math.PI)h=2*Math.PI;else for(;0>h;)h+=2*Math.PI;D=101>i?Math.max(10,h*i/5):201>i?Math.max(10,h*i/20):Math.max(10,h*i/40),u=h/D/2,l=Math.abs(4/3*(1-Math.cos(u))/Math.sin(u)),_&&(l=-l),R=0;for(A=0;D>=A;A++)o=n+h*(A/D),c=Math.cos(o),f=Math.sin(o),d=t+c*i,E=e+f*i,a.push(d),a.push(E);return a},e.recover=function(){this._fillColor=null,this._lineColor=null,this._points.length=0,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,C.recover("DrawCircleCmd",this)},a(0,e,"lineColor",function(){return this._lineColor},function(e){!this._lineColor&&this._lineWidth&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=t._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineColor=e,this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;for(var i=0;i<this._points.length;i++)this._linePoints.push(this._points[i]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Re.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var _=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(_-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var r=this.line_ibBuffer._int16Data,a=0,n=0;n<3*(this._line_vertNum-2);n++)r[a++]=this._line_ibArray[n];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*_*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var s=u.create(e),o=s.numColor,h=this.line_vbBuffer._float32Data,l=this.line_vbBuffer._int32Data,c=0;for(i=0;i<this._line_vertNum;i++)h[c++]=this._line_vbArray[2*i]+this.x,h[c++]=this._line_vbArray[2*i+1]+this.y,l[c++]=o;var f=this._paramData._int32Data;f[t._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),f[t._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),f[t._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,f[t._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,K.syncBufferToRenderThread(this.line_vbBuffer),K.syncBufferToRenderThread(this.line_ibBuffer),K.syncBufferToRenderThread(this._paramData)}),a(0,e,"cmdID",function(){return"DrawCircle"}),a(0,e,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=u.create(this._fillColor),i=e.numColor,_=this.vbBuffer._int32Data,r=0,a=0;a<this._vertNum;a++)r++,r++,_[r++]=i;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._points[2*_]+this._x,i++,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(i=0,_=0;_<this._line_vertNum;_++)r[i++]=this._line_vbArray[2*_]+this._x,i++,i++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._points[2*_+1]+this._y,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(i=0,_=0;_<this._line_vertNum;_++)i++,r[i++]=this._line_vbArray[2*_+1]+this._y,i++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"radius",function(){return this._radius},function(e){this._points=this._arc(0,0,e),this._vertNum=this._points.length/2;var i=this._vertNum,_=0;this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;var r=0,a=this._vertNum-2;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*a*2)&&(this.ibBuffer=new ParamData(3*a*2,!0,!0)),this._ibSize=3*a*2;for(var n=this.ibBuffer._int16Data,s=0,o=0;a>o;o++)n[s++]=r,n[s++]=o+1+r,n[s++]=o+2+r;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*i*4,!0)),this._vbSize=3*this._vertNum*4;for(var h=u.create(this._fillColor),l=h.numColor,c=this.vbBuffer._float32Data,f=this.vbBuffer._int32Data,d=0,E=0;E<this._vertNum;E++)c[d++]=this._points[2*E]+this._x,c[d++]=this._points[2*E+1]+this._y,f[d++]=l;if(this._lineColor){for(E=0;E<this._points.length;E++)this._linePoints.push(this._points[E]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Re.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,_=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(_-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;var A=this.line_ibBuffer._int16Data;s=0;for(var D=0;D<3*(this._line_vertNum-2);D++)A[s++]=this._line_ibArray[D];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*_*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var R=u.create(this._lineColor),m=R.numColor,T=this.line_vbBuffer._float32Data,v=this.line_vbBuffer._int32Data;for(d=0,E=0;E<this._line_vertNum;E++)T[d++]=this._line_vbArray[2*E]+this._x,T[d++]=this._line_vbArray[2*E+1]+this._y,v[d++]=m}var P=this._paramData._int32Data;P[t._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),P[t._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),P[t._PARAM_VB_SIZE_POS_]=this._vbSize,P[t._PARAM_IB_SIZE_POS_]=this._ibSize,K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this.ibBuffer),this._lineColor&&(P[t._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),P[t._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),P[t._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,P[t._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,K.syncBufferToRenderThread(this.line_vbBuffer),K.syncBufferToRenderThread(this.line_ibBuffer)),K.syncBufferToRenderThread(this._paramData)}),a(0,e,"lineWidth",function(){return this._lineWidth},function(e){!this._lineWidth&&this._lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=t._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=e,this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;for(var i=0;i<this._points.length;i++)this._linePoints.push(this._points[i]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Re.createLine2(this._linePoints,this._line_ibArray,e,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var _=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(_-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var r=this.line_ibBuffer._int16Data,a=0,n=0;n<3*(this._line_vertNum-2);n++)r[a++]=this._line_ibArray[n];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*_*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var s=u.create(this._lineColor),o=s.numColor,h=this.line_vbBuffer._float32Data,l=this.line_vbBuffer._int32Data,c=0;for(i=0;i<this._line_vertNum;i++)h[c++]=this._line_vbArray[2*i]+this.x,h[c++]=this._line_vbArray[2*i+1]+this.y,l[c++]=o;var f=this._paramData._int32Data;f[t._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),f[t._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),f[t._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,f[t._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,K.syncBufferToRenderThread(this.line_vbBuffer),K.syncBufferToRenderThread(this.line_ibBuffer),K.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,_,r,a,n){var s=C.getItemByClass("DrawCircleCmd",t);s._graphicsCmdEncoder=this._commandEncoder,t._DRAW_CIRCLE_LINES_CMD_ENCODER_||(t._DRAW_CIRCLE_LINES_CMD_ENCODER_=K.instance.createCommandEncoder(140,32,!0),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_OFFSET_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_OFFSET_POS_,4*t._PARAM_IB_SIZE_POS_,4*t._PARAM_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_LINE_VB_POS_,4*t._PARAM_LINE_VB_OFFSET_POS_,4*t._PARAM_LINE_VB_SIZE_POS_,4*t._PARAM_LINE_IB_POS_,4*t._PARAM_LINE_IB_OFFSET_POS_,4*t._PARAM_LINE_IB_SIZE_POS_,4*t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_CIRCLE_LINES_CMD_ENCODER_)),t._DRAW_CIRCLE_CMD_ENCODER_||(t._DRAW_CIRCLE_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),t._DRAW_CIRCLE_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_CIRCLE_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_CIRCLE_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_CIRCLE_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_OFFSET_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_OFFSET_POS_,4*t._PARAM_IB_SIZE_POS_,4*t._PARAM_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_CIRCLE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_CIRCLE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_CIRCLE_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(72,!0)),s._x=e,s._y=i,s._radius=_,s._fillColor=r,s._lineColor=a,s._lineWidth=n,s._points=s._arc(0,0,_),s._vertNum=s._points.length/2;var o=s._vertNum,h=0,l=s._vertNum-2;(!s.ibBuffer||s.ibBuffer.getByteLength()<3*l*2)&&(s.ibBuffer=new ParamData(3*l*2,!0,!0)),s._ibSize=3*l*2;for(var c=s.ibBuffer._int16Data,f=0,d=0;l>d;d++)c[f++]=h,c[f++]=d+1+h,c[f++]=d+2+h;var E=u.create(r),A=E.numColor;(!s.vbBuffer||s.vbBuffer.getByteLength()<3*s._vertNum*4)&&(s.vbBuffer=new ParamData(3*o*4,!0)),s._vbSize=3*s._vertNum*4;for(var D=s.vbBuffer._float32Data,R=s.vbBuffer._int32Data,m=0,T=0;T<s._vertNum;T++)D[m++]=s._points[2*T]+e,D[m++]=s._points[2*T+1]+i,R[m++]=A;var v=0;for(T=0;T<s._points.length;T++)s._linePoints.push(s._points[T]);if(s._linePoints.push(s._points[0]),s._linePoints.push(s._points[1]),a){Re.createLine2(s._linePoints,s._line_ibArray,n,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,v=s._line_vertNum,(!s.line_ibBuffer||s.line_ibBuffer.getByteLength()<3*(s._line_vertNum-2)*2)&&(s.line_ibBuffer=new ParamData(3*(v-2)*2,!0,!0)),s._line_ibSize=3*(s._line_vertNum-2)*2;var P=s.line_ibBuffer._int16Data;f=0;for(var p=0;p<3*(s._line_vertNum-2);p++)P[f++]=s._line_ibArray[p];(!s.line_vbBuffer||s.line_vbBuffer.getByteLength()<3*s._line_vertNum*4)&&(s.line_vbBuffer=new ParamData(3*v*4,!0)),s._line_vbSize=3*s._line_vertNum*4;var M=u.create(a),O=M.numColor,L=s.line_vbBuffer._float32Data,y=s.line_vbBuffer._int32Data;for(m=0,T=0;T<s._line_vertNum;T++)L[m++]=s._line_vbArray[2*T]+e,L[m++]=s._line_vbArray[2*T+1]+i,y[m++]=O}else{s._lineWidth=1;var S="#FFFFFF";for(Re.createLine2(s._linePoints,s._line_ibArray,s._lineWidth,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,v=s._line_vertNum,(!s.line_ibBuffer||s.line_ibBuffer.getByteLength()<3*(s._line_vertNum-2)*2)&&(s.line_ibBuffer=new ParamData(3*(v-2)*2,!0,!0)),s._line_ibSize=3*(s._line_vertNum-2)*2,P=s.line_ibBuffer._int16Data,f=0,p=0;p<3*(s._line_vertNum-2);p++)P[f++]=s._line_ibArray[p];for((!s.line_vbBuffer||s.line_vbBuffer.getByteLength()<3*s._line_vertNum*4)&&(s.line_vbBuffer=new ParamData(3*v*4,!0)),s._line_vbSize=3*s._line_vertNum*4,M=u.create(S),O=M.numColor,L=s.line_vbBuffer._float32Data,y=s.line_vbBuffer._int32Data,m=0,T=0;T<s._line_vertNum;T++)L[m++]=s._line_vbArray[2*T]+e,L[m++]=s._line_vbArray[2*T+1]+i,y[m++]=O}var g=s._paramData._float32Data,b=s._paramData._int32Data;return b[0]=1,b[1]=32,b[t._PARAM_VB_POS_]=s.vbBuffer.getPtrID(),b[t._PARAM_IB_POS_]=s.ibBuffer.getPtrID(),b[t._PARAM_VB_SIZE_POS_]=s._vbSize,b[t._PARAM_IB_SIZE_POS_]=s._ibSize,b[t._PARAM_VB_OFFSET_POS_]=0,b[t._PARAM_IB_OFFSET_POS_]=0,b[t._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(s.vbBuffer),K.syncBufferToRenderThread(s.ibBuffer),b[t._PARAM_LINE_VB_POS_]=s.line_vbBuffer.getPtrID(),b[t._PARAM_LINE_IB_POS_]=s.line_ibBuffer.getPtrID(),g[t._PARAM_LINECOLOR_POS_]=a,g[t._PARAM_LINEWIDTH_POS_]=n,b[t._PARAM_LINE_VB_SIZE_POS_]=s._line_vbSize,b[t._PARAM_LINE_IB_SIZE_POS_]=s._line_ibSize,b[t._PARAM_LINE_VB_OFFSET_POS_]=0,b[t._PARAM_LINE_IB_OFFSET_POS_]=0,b[t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(s.line_vbBuffer),K.syncBufferToRenderThread(s.line_ibBuffer),K.syncBufferToRenderThread(s._paramData),s._cmdCurrentPos=a?s._graphicsCmdEncoder.useCommandEncoder(t._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1):s._graphicsCmdEncoder.useCommandEncoder(t._DRAW_CIRCLE_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),K.syncBufferToRenderThread(s._graphicsCmdEncoder),s},t.ID="DrawCircle",t._DRAW_CIRCLE_CMD_ENCODER_=null,t._DRAW_CIRCLE_LINES_CMD_ENCODER_=null,t._PARAM_VB_POS_=2,t._PARAM_IB_POS_=3,t._PARAM_LINE_VB_POS_=4,t._PARAM_LINE_IB_POS_=5,t._PARAM_LINECOLOR_POS_=6,t._PARAM_LINEWIDTH_POS_=7,t._PARAM_VB_SIZE_POS_=8,t._PARAM_IB_SIZE_POS_=9,t._PARAM_LINE_VB_SIZE_POS_=10,t._PARAM_LINE_IB_SIZE_POS_=11,t._PARAM_VB_OFFSET_POS_=12,t._PARAM_IB_OFFSET_POS_=13,t._PARAM_LINE_VB_OFFSET_POS_=14,t._PARAM_LINE_IB_OFFSET_POS_=15,t._PARAM_INDEX_ELEMENT_OFFSET_POS_=16,t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=17,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._paramData=null,this._x=0,this._y=0,this._points=[],this._lineColor=null,this._lineWidth=0/0,this.lastOriX=0,this.lastOriY=0,this.tArray=[],this._vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this._ibSize=0,this._vbSize=0,this._ibArray=[],this._vbArray=[]}r(t,"laya.layagl.cmdNative.DrawCurvesCmdNative");var e=t.prototype;return e._getPoints=function(t){var e=[];this._points.push(t[0]),this._points.push(t[1]);for(var i=2,_=t.length;_>i;)this._quadraticCurveTo(e,t[i++],t[i++],t[i++],t[i++]);return e},e._quadraticCurveTo=function(t,e,i,_,r){var a=n.I;0==this.tArray.length?(this.lastOriX=this._points[0],this.lastOriY=this._points[1]):(this.lastOriX=this.tArray[this.tArray.length-2],this.lastOriY=this.tArray[this.tArray.length-1]),this.tArray=a.getBezierPoints([this.lastOriX,this.lastOriY,e,i,_,r],30,2);for(var s=2,o=this.tArray.length;o>s;s++)t.push(this.tArray[s])},e.recover=function(){this._lineColor=null,this._points.length=0,this.tArray.length=0,this._ibArray.length=0,this._vbArray.length=0,C.recover("DrawCurvesCmd",this)},a(0,e,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;for(var e=u.create(this._lineColor),i=e.numColor,_=this.vbBuffer._int32Data,r=0,a=0;a<this._vertNum;a++)r++,r++,_[r++]=i;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"points",function(){return this._points},function(e){this._points.length=0,this.lastOriX=0,this.lastOriY=0,this._points=this._getPoints(e),this._ibArray.length=0,this._vbArray.length=0,Re.createLine2(this._points,this._ibArray,this.lineWidth,0,this._vbArray,!1);var i=u.create(this._lineColor),_=i.numColor;this._vertNum=this._points.length;var r=this._vertNum;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*r*4,!0)),this._vbSize=3*this._vertNum*4;for(var a=this.vbBuffer._float32Data,n=this.vbBuffer._int32Data,s=0,o=0;o<this._vertNum;o++)a[s++]=this._vbArray[2*o]+this.x,a[s++]=this._vbArray[2*o+1]+this.y,n[s++]=_;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.ibBuffer=new ParamData(3*(r-2)*2,!0,!0)),this._ibSize=3*(this._vertNum-2)*2;for(var h=this.ibBuffer._int16Data,l=0;l<3*(this._vertNum-2);l++)h[l]=this._ibArray[l];n=this._paramData._int32Data,n[t._PARAM_VB_SIZE_POS_]=this._vbSize,n[t._PARAM_IB_SIZE_POS_]=this._ibSize,K.syncBufferToRenderThread(this.ibBuffer),K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this._paramData)}),a(0,e,"cmdID",function(){return"DrawCurves"}),a(0,e,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._vbArray[2*_]+this._x,i++,i++;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._vbArray[2*_+1]+this._y,i++;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t,this._ibArray.length=0,this._vbArray.length=0,Re.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._vbArray[2*_]+this.x,e[i++]=this._vbArray[2*_+1]+this.y,i++;K.syncBufferToRenderThread(this.vbBuffer)}),t.create=function(e,i,_,r,a){var n=C.getItemByClass("DrawCurvesCmd",t);n._graphicsCmdEncoder=this._commandEncoder,t._DRAW_CURVES_CMD_ENCODER_||(t._DRAW_CURVES_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),t._DRAW_CURVES_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_CURVES_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_CURVES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_CURVES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_CURVES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_CURVES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_OFFSET_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_OFFSET_POS_,4*t._PARAM_IB_SIZE_POS_,4*t._PARAM_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_CURVES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_CURVES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_CURVES_CMD_ENCODER_)),n._paramData||(n._paramData=new ParamData(32,!0)),n._x=e,n._y=i,n._lineColor=r,n._lineWidth=a,n._points=n._getPoints(_),Re.createLine2(n._points,n._ibArray,a,0,n._vbArray,!1);var s=u.create(r),o=s.numColor;n._vertNum=n._points.length;var h=n._vertNum;(!n.vbBuffer||n.vbBuffer.getByteLength()<3*n._vertNum*4)&&(n.vbBuffer=new ParamData(3*h*4,!0)),n._vbSize=3*n._vertNum*4;for(var l=n.vbBuffer._float32Data,c=n.vbBuffer._int32Data,f=0,d=0;d<n._vertNum;d++)l[f++]=n._vbArray[2*d]+e,l[f++]=n._vbArray[2*d+1]+i,c[f++]=o;(!n.ibBuffer||n.ibBuffer.getByteLength()<3*(n._vertNum-2)*2)&&(n.ibBuffer=new ParamData(3*(h-2)*2,!0,!0)),n._ibSize=3*(n._vertNum-2)*2;for(var E=n.ibBuffer._int16Data,A=0;A<3*(n._vertNum-2);A++)E[A]=n._ibArray[A];n._paramData._float32Data;return c=n._paramData._int32Data,c[0]=1,c[t._PARAM_VB_POS_]=n.vbBuffer.getPtrID(),c[t._PARAM_IB_POS_]=n.ibBuffer.getPtrID(),c[t._PARAM_VB_SIZE_POS_]=n._vbSize,c[t._PARAM_IB_SIZE_POS_]=n._ibSize,c[t._PARAM_VB_OFFSET_POS_]=0,c[t._PARAM_IB_OFFSET_POS_]=0,c[t._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(n.vbBuffer),K.syncBufferToRenderThread(n.ibBuffer),K.syncBufferToRenderThread(n._paramData),n._graphicsCmdEncoder.useCommandEncoder(t._DRAW_CURVES_CMD_ENCODER_.getPtrID(),n._paramData.getPtrID(),-1),K.syncBufferToRenderThread(n._graphicsCmdEncoder),n},t.ID="DrawCurves",t._DRAW_CURVES_CMD_ENCODER_=null,t._PARAM_VB_POS_=1,t._PARAM_IB_POS_=2,t._PARAM_VB_SIZE_POS_=3,t._PARAM_IB_SIZE_POS_=4,t._PARAM_VB_OFFSET_POS_=5,t._PARAM_IB_OFFSET_POS_=6,t._PARAM_INDEX_ELEMENT_OFFSET_POS_=7,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=0/0,this._y=0/0,this._width=0/0,this._height=0/0}r(t,"laya.layagl.cmdNative.DrawImageCmdNative");var e=t.prototype;return e.recover=function(){this._graphicsCmdEncoder=null,C.recover("DrawImageCmd",this)},a(0,e,"cmdID",function(){return"DrawImage"}),a(0,e,"y",function(){return this._y},function(e){this._y=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"texture",function(){return this._texture},function(e){this._texture=e,this._paramData._int32Data[t._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id;var i=this._paramData._float32Data,_=this._texture.uv;i[t._PARAM_VB_POS_+2]=_[0],i[t._PARAM_VB_POS_+3]=_[1],i[t._PARAM_VB_POS_+8]=_[2],i[t._PARAM_VB_POS_+9]=_[3],i[t._PARAM_VB_POS_+14]=_[4],i[t._PARAM_VB_POS_+15]=_[5],i[t._PARAM_VB_POS_+20]=_[6],i[t._PARAM_VB_POS_+21]=_[7],K.syncBufferToRenderThread(this._paramData)
}),a(0,e,"width",function(){return this._width},function(e){this._width=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"x",function(){return this._x},function(e){this._x=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"height",function(){return this._height},function(e){this._height=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,K.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,_,r,a){var n=C.getItemByClass("DrawImageCmd",t);n._graphicsCmdEncoder=this._commandEncoder,t._DRAW_IMAGE_CMD_ENCODER_||(t._DRAW_IMAGE_CMD_ENCODER_=K.instance.createCommandEncoder(124,32,!0),t._DRAW_IMAGE_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_IMAGE_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),t._DRAW_IMAGE_CMD_ENCODER_.useVDO(te.VDO_MESHQUADTEXTURE),t._DRAW_IMAGE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_IMAGE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_IMAGE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_IMAGE_CMD_ENCODER_.uniformTextureByParamData(0,4,4*t._PARAM_TEXTURE_POS_),t._DRAW_IMAGE_CMD_ENCODER_.setRectMeshByParamData(12,4*t._PARAM_VB_POS_,16),t._DRAW_IMAGE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_IMAGE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_IMAGE_CMD_ENCODER_)),n._paramData||(n._paramData=new ParamData(116,!0)),n._texture=e,n._x=i,n._y=_,n._width=r,n._height=a;var s=n._paramData._float32Data,o=n._paramData._int32Data;o[0]=3,o[1]=33984,o[t._PARAM_TEXTURE_POS_]=e.getIsReady()?e.bitmap._glTexture.id:0,o[3]=1,o[4]=96;var h=0!=r?r:e.bitmap.width,u=0!=a?a:e.bitmap.height,l=e.uv,c=t._PARAM_VB_POS_;return s[c++]=i,s[c++]=_,s[c++]=l[0],s[c++]=l[1],o[c++]=4294967295,o[c++]=4294967295,s[c++]=i+h,s[c++]=_,s[c++]=l[2],s[c++]=l[3],o[c++]=4294967295,o[c++]=4294967295,s[c++]=i+h,s[c++]=_+u,s[c++]=l[4],s[c++]=l[5],o[c++]=4294967295,o[c++]=4294967295,s[c++]=i,s[c++]=_+u,s[c++]=l[6],s[c++]=l[7],o[c++]=4294967295,o[c++]=4294967295,K.syncBufferToRenderThread(n._paramData),n._graphicsCmdEncoder.useCommandEncoder(t._DRAW_IMAGE_CMD_ENCODER_.getPtrID(),n._paramData.getPtrID(),-1),K.syncBufferToRenderThread(n._graphicsCmdEncoder),n},t.ID="DrawImage",t._DRAW_IMAGE_CMD_ENCODER_=null,t._PARAM_TEXTURE_POS_=2,t._PARAM_VB_POS_=5,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._paramData=null,this._fromX=0/0,this._fromY=0/0,this._toX=0/0,this._toY=0/0,this._lineColor=null,this._lineWidth=0/0,this._vid=0}r(t,"laya.layagl.cmdNative.DrawLineCmdNative");var e=t.prototype;return e.recover=function(){C.recover("DrawLineCmd",this)},a(0,e,"lineColor",function(){return this._lineColor},function(e){this._lineColor=e;var i=u.create(this.lineColor),_=i.numColor,r=this._paramData._int32Data,a=t._PARAM_VB_POS_;a++,a++,r[a++]=_,a++,a++,r[a++]=_,a++,a++,r[a++]=_,a++,a++,r[a++]=_,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"cmdID",function(){return"DrawLine"}),a(0,e,"toY",function(){return this._toY},function(e){this._toY=e;var i=[this._fromX,this._fromY,this._toX,this._toY],_=[],r=[];Re.createLine2(i,r,this._lineWidth,0,_,!1);var a=this._paramData._float32Data,n=(this._paramData._int32Data,this._paramData._int16Data),s=t._PARAM_VB_POS_;a[s++]=_[0],a[s++]=_[1],s++,a[s++]=_[2],a[s++]=_[3],s++,a[s++]=_[4],a[s++]=_[5],s++,a[s++]=_[6],a[s++]=_[7],s++;var o=2*t._PARAM_IB_POS_;n[o++]=r[0],n[o++]=r[1],n[o++]=r[2],n[o++]=r[3],n[o++]=r[4],n[o++]=r[5],K.syncBufferToRenderThread(this._paramData)}),a(0,e,"fromX",function(){return this._fromX},function(e){this._fromX=e;var i=[this._fromX,this._fromY,this._toX,this._toY],_=[],r=[];Re.createLine2(i,r,this._lineWidth,0,_,!1);var a=this._paramData._float32Data,n=(this._paramData._int32Data,this._paramData._int16Data),s=t._PARAM_VB_POS_;a[s++]=_[0],a[s++]=_[1],s++,a[s++]=_[2],a[s++]=_[3],s++,a[s++]=_[4],a[s++]=_[5],s++,a[s++]=_[6],a[s++]=_[7],s++;var o=2*t._PARAM_IB_POS_;n[o++]=r[0],n[o++]=r[1],n[o++]=r[2],n[o++]=r[3],n[o++]=r[4],n[o++]=r[5],K.syncBufferToRenderThread(this._paramData)}),a(0,e,"vid",function(){return this._vid},function(t){this._vid=t}),a(0,e,"toX",function(){return this._toX},function(e){this._toX=e;var i=[this._fromX,this._fromY,this._toX,this._toY],_=[],r=[];Re.createLine2(i,r,this._lineWidth,0,_,!1);var a=this._paramData._float32Data,n=(this._paramData._int32Data,this._paramData._int16Data),s=t._PARAM_VB_POS_;a[s++]=_[0],a[s++]=_[1],s++,a[s++]=_[2],a[s++]=_[3],s++,a[s++]=_[4],a[s++]=_[5],s++,a[s++]=_[6],a[s++]=_[7],s++;var o=2*t._PARAM_IB_POS_;n[o++]=r[0],n[o++]=r[1],n[o++]=r[2],n[o++]=r[3],n[o++]=r[4],n[o++]=r[5],K.syncBufferToRenderThread(this._paramData)}),a(0,e,"fromY",function(){return this._fromY},function(e){this._fromY=e;var i=[this._fromX,this._fromY,this._toX,this._toY],_=[],r=[];Re.createLine2(i,r,this._lineWidth,0,_,!1);var a=this._paramData._float32Data,n=(this._paramData._int32Data,this._paramData._int16Data),s=t._PARAM_VB_POS_;a[s++]=_[0],a[s++]=_[1],s++,a[s++]=_[2],a[s++]=_[3],s++,a[s++]=_[4],a[s++]=_[5],s++,a[s++]=_[6],a[s++]=_[7],s++;var o=2*t._PARAM_IB_POS_;n[o++]=r[0],n[o++]=r[1],n[o++]=r[2],n[o++]=r[3],n[o++]=r[4],n[o++]=r[5],K.syncBufferToRenderThread(this._paramData)}),a(0,e,"lineWidth",function(){return this._lineWidth},function(e){this._lineWidth=e;var i=[this._fromX,this._fromY,this._toX,this._toY],_=[],r=[];Re.createLine2(i,r,this.lineWidth,0,_,!1);var a=this._paramData._float32Data,n=(this._paramData._int32Data,this._paramData._int16Data),s=t._PARAM_VB_POS_;a[s++]=_[0],a[s++]=_[1],s++,a[s++]=_[2],a[s++]=_[3],s++,a[s++]=_[4],a[s++]=_[5],s++,a[s++]=_[6],a[s++]=_[7],s++;var o=2*t._PARAM_IB_POS_;n[o++]=r[0],n[o++]=r[1],n[o++]=r[2],n[o++]=r[3],n[o++]=r[4],n[o++]=r[5],K.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,_,r,a,n,s){var o=C.getItemByClass("DrawLineCmd",t);o._graphicsCmdEncoder=this._commandEncoder,t._DRAW_LINE_CMD_ENCODER_||(t._DRAW_LINE_CMD_ENCODER_=K.instance.createCommandEncoder(84,32,!0),t._DRAW_LINE_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_LINE_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_LINE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_LINE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_LINE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_LINE_CMD_ENCODER_.setMeshByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_OFFSET_POS_,4,4*t._PARAM_IB_POS_,4*t._PARAM_IB_OFFSET_POS_,8,4*t._PARAM_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_LINE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_LINE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_LINE_CMD_ENCODER_)),o._paramData||(o._paramData=new ParamData(96,!0)),o._fromX=e,o._fromY=i,o._toX=_,o._toY=r,o._lineColor=a,o._lineWidth=n,o._vid=s;var h=u.create(a),l=h.numColor,c=[e,i,_,r],f=[],d=[];Re.createLine2(c,d,n,0,f,!1);var E=o._paramData._float32Data,A=o._paramData._int32Data,D=o._paramData._int16Data;A[0]=1,A[1]=48,A[2]=12,A[t._PARAM_VB_OFFSET_POS_]=0,A[t._PARAM_IB_OFFSET_POS_]=0,A[t._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0;var R=t._PARAM_VB_POS_;E[R++]=f[0],E[R++]=f[1],A[R++]=l,E[R++]=f[2],E[R++]=f[3],A[R++]=l,E[R++]=f[4],E[R++]=f[5],A[R++]=l,E[R++]=f[6],E[R++]=f[7],A[R++]=l;var m=2*t._PARAM_IB_POS_;return D[m++]=d[0],D[m++]=d[1],D[m++]=d[2],D[m++]=d[3],D[m++]=d[4],D[m++]=d[5],E[t._PARAM_LINECOLOR_POS_]=a?a:4278190335,E[t._PARAM_LINEWIDTH_POS_]=n,E[t._PARAM_VID_POS_]=s,K.syncBufferToRenderThread(o._paramData),o._graphicsCmdEncoder.useCommandEncoder(t._DRAW_LINE_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1),K.syncBufferToRenderThread(o._graphicsCmdEncoder),o},t.ID="DrawLine",t._DRAW_LINE_CMD_ENCODER_=null,t._PARAM_VB_POS_=3,t._PARAM_IB_POS_=15,t._PARAM_LINECOLOR_POS_=18,t._PARAM_LINEWIDTH_POS_=19,t._PARAM_VID_POS_=20,t._PARAM_VB_OFFSET_POS_=21,t._PARAM_IB_OFFSET_POS_=22,t._PARAM_INDEX_ELEMENT_OFFSET_POS_=23,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._paramData=null,this._x=0/0,this._y=0/0,this._points=null,this._lineColor=null,this._lineWidth=0/0,this._vid=0,this._vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this._ibSize=0,this._vbSize=0,this._ibArray=[],this._vbArray=[]}r(t,"laya.layagl.cmdNative.DrawLinesCmdNative");var e=t.prototype;return e.recover=function(){this._points=null,this._lineColor=null,this._ibArray.length=0,this._vbArray.length=0,C.recover("DrawLinesCmd",this)},a(0,e,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;for(var e=u.create(this._lineColor),i=e.numColor,_=this.vbBuffer._int32Data,r=0,a=0;a<this._vertNum;a++)r++,r++,_[r++]=i;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"points",function(){return this._points},function(e){this._points=e,this._ibArray.length=0,this._vbArray.length=0,Re.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);var i=u.create(this._lineColor),_=i.numColor;this._vertNum=this._points.length;var r=this._vertNum;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*r*4,!0)),this._vbSize=3*this._vertNum*4;for(var a=this.vbBuffer._float32Data,n=this.vbBuffer._int32Data,s=0,o=0;o<this._vertNum;o++)a[s++]=this._vbArray[2*o]+this.x,a[s++]=this._vbArray[2*o+1]+this.y,n[s++]=_;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.ibBuffer=new ParamData(3*(r-2)*2,!0,!0)),this._ibSize=3*(this._vertNum-2)*2;for(var h=this.ibBuffer._int16Data,l=0;l<3*(this._vertNum-2);l++)h[l]=this._ibArray[l];n=this._paramData._int32Data,n[t._PARAM_VB_SIZE_POS_]=this._vbSize,n[t._PARAM_IB_SIZE_POS_]=this._ibSize,K.syncBufferToRenderThread(this.ibBuffer),K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this._paramData)}),a(0,e,"cmdID",function(){return"DrawLines"}),a(0,e,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._vbArray[2*_]+this._x,i++,i++;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"vid",function(){return this._vid},function(t){this._vid=t}),a(0,e,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._vbArray[2*_+1]+this._y,i++;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t,this._ibArray.length=0,this._vbArray.length=0,Re.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._vbArray[2*_]+this.x,e[i++]=this._vbArray[2*_+1]+this.y,i++;K.syncBufferToRenderThread(this.vbBuffer)}),t.create=function(e,i,_,r,a,n){var s=C.getItemByClass("DrawLinesCmd",t);s._graphicsCmdEncoder=this._commandEncoder,t._DRAW_LINES_CMD_ENCODER_||(t._DRAW_LINES_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),t._DRAW_LINES_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_LINES_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_LINES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_OFFSET_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_OFFSET_POS_,4*t._PARAM_IB_SIZE_POS_,4*t._PARAM_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_LINES_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(44,!0)),s._x=e,s._y=i,s._points=_,s._lineColor=r,s._lineWidth=a,s._vid=n,Re.createLine2(_,s._ibArray,a,0,s._vbArray,!1);var o=u.create(r),h=o.numColor;s._vertNum=_.length;var l=s._vertNum;(!s.vbBuffer||s.vbBuffer.getByteLength()<3*s._vertNum*4)&&(s.vbBuffer=new ParamData(3*l*4,!0)),s._vbSize=3*s._vertNum*4;for(var c=s.vbBuffer._float32Data,f=s.vbBuffer._int32Data,d=0,E=0;E<s._vertNum;E++)c[d++]=s._vbArray[2*E]+e,c[d++]=s._vbArray[2*E+1]+i,f[d++]=h;(!s.ibBuffer||s.ibBuffer.getByteLength()<3*(s._vertNum-2)*2)&&(s.ibBuffer=new ParamData(3*(l-2)*2,!0,!0)),s._ibSize=3*(s._vertNum-2)*2;for(var A=s.ibBuffer._int16Data,D=0;D<3*(s._vertNum-2);D++)A[D]=s._ibArray[D];var R=s._paramData._float32Data;return f=s._paramData._int32Data,f[0]=1,f[t._PARAM_VB_POS_]=s.vbBuffer.getPtrID(),f[t._PARAM_IB_POS_]=s.ibBuffer.getPtrID(),R[t._PARAM_LINECOLOR_POS_]=r?r:4278190335,R[t._PARAM_LINEWIDTH_POS_]=a,R[t._PARAM_VID_POS_]=n,f[t._PARAM_VB_SIZE_POS_]=s._vbSize,f[t._PARAM_IB_SIZE_POS_]=s._ibSize,f[t._PARAM_VB_OFFSET_POS_]=0,f[t._PARAM_IB_OFFSET_POS_]=0,f[t._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(s.vbBuffer),K.syncBufferToRenderThread(s.ibBuffer),K.syncBufferToRenderThread(s._paramData),s._graphicsCmdEncoder.useCommandEncoder(t._DRAW_LINES_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),K.syncBufferToRenderThread(s._graphicsCmdEncoder),s},t.ID="DrawLines",t._DRAW_LINES_CMD_ENCODER_=null,t._PARAM_VB_POS_=1,t._PARAM_IB_POS_=2,t._PARAM_LINECOLOR_POS_=3,t._PARAM_LINEWIDTH_POS_=4,t._PARAM_VID_POS_=5,t._PARAM_VB_SIZE_POS_=6,t._PARAM_IB_SIZE_POS_=7,t._PARAM_VB_OFFSET_POS_=8,t._PARAM_IB_OFFSET_POS_=9,t._PARAM_INDEX_ELEMENT_OFFSET_POS_=10,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._paramData=null,this.vbBuffer=null,this._template=null,this._floatCountPerVertex=29,this._firstNewElement=0,this._firstFreeElement=0,this._firstActiveElement=0,this._firstRetiredElement=0,this._maxParticleNum=0}r(t,"laya.layagl.cmdNative.DrawParticleCmdNative");var e=t.prototype;return e.updateParticle=function(){if(this._template.texture){this._template.updateParticleForNative();var e=this._template.sv,i=this._paramData._int32Data,_=this._paramData._float32Data;_[t._PARAM_CURRENTTIME_POS_]=e.u_CurrentTime,_[t._PARAM_DURATION_POS_]=e.u_Duration,_[t._PARAM_ENDVEL_POS_]=e.u_EndVelocity,_[t._PARAM_GRAVITY_POS_]=e.u_Gravity[0],_[t._PARAM_GRAVITY_POS_+1]=e.u_Gravity[1],_[t._PARAM_GRAVITY_POS_+2]=e.u_Gravity[2],e.size[0]=Le.width,e.size[1]=Le.height,_[t._PARAM_SIZE_POS_]=e.size[0],_[t._PARAM_SIZE_POS_+1]=e.size[1],_[t._PARAM_MAT_POS_]=1,_[t._PARAM_MAT_POS_+1]=0,_[t._PARAM_MAT_POS_+2]=0,_[t._PARAM_MAT_POS_+3]=0,_[t._PARAM_MAT_POS_+4]=0,_[t._PARAM_MAT_POS_+5]=1,_[t._PARAM_MAT_POS_+6]=0,_[t._PARAM_MAT_POS_+7]=0,_[t._PARAM_MAT_POS_+8]=0,_[t._PARAM_MAT_POS_+9]=0,_[t._PARAM_MAT_POS_+10]=1,_[t._PARAM_MAT_POS_+11]=0,_[t._PARAM_MAT_POS_+12]=0,_[t._PARAM_MAT_POS_+13]=0,_[t._PARAM_MAT_POS_+14]=0,_[t._PARAM_MAT_POS_+15]=1,i[t._PARAM_TEXTURE_LOC_POS_]=33984,i[t._PARAM_TEXTURE_POS_]=this._template.texture.bitmap._glTexture.id,this.vbBuffer=this._template.getConchMesh(),this._firstNewElement=this._template.getFirstNewElement(),this._firstFreeElement=this._template.getFirstFreeElement(),this._firstActiveElement=this._template.getFirstActiveElement(),this._firstRetiredElement=this._template.getFirstRetiredElement();var r=0,a=0,n=0,s=0,o=0,h=0;this._firstActiveElement!=this._firstFreeElement&&(this._firstActiveElement<this._firstFreeElement?(i[t._PARAM_REGDATA_POS_]=1,o=this._firstFreeElement-this._firstActiveElement,r=(this._firstFreeElement-this._firstActiveElement)*this._floatCountPerVertex*4*4,n=this._firstActiveElement*this._floatCountPerVertex*4*4):(i[t._PARAM_REGDATA_POS_]=0,o=this._maxParticleNum-this._firstActiveElement,r=(this._maxParticleNum-this._firstActiveElement)*this._floatCountPerVertex*4*4,n=this._firstActiveElement*this._floatCountPerVertex*4*4,this._firstFreeElement>0?(h=this._firstFreeElement,a=this._firstFreeElement*this._floatCountPerVertex*4*4,s=0):i[t._PARAM_REGDATA_POS_]=1)),i[t._PARAM_VB1_POS_]=this.vbBuffer.getPtrID(),i[t._PARAM_RECT1_NUM_POS_]=o,i[t._PARAM_VB1_SIZE_POS_]=r,i[t._PARAM_VB1_OFFSET_POS_]=n,K.syncBufferToRenderThread(this.vbBuffer),a>0&&(i[t._PARAM_VB2_POS_]=this.vbBuffer.getPtrID(),i[t._PARAM_RECT2_NUM_POS_]=h,i[t._PARAM_VB2_SIZE_POS_]=a,i[t._PARAM_VB2_OFFSET_POS_]=s),K.syncBufferToRenderThread(this._paramData),this._template.addDrawCounter()}},e.recover=function(){this._template=null,C.recover("DrawParticleCmd",this)},a(0,e,"cmdID",function(){return"DrawParticleCmd"}),t.create=function(e){var i=C.getItemByClass("DrawParticleCmd",t);i._graphicsCmdEncoder=this._commandEncoder,t._DRAW_PARTICLE_CMD_ENCODER_||(t._DRAW_PARTICLE_CMD_ENCODER_=K.instance.createCommandEncoder(84,32,!0),t._DRAW_PARTICLE_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_PARTICLE_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWPARTICLE),t._DRAW_PARTICLE_CMD_ENCODER_.useVDO(te.VDO_MESHPARTICLE),t._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(0,4*t._PARAM_CURRENTTIME_POS_),t._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(1,4*t._PARAM_DURATION_POS_),t._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(2,4*t._PARAM_ENDVEL_POS_),t._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(3,4*t._PARAM_GRAVITY_POS_),t._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(4,4*t._PARAM_SIZE_POS_),t._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(5,4*t._PARAM_MAT_POS_),t._DRAW_PARTICLE_CMD_ENCODER_.uniformTextureByParamData(4*t._PARAM_TEXTURE_UNIFORMLOC_POS_,4*t._PARAM_TEXTURE_LOC_POS_,4*t._PARAM_TEXTURE_POS_),t._DRAW_PARTICLE_CMD_ENCODER_.setRectMeshExByParamData(4*t._PARAM_RECT1_NUM_POS_,4*t._PARAM_VB1_POS_,4*t._PARAM_VB1_SIZE_POS_,4*t._PARAM_VB1_OFFSET_POS_),t._DRAW_PARTICLE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,1,7),t._DRAW_PARTICLE_CMD_ENCODER_.loadDataToRegByParamData(0,4*t._PARAM_REGDATA_POS_,4),t._DRAW_PARTICLE_CMD_ENCODER_.ifGreater0(0,2),t._DRAW_PARTICLE_CMD_ENCODER_.setRectMeshExByParamData(4*t._PARAM_RECT2_NUM_POS_,4*t._PARAM_VB2_POS_,4*t._PARAM_VB2_SIZE_POS_,4*t._PARAM_VB2_OFFSET_POS_),t._DRAW_PARTICLE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,1,7),K.syncBufferToRenderThread(t._DRAW_PARTICLE_CMD_ENCODER_)),i._paramData||(i._paramData=new ParamData(144,!0)),i._template=e,i._maxParticleNum=e.settings.maxPartices;var _=i._paramData._int32Data,r=(e._sv,i._paramData._float32Data),a=0;for(r[t._PARAM_CURRENTTIME_POS_]=-1,r[t._PARAM_DURATION_POS_]=-1,r[t._PARAM_ENDVEL_POS_]=-1,r[t._PARAM_GRAVITY_POS_]=-1,r[t._PARAM_GRAVITY_POS_+1]=-1,r[t._PARAM_GRAVITY_POS_+2]=-1,r[t._PARAM_SIZE_POS_]=-1,r[t._PARAM_SIZE_POS_+1]=-1,a=0;16>a;a++)r[t._PARAM_MAT_POS_+a]=-1;return _[t._PARAM_TEXTURE_LOC_POS_]=-1,_[t._PARAM_TEXTURE_POS_]=-1,_[t._PARAM_TEXTURE_UNIFORMLOC_POS_]=6,_[t._PARAM_REGDATA_POS_]=0,_[t._PARAM_VB1_POS_]=-1,_[t._PARAM_VB2_POS_]=-1,_[t._PARAM_VB1_SIZE_POS_]=-1,_[t._PARAM_VB2_SIZE_POS_]=-1,_[t._PARAM_RECT1_NUM_POS_]=-1,_[t._PARAM_RECT2_NUM_POS_]=-1,K.syncBufferToRenderThread(i._paramData),i._graphicsCmdEncoder.useCommandEncoder(t._DRAW_PARTICLE_CMD_ENCODER_.getPtrID(),i._paramData.getPtrID(),-1),K.syncBufferToRenderThread(i._graphicsCmdEncoder),i},t.ID="DrawParticleCmd",t._DRAW_PARTICLE_CMD_ENCODER_=null,t._PARAM_VB1_POS_=0,t._PARAM_VB2_POS_=1,t._PARAM_VB1_SIZE_POS_=2,t._PARAM_VB2_SIZE_POS_=3,t._PARAM_CURRENTTIME_POS_=4,t._PARAM_DURATION_POS_=5,t._PARAM_ENDVEL_POS_=6,t._PARAM_GRAVITY_POS_=7,t._PARAM_SIZE_POS_=10,t._PARAM_MAT_POS_=12,t._PARAM_TEXTURE_LOC_POS_=28,t._PARAM_TEXTURE_POS_=29,t._PARAM_REGDATA_POS_=30,t._PARAM_TEXTURE_UNIFORMLOC_POS_=31,t._PARAM_RECT1_NUM_POS_=32,t._PARAM_RECT2_NUM_POS_=33,t._PARAM_VB1_OFFSET_POS_=34,t._PARAM_VB2_OFFSET_POS_=35,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._paramData=null,this._graphicsCmdEncoder_fill=null,this._paramData_fill=null,this._x=0/0,this._y=0/0,this._paths=null,this._brush=null,this._pen=null,this._vertNum=0,this._startOriX=0,this._startOriY=0,this._lastOriX=0,this._lastOriY=0,this.SEGNUM=32,this.lines_ibBuffer=null,this.lines_vbBuffer=null,this._lines_ibSize=0,this._lines_vbSize=0,this.fill_ibBuffer=null,this.fill_vbBuffer=null,this._fill_ibSize=0,this._fill_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._lines_ibArray=[],this._lines_vbArray=[],this._fill_ibArray=[],this._fill_vbArray=[]}r(t,"laya.layagl.cmdNative.DrawPathCmdNative");var e=t.prototype;return e._arcTo=function(t){var e=t[1],i=t[2],_=t[3],r=t[4],a=t[5],n=0,s=0,o=0,h=this._lastOriX-e,u=this._lastOriY-i,l=Math.sqrt(h*h+u*u);if(!(1e-6>=l)){var c=h/l,f=u/l,d=_-e,E=r-i,A=d*d+E*E,D=Math.sqrt(A);if(!(1e-6>=D)){var R=d/D,m=E/D,T=c+R,v=f+m,P=Math.sqrt(T*T+v*v);if(!(1e-6>=P)){var p=T/P,C=v/P,M=Math.acos(p*c+C*f),O=Math.PI/2-M;l=a/Math.tan(O);var L=l*c+e,y=l*f+i,S=Math.sqrt(l*l+a*a),g=e+p*S,b=i+C*S,B=c*m-f*R,I=0,x=0,N=0;if(B>=0){I=2*O;var F=I/this.SEGNUM;x=Math.sin(F),N=Math.cos(F)}else I=2*-O,F=I/this.SEGNUM,x=Math.sin(F),N=Math.cos(F);var V=this._lastOriX,w=this._lastOriY,U=L-g,W=y-b;for(n=0;n<this.SEGNUM;n++){var G=U*N+W*x,X=-U*x+W*N;s=G+g,o=X+b,(Math.abs(V-s)>.1||Math.abs(w-o)>.1)&&(this._points.push(s),this._points.push(o)),U=G,W=X}}}}},e.recover=function(){this._paths=null,this._brush=null,this._pen=null,this._points.length=0,this._lines_ibArray.length=0,this._lines_vbArray.length=0,this._fill_ibArray.length=0,this._fill_vbArray.length=0,C.recover("DrawPathCmd",this)},a(0,e,"cmdID",function(){return"DrawPath"}),a(0,e,"paths",function(){return this._paths},function(t){this._paths=t}),a(0,e,"x",function(){return this._x},function(t){this._x=t;for(var e=this.lines_vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._lines_vbArray[2*_]+t,i++,i++;K.syncBufferToRenderThread(this.lines_vbBuffer)}),a(0,e,"y",function(){return this._y},function(t){this._y=t;for(var e=this.lines_vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._lines_vbArray[2*_+1]+t,i++;K.syncBufferToRenderThread(this.lines_vbBuffer)}),a(0,e,"brush",function(){return this._brush},function(e){this._brush||(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=t._DRAW_LINES_FILL_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._brush=e;var i=this._vertNum,_=me.earcut(this._points,null,2);if(_.length>0){(!this.fill_ibBuffer||this.fill_ibBuffer.getByteLength()<2*_.length)&&(this.fill_ibBuffer=new ParamData(2*_.length,!0,!0)),this._fill_ibSize=2*_.length;for(var r=this.fill_ibBuffer._int16Data,a=0,n=0;n<_.length;n++)r[a++]=_[n]}var s=u.create(e.fillStyle),o=s.numColor;(!this.fill_vbBuffer||this.fill_vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.fill_vbBuffer=new ParamData(3*i*4,!0)),this._fill_vbSize=3*this._vertNum*4;for(var h=this.fill_vbBuffer._float32Data,l=this.fill_vbBuffer._int32Data,c=0,f=0;f<this._vertNum;f++)h[c++]=this._points[2*f]+this.x,h[c++]=this._points[2*f+1]+this.y,l[c++]=o;var d=this._paramData._int32Data;d[t._PARAM_FILL_VB_POS_]=this.fill_vbBuffer.getPtrID(),d[t._PARAM_FILL_IB_POS_]=this.fill_ibBuffer.getPtrID(),d[t._PARAM_FILL_VB_SIZE_POS_]=this._fill_vbSize,d[t._PARAM_FILL_IB_SIZE_POS_]=this._fill_ibSize,K.syncBufferToRenderThread(this.fill_vbBuffer),K.syncBufferToRenderThread(this.fill_ibBuffer),K.syncBufferToRenderThread(this._paramData)}),a(0,e,"pen",function(){return this._pen},function(e){this._pen=e,this._lines_ibArray.length=0,this._lines_vbArray.length=0,Re.createLine2(this._points,this._lines_ibArray,e.lineWidth,0,this._lines_vbArray,!1);var i=u.create(e.strokeStyle),_=i.numColor,r=this._vertNum;(!this.lines_vbBuffer||this.lines_vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.lines_vbBuffer=new ParamData(3*r*4,!0)),this._lines_vbSize=3*this._vertNum*4;for(var a=this.lines_vbBuffer._float32Data,n=this.lines_vbBuffer._int32Data,s=0,o=0;o<this._vertNum;o++)a[s++]=this._lines_vbArray[2*o]+this.x,a[s++]=this._lines_vbArray[2*o+1]+this.y,n[s++]=_;(!this.lines_ibBuffer||this.lines_ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.lines_ibBuffer=new ParamData(3*(r-2)*2,!0,!0)),this._lines_ibSize=3*(this._vertNum-2)*2;for(var h=this.lines_ibBuffer._int16Data,l=0;l<3*(this._vertNum-2);l++)h[l]=this._lines_ibArray[l];n=this._paramData._int32Data,n[t._PARAM_LINES_VB_POS_]=this.lines_vbBuffer.getPtrID(),n[t._PARAM_LINES_IB_POS_]=this.lines_ibBuffer.getPtrID(),n[t._PARAM_LINES_VB_SIZE_POS_]=this._lines_vbSize,n[t._PARAM_LINES_IB_SIZE_POS_]=this._lines_ibSize,K.syncBufferToRenderThread(this.lines_vbBuffer),K.syncBufferToRenderThread(this.lines_ibBuffer),K.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,_,r,a){var n=C.getItemByClass("DrawPathCmd",t);n._graphicsCmdEncoder=this._commandEncoder,t._DRAW_LINES_CMD_ENCODER_||(t._DRAW_LINES_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),t._DRAW_LINES_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_LINES_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_LINES_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_LINES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_LINES_VB_POS_,4*t._PARAM_LINE_VB_OFFSET_POS_,4*t._PARAM_LINES_VB_SIZE_POS_,4*t._PARAM_LINES_IB_POS_,4*t._PARAM_LINE_IB_OFFSET_POS_,4*t._PARAM_LINES_IB_SIZE_POS_,4*t._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_LINES_CMD_ENCODER_)),t._DRAW_FILL_CMD_ENCODER_||(t._DRAW_FILL_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),t._DRAW_FILL_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_FILL_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_FILL_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_FILL_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_FILL_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_FILL_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_FILL_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_FILL_VB_POS_,4*t._PARAM_FILL_VB_OFFSET_POS_,4*t._PARAM_FILL_VB_SIZE_POS_,4*t._PARAM_FILL_IB_POS_,4*t._PARAM_FILL_IB_OFFSET_POS_,4*t._PARAM_FILL_IB_SIZE_POS_,4*t._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_FILL_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_FILL_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_FILL_CMD_ENCODER_)),t._DRAW_LINES_FILL_CMD_ENCODER_||(t._DRAW_LINES_FILL_CMD_ENCODER_=K.instance.createCommandEncoder(136,32,!0),t._DRAW_LINES_FILL_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_LINES_FILL_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_LINES_FILL_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_LINES_FILL_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_FILL_VB_POS_,4*t._PARAM_FILL_VB_OFFSET_POS_,4*t._PARAM_FILL_VB_SIZE_POS_,4*t._PARAM_FILL_IB_POS_,4*t._PARAM_FILL_IB_OFFSET_POS_,4*t._PARAM_FILL_IB_SIZE_POS_,4*t._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),t._DRAW_LINES_FILL_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_LINES_VB_POS_,4*t._PARAM_LINE_VB_OFFSET_POS_,4*t._PARAM_LINES_VB_SIZE_POS_,4*t._PARAM_LINES_IB_POS_,4*t._PARAM_LINE_IB_OFFSET_POS_,4*t._PARAM_LINES_IB_SIZE_POS_,4*t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_LINES_FILL_CMD_ENCODER_)),n._paramData||(n._paramData=new ParamData(60,!0)),n._x=e,n._y=i,n._paths=_,n._brush=r,n._pen=a;for(var s=0,o=_.length;o>s;s++){var h=_[s];switch(0==s&&(n._startOriX=h[1],n._startOriY=h[2]),h[0]){case"moveTo":n._lastOriX=h[1],n._lastOriY=h[2],n._points.push(h[1]),n._points.push(h[2]);break;case"lineTo":n._lastOriX=h[1],n._lastOriY=h[2],n._points.push(h[1]),n._points.push(h[2]);break;case"arcTo":n._arcTo(h);break;case"closePath":n._points.push(n._startOriX),n._points.push(n._startOriY)}}if(n._vertNum=n._points.length,a){Re.createLine2(n._points,n._lines_ibArray,a.lineWidth,0,n._lines_vbArray,!1);var l=u.create(a.strokeStyle),c=l.numColor,f=n._vertNum;(!n.lines_vbBuffer||n.lines_vbBuffer.getByteLength()<3*n._vertNum*4)&&(n.lines_vbBuffer=new ParamData(3*f*4,!0)),n._lines_vbSize=3*n._vertNum*4;var d=n.lines_vbBuffer._float32Data,E=n.lines_vbBuffer._int32Data,A=0;for(s=0;s<n._vertNum;s++)d[A++]=n._lines_vbArray[2*s]+e,d[A++]=n._lines_vbArray[2*s+1]+i,E[A++]=c;(!n.lines_ibBuffer||n.lines_ibBuffer.getByteLength()<3*(n._vertNum-2)*2)&&(n.lines_ibBuffer=new ParamData(3*(f-2)*2,!0,!0)),n._lines_ibSize=3*(n._vertNum-2)*2;for(var D=n.lines_ibBuffer._int16Data,R=0;R<3*(n._vertNum-2);R++)D[R]=n._lines_ibArray[R]}if(r){f=n._vertNum;var m=me.earcut(n._points,null,2);if(m.length>0){(!n.fill_ibBuffer||n.fill_ibBuffer.getByteLength()<2*m.length)&&(n.fill_ibBuffer=new ParamData(2*m.length,!0,!0)),n._fill_ibSize=2*m.length,D=n.fill_ibBuffer._int16Data;var T=0;for(R=0;R<m.length;R++)D[T++]=m[R]}l=u.create(r.fillStyle),c=l.numColor,(!n.fill_vbBuffer||n.fill_vbBuffer.getByteLength()<3*n._vertNum*4)&&(n.fill_vbBuffer=new ParamData(3*f*4,!0)),n._fill_vbSize=3*n._vertNum*4,d=n.fill_vbBuffer._float32Data;var v=n.fill_vbBuffer._int32Data;for(v=n.fill_vbBuffer._int32Data,A=0,s=0;s<n._vertNum;s++)d[A++]=n._points[2*s]+e,d[A++]=n._points[2*s+1]+i,v[A++]=c}n._paramData._float32Data;return E=n._paramData._int32Data,E[0]=1,a&&(E[t._PARAM_LINES_VB_POS_]=n.lines_vbBuffer.getPtrID(),E[t._PARAM_LINES_IB_POS_]=n.lines_ibBuffer.getPtrID(),E[t._PARAM_LINES_VB_SIZE_POS_]=n._lines_vbSize,E[t._PARAM_LINES_IB_SIZE_POS_]=n._lines_ibSize,E[t._PARAM_LINE_VB_OFFSET_POS_]=0,E[t._PARAM_LINE_IB_OFFSET_POS_]=0,E[t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(n.lines_vbBuffer),K.syncBufferToRenderThread(n.lines_ibBuffer)),r&&(E[t._PARAM_FILL_VB_POS_]=n.fill_vbBuffer.getPtrID(),E[t._PARAM_FILL_IB_POS_]=n.fill_ibBuffer.getPtrID(),E[t._PARAM_FILL_VB_SIZE_POS_]=n._fill_vbSize,E[t._PARAM_FILL_IB_SIZE_POS_]=n._fill_ibSize,E[t._PARAM_FILL_VB_OFFSET_POS_]=0,E[t._PARAM_FILL_IB_OFFSET_POS_]=0,E[t._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(n.fill_vbBuffer),K.syncBufferToRenderThread(n.fill_ibBuffer)),K.syncBufferToRenderThread(n._paramData),r&&a?n._cmdCurrentPos=n._graphicsCmdEncoder.useCommandEncoder(t._DRAW_LINES_FILL_CMD_ENCODER_.getPtrID(),n._paramData.getPtrID(),-1):r&&!a?n._cmdCurrentPos=n._graphicsCmdEncoder.useCommandEncoder(t._DRAW_FILL_CMD_ENCODER_.getPtrID(),n._paramData.getPtrID(),-1):!r&&a&&(n._cmdCurrentPos=n._graphicsCmdEncoder.useCommandEncoder(t._DRAW_LINES_CMD_ENCODER_.getPtrID(),n._paramData.getPtrID(),-1)),K.syncBufferToRenderThread(n._graphicsCmdEncoder),n},t.ID="DrawPath",t._DRAW_LINES_CMD_ENCODER_=null,t._DRAW_LINES_FILL_CMD_ENCODER_=null,t._DRAW_FILL_CMD_ENCODER_=null,t._PARAM_LINES_VB_POS_=1,t._PARAM_LINES_IB_POS_=2,t._PARAM_LINES_VB_SIZE_POS_=3,t._PARAM_LINES_IB_SIZE_POS_=4,t._PARAM_FILL_VB_POS_=5,t._PARAM_FILL_IB_POS_=6,t._PARAM_FILL_VB_SIZE_POS_=7,t._PARAM_FILL_IB_SIZE_POS_=8,t._PARAM_FILL_VB_OFFSET_POS_=9,t._PARAM_FILL_IB_OFFSET_POS_=10,t._PARAM_LINE_VB_OFFSET_POS_=11,t._PARAM_LINE_IB_OFFSET_POS_=12,t._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_=13,t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=14,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._paramData=null,this._paramID=null,this._x=0/0,this._y=0/0,this._radius=0/0,this._startAngle=0/0,this._endAngle=0/0,this._fillColor=null,this._lineColor=null,this._lineWidth=0/0,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]
}r(t,"laya.layagl.cmdNative.DrawPieCmdNative");var e=t.prototype;return e._arc=function(t,e,i,_,r,a,n){void 0===a&&(a=!1),void 0===n&&(n=!0);var s=[];s.push(0),s.push(0);var o=0,h=0,u=0,l=0,c=0,f=0,d=0,E=0,A=0,D=0,R=0;if(h=r-_,a)if(Math.abs(h)>=2*Math.PI)h=2*-Math.PI;else for(;h>0;)h-=2*Math.PI;else if(Math.abs(h)>=2*Math.PI)h=2*Math.PI;else for(;0>h;)h+=2*Math.PI;D=101>i?Math.max(10,h*i/5):201>i?Math.max(10,h*i/20):Math.max(10,h*i/40),u=h/D/2,l=Math.abs(4/3*(1-Math.cos(u))/Math.sin(u)),a&&(l=-l),R=0;var m=0,T=0;for(A=0;D>=A;A++)o=_+h*(A/D),c=Math.cos(o),f=Math.sin(o),d=t+c*i,E=e+f*i,(d!=m||E!=T)&&(s.push(d),s.push(E)),m=d,T=E;return c=Math.cos(r),f=Math.sin(r),d=t+c*i,E=e+f*i,(d!=m||E!=T)&&(s.push(d),s.push(E)),s},e._setData=function(t,e,i,_,r,a){this._vertNum=_.length/2;var n=this._vertNum,s=0,o=this._vertNum-2;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*o*2)&&(this.ibBuffer=new ParamData(3*o*2,!0,!0)),this._ibSize=3*o*2;for(var h=this.ibBuffer._int16Data,l=0,c=0;o>c;c++)h[l++]=s,h[l++]=c+1+s,h[l++]=c+2+s;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*n*4,!0)),this._vbSize=3*this._vertNum*4;for(var f=u.create(i),d=f.numColor,E=this.vbBuffer._float32Data,A=this.vbBuffer._int32Data,D=0,R=0;R<this._vertNum;R++)E[D++]=_[2*R]+t,E[D++]=_[2*R+1]+e,A[D++]=d;var m=0;for(this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0,R=0;R<_.length;R++)this._linePoints.push(_[R]);if(this._linePoints.push(_[0]),this._linePoints.push(_[1]),r){Re.createLine2(this._linePoints,this._line_ibArray,a,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,m=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(m-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;var T=this.line_ibBuffer._int16Data;l=0;for(var v=0;v<3*(this._line_vertNum-2);v++)T[l++]=this._line_ibArray[v];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*m*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var P=u.create(r),p=P.numColor,C=this.line_vbBuffer._float32Data,M=this.line_vbBuffer._int32Data;for(D=0,R=0;R<this._line_vertNum;R++)C[D++]=this._line_vbArray[2*R]+this._x,C[D++]=this._line_vbArray[2*R+1]+this._y,M[D++]=p}else{this._lineWidth=1;var O="#FFFFFF";for(Re.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,m=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(m-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2,T=this.line_ibBuffer._int16Data,l=0,v=0;v<3*(this._line_vertNum-2);v++)T[l++]=this._line_ibArray[v];for((!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*m*4,!0)),this._line_vbSize=3*this._line_vertNum*4,P=u.create(O),p=P.numColor,C=this.line_vbBuffer._float32Data,M=this.line_vbBuffer._int32Data,D=0,R=0;R<this._line_vertNum;R++)C[D++]=this._line_vbArray[2*R]+this._x,C[D++]=this._line_vbArray[2*R+1]+this._y,M[D++]=p}},e._saveToParamData=function(){var e=(this._paramData._float32Data,this._paramData._int32Data);e[0]=1,e[1]=32,e[t._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),e[t._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),e[t._PARAM_VB_SIZE_POS_]=this._vbSize,e[t._PARAM_IB_SIZE_POS_]=this._ibSize,e[t._PARAM_VB_OFFSET_POS_]=0,e[t._PARAM_IB_OFFSET_POS_]=0,e[t._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this.ibBuffer),e[t._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),e[t._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),e[t._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,e[t._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,e[t._PARAM_LINE_VB_OFFSET_POS_]=0,e[t._PARAM_LINE_IB_OFFSET_POS_]=0,e[t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(this.line_vbBuffer),K.syncBufferToRenderThread(this.line_ibBuffer)},e.recover=function(){this._fillColor=null,this._lineColor=null,this._points.length=0,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,C.recover("DrawPieCmd",this)},a(0,e,"lineColor",function(){return this._lineColor},function(e){!this._lineColor&&this._lineWidth&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=t._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineColor=e,this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;for(var i=0;i<this._points.length;i++)this._linePoints.push(this._points[i]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Re.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var _=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(_-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var r=this.line_ibBuffer._int16Data,a=0,n=0;n<3*(this._line_vertNum-2);n++)r[a++]=this._line_ibArray[n];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*_*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var s=u.create(e),o=s.numColor,h=this.line_vbBuffer._float32Data,l=this.line_vbBuffer._int32Data,c=0;for(i=0;i<this._line_vertNum;i++)h[c++]=this._line_vbArray[2*i]+this._x,h[c++]=this._line_vbArray[2*i+1]+this._y,l[c++]=o;K.syncBufferToRenderThread(this.line_ibBuffer),K.syncBufferToRenderThread(this.line_vbBuffer)}),a(0,e,"startAngle",function(){return 180*this._startAngle/Math.PI},function(t){this._startAngle=t*Math.PI/180,this._points=this._arc(0,0,this._radius,t*Math.PI/180,this._endAngle),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),K.syncBufferToRenderThread(this._paramData)}),a(0,e,"cmdID",function(){return"DrawPie"}),a(0,e,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=u.create(this._fillColor),i=e.numColor,_=this.vbBuffer._int32Data,r=0,a=0;a<this._vertNum;a++)r++,r++,_[r++]=i;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._points[2*_]+this._x,i++,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(i=0,_=0;_<this._line_vertNum;_++)r[i++]=this._line_vbArray[2*_]+this._x,i++,i++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._points[2*_+1]+this._y,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(i=0,_=0;_<this._line_vertNum;_++)i++,r[i++]=this._line_vbArray[2*_+1]+this._y,i++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"radius",function(){return this._radius},function(t){this._points=this._arc(0,0,t,this._startAngle,this._endAngle),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),K.syncBufferToRenderThread(this._paramData)}),a(0,e,"endAngle",function(){return 180*this._endAngle/Math.PI},function(t){this._endAngle=t*Math.PI/180,this._points=this._arc(0,0,this._radius,this._startAngle,t*Math.PI/180),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),K.syncBufferToRenderThread(this._paramData)}),a(0,e,"lineWidth",function(){return this._lineWidth},function(e){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=t._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=e,this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;for(var i=0;i<this._points.length;i++)this._linePoints.push(this._points[i]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Re.createLine2(this._linePoints,this._line_ibArray,e,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var _=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(_-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var r=this.line_ibBuffer._int16Data,a=0,n=0;n<3*(this._line_vertNum-2);n++)r[a++]=this._line_ibArray[n];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*_*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var s=u.create(this.lineColor),o=s.numColor,h=this.line_vbBuffer._float32Data,l=this.line_vbBuffer._int32Data,c=0;for(i=0;i<this._line_vertNum;i++)h[c++]=this._line_vbArray[2*i]+this._x,h[c++]=this._line_vbArray[2*i+1]+this._y,l[c++]=o;K.syncBufferToRenderThread(this.line_ibBuffer),K.syncBufferToRenderThread(this.line_vbBuffer)}),t.create=function(e,i,_,r,a,n,s,o){var h=C.getItemByClass("DrawPieCmd",t);return h._graphicsCmdEncoder=this._commandEncoder,t._DRAW_PIE_LINES_CMD_ENCODER_||(t._DRAW_PIE_LINES_CMD_ENCODER_=K.instance.createCommandEncoder(140,32,!0),t._DRAW_PIE_LINES_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_PIE_LINES_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_PIE_LINES_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_PIE_LINES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_OFFSET_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_OFFSET_POS_,4*t._PARAM_IB_SIZE_POS_,4*t._PARAM_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),t._DRAW_PIE_LINES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_LINE_VB_POS_,4*t._PARAM_LINE_VB_OFFSET_POS_,4*t._PARAM_LINE_VB_SIZE_POS_,4*t._PARAM_LINE_IB_POS_,4*t._PARAM_LINE_IB_OFFSET_POS_,4*t._PARAM_LINE_IB_SIZE_POS_,4*t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_PIE_LINES_CMD_ENCODER_)),t._DRAW_PIE_CMD_ENCODER_||(t._DRAW_PIE_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),t._DRAW_PIE_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_PIE_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_PIE_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_PIE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_PIE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_PIE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_PIE_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_OFFSET_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_OFFSET_POS_,4*t._PARAM_IB_SIZE_POS_,4*t._PARAM_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_PIE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_PIE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_PIE_CMD_ENCODER_)),h._paramData||(h._paramData=new ParamData(64,!0)),h._x=e,h._y=i,h._radius=_,h._startAngle=r,h._endAngle=a,h._fillColor=n,h._lineColor=s,h._lineWidth=o,h._points=h._arc(0,0,_,r,a),h._setData(e,i,n,h._points,s,o),h._saveToParamData(),K.syncBufferToRenderThread(h._paramData),h._cmdCurrentPos=s?h._graphicsCmdEncoder.useCommandEncoder(t._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1):h._graphicsCmdEncoder.useCommandEncoder(t._DRAW_PIE_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1),K.syncBufferToRenderThread(h._graphicsCmdEncoder),h},t.ID="DrawPie",t._DRAW_PIE_CMD_ENCODER_=null,t._DRAW_PIE_LINES_CMD_ENCODER_=null,t._PARAM_VB_POS_=2,t._PARAM_IB_POS_=3,t._PARAM_LINE_VB_POS_=4,t._PARAM_LINE_IB_POS_=5,t._PARAM_VB_SIZE_POS_=6,t._PARAM_IB_SIZE_POS_=7,t._PARAM_LINE_VB_SIZE_POS_=8,t._PARAM_LINE_IB_SIZE_POS_=9,t._PARAM_VB_OFFSET_POS_=10,t._PARAM_IB_OFFSET_POS_=11,t._PARAM_LINE_VB_OFFSET_POS_=12,t._PARAM_LINE_IB_OFFSET_POS_=13,t._PARAM_INDEX_ELEMENT_OFFSET_POS_=14,t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=15,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._graphicsCmdEncoder_lines=null,this._paramData=null,this._x=0/0,this._y=0/0,this._points=null,this._fillColor=null,this._lineColor=null,this._lineWidth=0/0,this._isConvexPolygon=!1,this._vid=0,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}r(t,"laya.layagl.cmdNative.DrawPolyCmdNative");var e=t.prototype;return e.recover=function(){this._points=null,this._fillColor=null,this._lineColor=null,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,C.recover("DrawPolyCmd",this)},a(0,e,"lineColor",function(){return this._lineColor},function(e){if(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=t._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder),this._lineColor=e,this._lineColor&&this.line_vbBuffer){for(var i=u.create(this._lineColor),_=i.numColor,r=this.line_vbBuffer._int32Data,a=0,n=0;n<this._line_vertNum;n++)a++,a++,r[a++]=_;K.syncBufferToRenderThread(this.line_vbBuffer)}}),a(0,e,"points",function(){return this._points},function(e){this._points=e,this._vertNum=e.length/2;var i=this._vertNum,_=me.earcut(e,null,2);if(_.length>0){(!this.ibBuffer||this.ibBuffer.getByteLength()<2*_.length)&&(this.ibBuffer=new ParamData(2*_.length,!0,!0)),this._ibSize=2*_.length;for(var r=this.ibBuffer._int16Data,a=0,n=0;n<_.length;n++)r[a++]=_[n]}(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*i*4,!0)),this._vbSize=3*this._vertNum*4;for(var s=u.create(this._fillColor),o=s.numColor,h=this.vbBuffer._float32Data,l=this.vbBuffer._int32Data,c=0,f=0;f<this._vertNum;f++)h[c++]=this._points[2*f]+this._x,h[c++]=this._points[2*f+1]+this._y,l[c++]=o;var d=this._paramData._int32Data;if(d[t._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),d[t._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),d[t._PARAM_VB_SIZE_POS_]=this._vbSize,d[t._PARAM_IB_SIZE_POS_]=this._ibSize,K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this.ibBuffer),K.syncBufferToRenderThread(this._paramData),this.lineColor){var E=0;for(this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0,f=0;f<e.length;f++)this._linePoints.push(e[f]);this._linePoints.push(e[0]),this._linePoints.push(e[1]),Re.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,E=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(E-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;var A=this.line_ibBuffer._int16Data;for(a=0,n=0;n<3*(this._line_vertNum-2);n++)A[a++]=this._line_ibArray[n];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*E*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var D=u.create(this._lineColor),R=D.numColor,m=this.line_vbBuffer._float32Data,T=this.line_vbBuffer._int32Data;for(c=0,f=0;f<this._line_vertNum;f++)m[c++]=this._line_vbArray[2*f]+this._x,m[c++]=this._line_vbArray[2*f+1]+this._y,T[c++]=R;d=this._paramData._int32Data,d[t._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),d[t._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),d[t._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,d[t._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,K.syncBufferToRenderThread(this.line_vbBuffer),K.syncBufferToRenderThread(this.line_ibBuffer)}}),a(0,e,"cmdID",function(){return"DrawPoly"}),a(0,e,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=u.create(this._fillColor),i=e.numColor,_=this.vbBuffer._int32Data,r=0,a=0;a<this._vertNum;a++)r++,r++,_[r++]=i;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._points[2*_]+this._x,i++,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(i=0,_=0;_<this._line_vertNum;_++)r[i++]=this._line_vbArray[2*_]+this._x,i++,i++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"isConvexPolygon",function(){return this._isConvexPolygon},function(t){this._isConvexPolygon=t}),a(0,e,"vid",function(){return this._vid},function(t){this._vid=t}),a(0,e,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._points[2*_+1]+this._y,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(i=0,_=0;_<this._line_vertNum;_++)i++,r[i++]=this._line_vbArray[2*_+1]+this._y,i++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"lineWidth",function(){return this._lineWidth},function(e){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=t._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=e,this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;for(var i=0;i<this._points.length;i++)this._linePoints.push(this._points[i]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Re.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);var _=this.line_vbBuffer._float32Data,r=0;for(i=0;i<this._line_vertNum;i++)_[r++]=this._line_vbArray[2*i]+this._x,_[r++]=this._line_vbArray[2*i+1]+this._y,r++;K.syncBufferToRenderThread(this.line_vbBuffer)}),t.create=function(e,i,_,r,a,n,s){var o=C.getItemByClass("DrawPolyCmd",t);o._graphicsCmdEncoder=this._commandEncoder,t._DRAW_POLY_CMD_ENCODER_||(t._DRAW_POLY_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),t._DRAW_POLY_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_POLY_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_POLY_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_POLY_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_POLY_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_POLY_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_POLY_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_OFFSET_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_OFFSET_POS_,4*t._PARAM_IB_SIZE_POS_,4*t._PARAM_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_POLY_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_POLY_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_POLY_CMD_ENCODER_)),t._DRAW_POLY_LINES_CMD_ENCODER_||(t._DRAW_POLY_LINES_CMD_ENCODER_=K.instance.createCommandEncoder(140,32,!0),t._DRAW_POLY_LINES_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_POLY_LINES_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_POLY_LINES_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_POLY_LINES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_OFFSET_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_OFFSET_POS_,4*t._PARAM_IB_SIZE_POS_,4*t._PARAM_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),t._DRAW_POLY_LINES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_LINE_VB_POS_,4*t._PARAM_LINE_VB_OFFSET_POS_,4*t._PARAM_LINE_VB_SIZE_POS_,4*t._PARAM_LINE_IB_POS_,4*t._PARAM_LINE_VB_OFFSET_POS_,4*t._PARAM_LINE_IB_SIZE_POS_,4*t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_POLY_LINES_CMD_ENCODER_)),o._paramData||(o._paramData=new ParamData(68,!0)),o._x=e,o._y=i,o._points=_,o._fillColor=r,o._lineColor=a,o._lineWidth=n,o._isConvexPolygon=s,o._vertNum=_.length/2;var h=o._vertNum,l=me.earcut(_,null,2);if(l.length>0){(!o.ibBuffer||o.ibBuffer.getByteLength()<2*l.length)&&(o.ibBuffer=new ParamData(2*l.length,!0,!0)),o._ibSize=2*l.length;for(var c=o.ibBuffer._int16Data,f=0,d=0;d<l.length;d++)c[f++]=l[d]}var E=u.create(r),A=E.numColor;(!o.vbBuffer||o.vbBuffer.getByteLength()<3*o._vertNum*4)&&(o.vbBuffer=new ParamData(3*h*4,!0)),o._vbSize=3*o._vertNum*4;for(var D=o.vbBuffer._float32Data,R=o.vbBuffer._int32Data,m=0,T=0;T<o._vertNum;T++)D[m++]=_[2*T]+e,D[m++]=_[2*T+1]+i,R[m++]=A;for(T=0;T<_.length;T++)o._linePoints.push(_[T]);if(o._linePoints.push(_[0]),o._linePoints.push(_[1]),a){Re.createLine2(o._linePoints,o._line_ibArray,n,0,o._line_vbArray,!1),o._line_vertNum=o._linePoints.length;var v=o._line_vertNum;(!o.line_ibBuffer||o.line_ibBuffer.getByteLength()<3*(o._line_vertNum-2)*2)&&(o.line_ibBuffer=new ParamData(3*(v-2)*2,!0,!0)),o._line_ibSize=3*(o._line_vertNum-2)*2;var P=o.line_ibBuffer._int16Data;for(f=0,d=0;d<3*(o._line_vertNum-2);d++)P[f++]=o._line_ibArray[d];(!o.line_vbBuffer||o.line_vbBuffer.getByteLength()<3*o._line_vertNum*4)&&(o.line_vbBuffer=new ParamData(3*v*4,!0)),o._line_vbSize=3*o._line_vertNum*4;var p=u.create(a),M=p.numColor,O=o.line_vbBuffer._float32Data,L=o.line_vbBuffer._int32Data;for(m=0,T=0;T<o._line_vertNum;T++)O[m++]=o._line_vbArray[2*T]+e,O[m++]=o._line_vbArray[2*T+1]+i,L[m++]=M}else{o._lineWidth=1;var y="#ffffff";for(Re.createLine2(o._linePoints,o._line_ibArray,o._lineWidth,0,o._line_vbArray,!1),o._line_vertNum=o._linePoints.length,v=o._line_vertNum,(!o.line_ibBuffer||o.line_ibBuffer.getByteLength()<3*(o._line_vertNum-2)*2)&&(o.line_ibBuffer=new ParamData(3*(v-2)*2,!0,!0)),o._line_ibSize=3*(o._line_vertNum-2)*2,P=o.line_ibBuffer._int16Data,f=0,d=0;d<3*(o._line_vertNum-2);d++)P[f++]=o._line_ibArray[d];for((!o.line_vbBuffer||o.line_vbBuffer.getByteLength()<3*o._line_vertNum*4)&&(o.line_vbBuffer=new ParamData(3*v*4,!0)),o._line_vbSize=3*o._line_vertNum*4,p=u.create(y),M=p.numColor,O=o.line_vbBuffer._float32Data,L=o.line_vbBuffer._int32Data,m=0,T=0;T<o._line_vertNum;T++)O[m++]=o._line_vbArray[2*T]+e,O[m++]=o._line_vbArray[2*T+1]+i,L[m++]=M}var S=o._paramData._float32Data,g=o._paramData._int32Data;return g[0]=1,g[1]=32,null==o.ibBuffer?null:(g[t._PARAM_VB_POS_]=o.vbBuffer.getPtrID(),g[t._PARAM_IB_POS_]=o.ibBuffer.getPtrID(),g[t._PARAM_VB_SIZE_POS_]=o._vbSize,g[t._PARAM_IB_SIZE_POS_]=o._ibSize,g[t._PARAM_VB_OFFSET_POS_]=0,g[t._PARAM_IB_OFFSET_POS_]=0,g[t._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,S[t._PARAM_ISCONVEXT_POS_]=s,K.syncBufferToRenderThread(o.vbBuffer),K.syncBufferToRenderThread(o.ibBuffer),g[t._PARAM_LINE_VB_POS_]=o.line_vbBuffer.getPtrID(),g[t._PARAM_LINE_IB_POS_]=o.line_ibBuffer.getPtrID(),g[t._PARAM_LINE_VB_SIZE_POS_]=o._line_vbSize,g[t._PARAM_LINE_IB_SIZE_POS_]=o._line_ibSize,g[t._PARAM_LINE_VB_OFFSET_POS_]=0,g[t._PARAM_LINE_IB_OFFSET_POS_]=0,g[t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(o.line_vbBuffer),K.syncBufferToRenderThread(o.line_ibBuffer),K.syncBufferToRenderThread(o._paramData),o._cmdCurrentPos=a?o._graphicsCmdEncoder.useCommandEncoder(t._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1):o._graphicsCmdEncoder.useCommandEncoder(t._DRAW_POLY_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1),K.syncBufferToRenderThread(o._graphicsCmdEncoder),o)},t.ID="DrawPoly",t._DRAW_POLY_CMD_ENCODER_=null,t._DRAW_POLY_LINES_CMD_ENCODER_=null,t._PARAM_VB_POS_=2,t._PARAM_IB_POS_=3,t._PARAM_VB_SIZE_POS_=4,t._PARAM_IB_SIZE_POS_=5,t._PARAM_LINE_VB_POS_=6,t._PARAM_LINE_IB_POS_=7,t._PARAM_LINE_VB_SIZE_POS_=8,t._PARAM_LINE_IB_SIZE_POS_=9,t._PARAM_ISCONVEXT_POS_=10,t._PARAM_VB_OFFSET_POS_=11,t._PARAM_IB_OFFSET_POS_=12,t._PARAM_LINE_VB_OFFSET_POS_=13,t._PARAM_LINE_IB_OFFSET_POS_=14,t._PARAM_INDEX_ELEMENT_OFFSET_POS_=15,t._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=16,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._x=0/0,this._y=0/0,this._width=0/0,this._height=0/0,this._fillColor=null,this._lineColor=null,this._lineWidth=0/0,this._line_vertNum=0,this._cmdCurrentPos=0,this._linePoints=[],this._line_ibArray=[],this._line_vbArray=[]}r(t,"laya.layagl.cmdNative.DrawRectCmdNative");var e=t.prototype;return e.recover=function(){this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0,this._graphicsCmdEncoder=null,C.recover("DrawRectCmd",this)},a(0,e,"lineColor",function(){return this._lineColor},function(e){this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=t._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder),this._lineColor=e;for(var i=this._paramData._int32Data,_=u.create(e),r=_.numColor,a=t._PARAM_LINE_VB_POS_,n=0;n<this._line_vertNum;n++)a++,a++,i[a++]=r;K.syncBufferToRenderThread(this._paramData)}),a(0,e,"cmdID",function(){return"DrawRect"}),a(0,e,"fillColor",function(){return this._fillColor},function(e){if(this._fillColor=e,"string"==typeof e){var i=u.create(this._fillColor),_=i.numColor,r=this._paramData._int32Data;r[t._PARAM_VB_POS_+4]=_,r[t._PARAM_VB_POS_+10]=_,r[t._PARAM_VB_POS_+16]=_,r[t._PARAM_VB_POS_+22]=_}else r=this._paramData._int32Data,r[t._PARAM_VB_POS_+4]=e,r[t._PARAM_VB_POS_+10]=e,r[t._PARAM_VB_POS_+16]=e,r[t._PARAM_VB_POS_+22]=e;K.syncBufferToRenderThread(this._paramData)}),a(0,e,"width",function(){return this._width},function(e){this._width=e;var i=this._paramData._float32Data;if(i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[2]=this._x+this._width,this._linePoints[4]=this._x+this._width,Re.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;for(var _=t._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)i[_++]=this._line_vbArray[2*r],i[_++]=this._line_vbArray[2*r+1],_++}K.syncBufferToRenderThread(this._paramData)}),a(0,e,"x",function(){return this._x},function(e){this._x=e;var i=this._paramData._float32Data;if(i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[0]=this._x,this._linePoints[2]=this._x+this._width,this._linePoints[4]=this._x+this._width,this._linePoints[6]=this._x,this._linePoints[8]=this._x,Re.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var _=t._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)i[_++]=this._line_vbArray[2*r],i[_++]=this._line_vbArray[2*r+1],_++}K.syncBufferToRenderThread(this._paramData)}),a(0,e,"y",function(){return this._y},function(e){this._y=e;var i=this._paramData._float32Data;if(i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[1]=this._y,this._linePoints[3]=this._y,this._linePoints[5]=this._y+this._height,this._linePoints[7]=this._y+this._height,this._linePoints[9]=this._y-this._lineWidth/2,Re.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var _=t._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)i[_++]=this._line_vbArray[2*r],i[_++]=this._line_vbArray[2*r+1],_++}K.syncBufferToRenderThread(this._paramData)}),a(0,e,"height",function(){return this._height},function(e){this._height=e;var i=this._paramData._float32Data;if(i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[5]=this._y+this._height,this._linePoints[7]=this._y+this._height,Re.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var _=t._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)i[_++]=this._line_vbArray[2*r],i[_++]=this._line_vbArray[2*r+1],_++}K.syncBufferToRenderThread(this._paramData)}),a(0,e,"lineWidth",function(){return this._lineWidth},function(e){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=t._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=e,this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[9]=this._y-this._lineWidth/2,Re.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;for(var i=this._paramData._float32Data,_=t._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)i[_++]=this._line_vbArray[2*r],i[_++]=this._line_vbArray[2*r+1],_++;K.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,_,r,a,n,s){var o=C.getItemByClass("DrawRectCmd",t);o._graphicsCmdEncoder=this._commandEncoder,t._DRAW_RECT_LINE_CMD_ENCODER_||(t._DRAW_RECT_LINE_CMD_ENCODER_=K.instance.createCommandEncoder(164,32,!0),t._DRAW_RECT_LINE_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_RECT_LINE_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),t._DRAW_RECT_LINE_CMD_ENCODER_.useVDO(te.VDO_MESHQUADTEXTURE),t._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_RECT_LINE_CMD_ENCODER_.setRectMeshByParamData(4*t._PARAM_RECT_NUM_POS_,4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_),t._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),t._DRAW_RECT_LINE_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWVG),t._DRAW_RECT_LINE_CMD_ENCODER_.useVDO(te.VDO_MESHVG),t._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_RECT_LINE_CMD_ENCODER_.setMeshByParamData(4*t._PARAM_LINE_VB_POS_,4*t._PARAM_LINE_VB_OFFSET_POS_,4*t._PARAM_LINE_VB_SIZE_POS_,4*t._PARAM_LINE_IB_POS_,4*t._PARAM_LINE_IB_OFFSET_POS_,4*t._PARAM_LINE_IB_SIZE_POS_,4*t._PARAM_LINE_IBELEMENT_OFFSET_POS_),t._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_RECT_LINE_CMD_ENCODER_)),t._DRAW_RECT_CMD_ENCODER_||(t._DRAW_RECT_CMD_ENCODER_=K.instance.createCommandEncoder(84,32,!0),t._DRAW_RECT_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_RECT_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),t._DRAW_RECT_CMD_ENCODER_.useVDO(te.VDO_MESHQUADTEXTURE),t._DRAW_RECT_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_RECT_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_RECT_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_RECT_CMD_ENCODER_.setRectMeshByParamData(4*t._PARAM_RECT_NUM_POS_,4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_),t._DRAW_RECT_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_RECT_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_RECT_CMD_ENCODER_)),o._paramData||(o._paramData=new ParamData(292,!0)),o._x=e,o._y=i,o._width=_,o._height=r,o._fillColor=a,o._lineColor=n,o._lineWidth=s;
var h=u.create(a),l=h.numColor,c=o._paramData._float32Data,f=o._paramData._int32Data;f[t._PARAM_RECT_NUM_POS_]=1,f[t._PARAM_VB_SIZE_POS_]=96;var d=t._PARAM_VB_POS_;if(c[d++]=e,c[d++]=i,c[d++]=0,c[d++]=0,f[d++]=l,c[d++]=4294967295,c[d++]=e+_,c[d++]=i,c[d++]=0,c[d++]=0,f[d++]=l,c[d++]=4294967295,c[d++]=e+_,c[d++]=i+r,c[d++]=0,c[d++]=0,f[d++]=l,c[d++]=4294967295,c[d++]=e,c[d++]=i+r,c[d++]=0,c[d++]=0,f[d++]=l,c[d++]=4294967295,o._linePoints.push(e),o._linePoints.push(i),o._linePoints.push(e+_),o._linePoints.push(i),o._linePoints.push(e+_),o._linePoints.push(i+r),o._linePoints.push(e),o._linePoints.push(i+r),o._linePoints.push(e),o._linePoints.push(i-s/2),n){Re.createLine2(o._linePoints,o._line_ibArray,s,0,o._line_vbArray,!1),o._line_vertNum=o._linePoints.length,f[t._PARAM_LINE_VB_SIZE_POS_]=120;var E=u.create(n),A=E.numColor;d=t._PARAM_LINE_VB_POS_;for(var D=0;D<o._line_vertNum;D++)c[d++]=o._line_vbArray[2*D],c[d++]=o._line_vbArray[2*D+1],f[d++]=A;f[t._PARAM_LINE_IB_SIZE_POS_]=2*o._line_ibArray.length;var R=o._paramData._int16Data;d=2*t._PARAM_LINE_IB_POS_;for(var m=0;m<o._line_ibArray.length;m++)R[d++]=o._line_ibArray[m]}else{o._lineWidth=1;var T="#ffffff";for(Re.createLine2(o._linePoints,o._line_ibArray,o._lineWidth,0,o._line_vbArray,!1),o._line_vertNum=o._linePoints.length,f[t._PARAM_LINE_VB_SIZE_POS_]=120,E=u.create(T),A=E.numColor,d=t._PARAM_LINE_VB_POS_,D=0;D<o._line_vertNum;D++)c[d++]=o._line_vbArray[2*D],c[d++]=o._line_vbArray[2*D+1],f[d++]=A;for(f[t._PARAM_LINE_IB_SIZE_POS_]=2*o._line_ibArray.length,R=o._paramData._int16Data,d=2*t._PARAM_LINE_IB_POS_,m=0;m<o._line_ibArray.length;m++)R[d++]=o._line_ibArray[m]}return f[t._PARAM_LINE_VB_OFFSET_POS_]=0,f[t._PARAM_LINE_IB_OFFSET_POS_]=0,f[t._PARAM_LINE_IBELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(o._paramData),o._cmdCurrentPos=n?o._graphicsCmdEncoder.useCommandEncoder(t._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1):o._graphicsCmdEncoder.useCommandEncoder(t._DRAW_RECT_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1),K.syncBufferToRenderThread(o._graphicsCmdEncoder),o},t.ID="DrawRect",t._DRAW_RECT_CMD_ENCODER_=null,t._DRAW_RECT_LINE_CMD_ENCODER_=null,t._PARAM_RECT_NUM_POS_=0,t._PARAM_VB_SIZE_POS_=1,t._PARAM_VB_POS_=2,t._PARAM_LINE_VB_SIZE_POS_=26,t._PARAM_LINE_VB_POS_=27,t._PARAM_LINE_IB_SIZE_POS_=57,t._PARAM_LINE_IB_POS_=58,t._PARAM_LINE_VB_OFFSET_POS_=70,t._PARAM_LINE_IB_OFFSET_POS_=71,t._PARAM_LINE_IBELEMENT_OFFSET_POS_=72,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=0/0,this._y=0/0,this._width=0/0,this._height=0/0,this._matrix=null,this._alpha=0/0,this._color=null,this._blendMode=null,this._cmdCurrentPos=0,this._blend_src=0,this._blend_dest=0}r(t,"laya.layagl.cmdNative.DrawTextureCmdNative");var e=t.prototype;return e.recover=function(){this._texture=null,C.recover("DrawTextureCmd",this)},e._setBlendMode=function(t){switch(t){case"normal":this._blend_src=1,this._blend_dest=771;break;case"add":this._blend_src=1,this._blend_dest=772;break;case"multiply":this._blend_src=774,this._blend_dest=771;break;case"screen":this._blend_src=1,this._blend_dest=1;break;case"light":this._blend_src=1,this._blend_dest=1;break;case"overlay":this._blend_src=1,this._blend_dest=769;break;case"destination-out":this._blend_src=0,this._blend_dest=0;break;case"mask":this._blend_src=0,this._blend_dest=770;break;default:alert("_setBlendMode Unknown type")}},e._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},a(0,e,"cmdID",function(){return"DrawTexture"}),a(0,e,"matrix",function(){return this._matrix},function(e){this._matrix||(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._matrix=e;var i=this._paramData._float32Data;i[t._PARAM_MATRIX_POS_]=e.a,i[t._PARAM_MATRIX_POS_+1]=e.b,i[t._PARAM_MATRIX_POS_+2]=e.c,i[t._PARAM_MATRIX_POS_+3]=e.d,i[t._PARAM_MATRIX_POS_+4]=e.tx,i[t._PARAM_MATRIX_POS_+5]=e.ty,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"y",function(){return this._y},function(e){this._y=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"texture",function(){return this._texture},function(e){if(e&&e.url){this._texture=e,this._paramData._int32Data[t._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id;var i=this._paramData._float32Data,_=this.texture.uv;i[t._PARAM_VB_POS_+2]=_[0],i[t._PARAM_VB_POS_+3]=_[1],i[t._PARAM_VB_POS_+8]=_[2],i[t._PARAM_VB_POS_+9]=_[3],i[t._PARAM_VB_POS_+14]=_[4],i[t._PARAM_VB_POS_+15]=_[5],i[t._PARAM_VB_POS_+20]=_[6],i[t._PARAM_VB_POS_+21]=_[7],K.syncBufferToRenderThread(this._paramData)}}),a(0,e,"width",function(){return this._width},function(e){this._width=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"x",function(){return this._x},function(e){this._x=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"height",function(){return this._height},function(e){this._height=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"alpha",function(){return this._alpha},function(t){this._alpha=t}),t.create=function(e,i,_,r,a,n,s,o,h){var u=C.getItemByClass("DrawTextureCmd",t);u._graphicsCmdEncoder=this._commandEncoder,t._DRAW_TEXTURE_CMD_ENCODER_||(t._DRAW_TEXTURE_CMD_ENCODER_=K.instance.createCommandEncoder(124,32,!0),t._DRAW_TEXTURE_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_TEXTURE_CMD_ENCODER_.blendFuncByParamData(4*t._PARAM_BLEND_SRC_POS_,4*t._PARAM_BLEND_DEST_POS_),t._DRAW_TEXTURE_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),t._DRAW_TEXTURE_CMD_ENCODER_.useVDO(te.VDO_MESHQUADTEXTURE),t._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_TEXTURE_CMD_ENCODER_.uniformTextureByParamData(4*t._PARAM_UNIFORM_LOCATION_POS_,4*t._PARAM_TEX_LOCATION_POS_,4*t._PARAM_TEXTURE_POS_),t._DRAW_TEXTURE_CMD_ENCODER_.setRectMeshByParamData(4*t._PARAM_RECT_NUM_POS_,4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_),t._DRAW_TEXTURE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_TEXTURE_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_TEXTURE_CMD_ENCODER_)),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_||(t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_=K.instance.createCommandEncoder(132,32,!0),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.blendFuncByParamData(4*t._PARAM_BLEND_SRC_POS_,4*t._PARAM_BLEND_DEST_POS_),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.useVDO(te.VDO_MESHQUADTEXTURE),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.save(),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.setGlobalValueByParamData(te.GLOBALVALUE_MATRIX32,7,4*t._PARAM_MATRIX_POS_),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformTextureByParamData(4*t._PARAM_UNIFORM_LOCATION_POS_,4*t._PARAM_TEX_LOCATION_POS_,4*t._PARAM_TEXTURE_POS_),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.setRectMeshByParamData(4*t._PARAM_RECT_NUM_POS_,4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.restore(),K.syncBufferToRenderThread(t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_)),u._paramData||(u._paramData=new ParamData(148,!0)),u._texture=e,u._x=i,u._y=_,u._width=r,u._height=a,u._matrix=n,u._alpha=s,u._color=o,u._blendMode=h;var l=0!=r?r:e.bitmap.width,c=0!=a?a:e.bitmap.height,f=e.uv,d=u._paramData._float32Data,E=u._paramData._int32Data;E[t._PARAM_UNIFORM_LOCATION_POS_]=3,E[t._PARAM_TEX_LOCATION_POS_]=33984,E[t._PARAM_TEXTURE_POS_]=e.bitmap._glTexture.id,E[t._PARAM_RECT_NUM_POS_]=1,E[t._PARAM_VB_SIZE_POS_]=96,h?(u._setBlendMode(h),E[t._PARAM_BLEND_SRC_POS_]=u._blend_src,E[t._PARAM_BLEND_DEST_POS_]=u._blend_dest):(E[t._PARAM_BLEND_SRC_POS_]=-1,E[t._PARAM_BLEND_DEST_POS_]=-1);var A=4294967295;s&&(A=u._mixRGBandAlpha(A,s));var D=t._PARAM_VB_POS_;return d[D++]=i,d[D++]=_,d[D++]=f[0],d[D++]=f[1],E[D++]=A,E[D++]=4294967295,d[D++]=i+l,d[D++]=_,d[D++]=f[2],d[D++]=f[3],E[D++]=A,E[D++]=4294967295,d[D++]=i+l,d[D++]=_+c,d[D++]=f[4],d[D++]=f[5],E[D++]=A,E[D++]=4294967295,d[D++]=i,d[D++]=_+c,d[D++]=f[6],d[D++]=f[7],E[D++]=A,E[D++]=4294967295,n&&(d[t._PARAM_MATRIX_POS_]=n.a,d[t._PARAM_MATRIX_POS_+1]=n.b,d[t._PARAM_MATRIX_POS_+2]=n.c,d[t._PARAM_MATRIX_POS_+3]=n.d,d[t._PARAM_MATRIX_POS_+4]=n.tx,d[t._PARAM_MATRIX_POS_+5]=n.ty),K.syncBufferToRenderThread(u._paramData),u._cmdCurrentPos=n?u._graphicsCmdEncoder.useCommandEncoder(t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.getPtrID(),u._paramData.getPtrID(),-1):u._graphicsCmdEncoder.useCommandEncoder(t._DRAW_TEXTURE_CMD_ENCODER_.getPtrID(),u._paramData.getPtrID(),-1),K.syncBufferToRenderThread(u._graphicsCmdEncoder),u},t.ID="DrawTexture",t._DRAW_TEXTURE_CMD_ENCODER_=null,t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_=null,t._PARAM_UNIFORM_LOCATION_POS_=0,t._PARAM_TEX_LOCATION_POS_=1,t._PARAM_TEXTURE_POS_=2,t._PARAM_RECT_NUM_POS_=3,t._PARAM_VB_SIZE_POS_=4,t._PARAM_VB_POS_=5,t._PARAM_MATRIX_POS_=29,t._PARAM_BLEND_SRC_POS_=35,t._PARAM_BLEND_DEST_POS_=36,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._pos=null,this._rectNum=0,this._vbSize=0,this.vbBuffer=null}r(t,"laya.layagl.cmdNative.DrawTexturesCmdNative");var e=t.prototype;return e.recover=function(){this._texture=null,this._pos=null,C.recover("DrawTexturesCmd",this)},a(0,e,"cmdID",function(){return"DrawTextures"}),a(0,e,"texture",function(){return this._texture},function(e){this._texture=e;for(var i=this._texture.bitmap.width,_=this._texture.bitmap.height,r=this._texture.uv,a=this.vbBuffer._float32Data,n=this.vbBuffer._int32Data,s=0,o=0;o<this._rectNum;o++){var h=this.pos[2*o],u=this.pos[2*o+1];a[s++]=h,a[s++]=u,a[s++]=r[0],a[s++]=r[1],n[s++]=4294967295,n[s++]=4294967295,a[s++]=h+i,a[s++]=u,a[s++]=r[2],a[s++]=r[3],n[s++]=4294967295,n[s++]=4294967295,a[s++]=h+i,a[s++]=u+_,a[s++]=r[4],a[s++]=r[5],n[s++]=4294967295,n[s++]=4294967295,a[s++]=h,a[s++]=u+_,a[s++]=r[6],a[s++]=r[7],n[s++]=4294967295,n[s++]=4294967295}var l=this._paramData._int32Data;l[t._PARAM_TEXLOCATION_POS_]=33984,l[t._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id,K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this._paramData)}),a(0,e,"pos",function(){return this._pos},function(e){this._pos=e;var i=this._pos.length/2,_=this._texture.bitmap.width,r=this._texture.bitmap.height,a=this._texture.uv;(!this.vbBuffer||this.vbBuffer.getByteLength()<24*i*4)&&(this.vbBuffer=new ParamData(24*i*4,!0)),this._vbSize=24*i*4,this._rectNum=i;for(var n=this.vbBuffer._float32Data,s=this.vbBuffer._int32Data,o=0,h=0;i>h;h++){var u=this.pos[2*h],l=this.pos[2*h+1];n[o++]=u,n[o++]=l,n[o++]=a[0],n[o++]=a[1],s[o++]=4294967295,s[o++]=4294967295,n[o++]=u+_,n[o++]=l,n[o++]=a[2],n[o++]=a[3],s[o++]=4294967295,s[o++]=4294967295,n[o++]=u+_,n[o++]=l+r,n[o++]=a[4],n[o++]=a[5],s[o++]=4294967295,s[o++]=4294967295,n[o++]=u,n[o++]=l+r,n[o++]=a[6],n[o++]=a[7],s[o++]=4294967295,s[o++]=4294967295}var c=(this._paramData._float32Data,this._paramData._int32Data);c[t._PARAM_RECT_NUM_POS_]=this._rectNum,c[t._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),c[t._PARAM_VB_SIZE_POS_]=this._vbSize,K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i){var _=C.getItemByClass("DrawTexturesCmd",t);_._graphicsCmdEncoder=this._commandEncoder,t._DRAW_TEXTURES_CMD_ENCODER_||(t._DRAW_TEXTURES_CMD_ENCODER_=K.instance.createCommandEncoder(124,32,!0),t._DRAW_TEXTURES_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_TEXTURES_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),t._DRAW_TEXTURES_CMD_ENCODER_.useVDO(te.VDO_MESHQUADTEXTURE),t._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_TEXTURES_CMD_ENCODER_.uniformTextureByParamData(t._PARAM_UNIFORMLOCATION_POS_,4*t._PARAM_TEXLOCATION_POS_,4*t._PARAM_TEXTURE_POS_),t._DRAW_TEXTURES_CMD_ENCODER_.setRectMeshExByParamData(4*t._PARAM_RECT_NUM_POS_,4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_VB_OFFSET_POS_),t._DRAW_TEXTURES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_TEXTURES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._DRAW_TEXTURES_CMD_ENCODER_)),_._paramData||(_._paramData=new ParamData(28,!0)),_._texture=e,_._pos=i;var r=e.bitmap.width,a=e.bitmap.height,n=e.uv,s=i.length/2;(!_.vbBuffer||_.vbBuffer.getByteLength()<24*s*4)&&(_.vbBuffer=new ParamData(24*s*4,!0)),_._vbSize=24*s*4,_._rectNum=s;for(var o=_.vbBuffer._float32Data,h=_.vbBuffer._int32Data,u=0,l=0;s>l;l++){var c=i[2*l],f=i[2*l+1];o[u++]=c,o[u++]=f,o[u++]=n[0],o[u++]=n[1],h[u++]=4294967295,h[u++]=4294967295,o[u++]=c+r,o[u++]=f,o[u++]=n[2],o[u++]=n[3],h[u++]=4294967295,h[u++]=4294967295,o[u++]=c+r,o[u++]=f+a,o[u++]=n[4],o[u++]=n[5],h[u++]=4294967295,h[u++]=4294967295,o[u++]=c,o[u++]=f+a,o[u++]=n[6],o[u++]=n[7],h[u++]=4294967295,h[u++]=4294967295}var d=(_._paramData._float32Data,_._paramData._int32Data);return d[t._PARAM_UNIFORMLOCATION_POS_]=3,d[t._PARAM_TEXLOCATION_POS_]=33984,d[t._PARAM_TEXTURE_POS_]=e.bitmap._glTexture.id,d[t._PARAM_RECT_NUM_POS_]=_._rectNum,d[t._PARAM_VB_POS_]=_.vbBuffer.getPtrID(),d[t._PARAM_VB_SIZE_POS_]=_._vbSize,d[t._PARAM_VB_OFFSET_POS_]=0,K.syncBufferToRenderThread(_.vbBuffer),K.syncBufferToRenderThread(_._paramData),_._graphicsCmdEncoder.useCommandEncoder(t._DRAW_TEXTURES_CMD_ENCODER_.getPtrID(),_._paramData.getPtrID(),-1),K.syncBufferToRenderThread(_._graphicsCmdEncoder),_},t.ID="DrawTextures",t._DRAW_TEXTURES_CMD_ENCODER_=null,t._PARAM_UNIFORMLOCATION_POS_=0,t._PARAM_TEXLOCATION_POS_=1,t._PARAM_TEXTURE_POS_=2,t._PARAM_RECT_NUM_POS_=3,t._PARAM_VB_POS_=4,t._PARAM_VB_SIZE_POS_=5,t._PARAM_VB_OFFSET_POS_=6,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._paramData=null,this._texture=null,this._x=0/0,this._y=0/0,this._vertices=null,this._uvs=null,this._indices=null,this._matrix=null,this._alpha=0/0,this._color=null,this._blendMode=null,this.vbBuffer=null,this._vbSize=0/0,this.ibBuffer=null,this._ibSize=0/0,this._verticesNum=0/0,this._ibNum=0/0,this._blend_src=0,this._blend_dest=0}r(t,"laya.layagl.cmdNative.DrawTrianglesCmdNative");var e=t.prototype;return e.recover=function(){this._texture=null,this._vertices=null,this._uvs=null,this._indices=null,this._matrix=null,C.recover("DrawTrianglesCmd",this)},e._setBlendMode=function(t){switch(t){case"normal":this._blend_src=1,this._blend_dest=771;break;case"add":this._blend_src=1,this._blend_dest=772;break;case"multiply":this._blend_src=774,this._blend_dest=771;break;case"screen":this._blend_src=1,this._blend_dest=1;break;case"light":this._blend_src=1,this._blend_dest=1;break;case"overlay":this._blend_src=1,this._blend_dest=769;break;case"destination-out":this._blend_src=0,this._blend_dest=0;break;case"mask":this._blend_src=0,this._blend_dest=770;break;default:alert("_setBlendMode Unknown type")}},e._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},a(0,e,"vertices",function(){return this._vertices},function(t){this._vertices=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._verticesNum;_++)e[i++]=this._x+t[2*_],e[i++]=this._y+t[2*_+1],i++,i++,i++,i++;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"cmdID",function(){return"DrawTriangles"}),a(0,e,"matrix",function(){return this._matrix},function(e){this._matrix=e;var i=this._paramData._float32Data;i[t._PARAM_MATRIX_POS_]=e.a,i[t._PARAM_MATRIX_POS_+1]=e.b,i[t._PARAM_MATRIX_POS_+2]=e.c,i[t._PARAM_MATRIX_POS_+3]=e.d,i[t._PARAM_MATRIX_POS_+4]=e.tx,i[t._PARAM_MATRIX_POS_+5]=e.ty,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"texture",function(){return this._texture},function(e){if(e&&e.url){this._texture=e;var i=this._paramData._int32Data;i[t._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id,K.syncBufferToRenderThread(this._paramData)}}),a(0,e,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._verticesNum;_++)i++,e[i++]=t+this.vertices[2*_+1],i++,i++,i++,i++;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._verticesNum;_++)e[i++]=t+this.vertices[2*_],i++,i++,i++,i++,i++;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"alpha",function(){return this._alpha},function(t){this._alpha=t}),a(0,e,"uvs",function(){return this._uvs},function(t){this._uvs=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._verticesNum;_++)i++,i++,e[i++]=t[2*_],e[i++]=t[2*_+1],i++,i++;K.syncBufferToRenderThread(this.vbBuffer)}),a(0,e,"indices",function(){return this._indices},function(t){this._indices=t;for(var e=this.ibBuffer._int16Data,i=0,_=0;_<this._ibNum;_++)e[i++]=t[_];K.syncBufferToRenderThread(this.ibBuffer)}),a(0,e,"color",function(){return this._color},function(t){this._color=t}),a(0,e,"blendMode",function(){return this._blendMode},function(t){this._blendMode=t}),t.create=function(e,i,_,r,a,n,s,o,l,c){var f=C.getItemByClass("DrawTrianglesCmd",t);f._graphicsCmdEncoder=this._commandEncoder,t._DRAW_TRIANGLES_CMD_ENCODER_||(t._DRAW_TRIANGLES_CMD_ENCODER_=K.instance.createCommandEncoder(152,32,!0),t._DRAW_TRIANGLES_CMD_ENCODER_.save(),t._DRAW_TRIANGLES_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_TRIANGLES_CMD_ENCODER_.blendFuncByParamData(4*t._PARAM_BLEND_SRC_POS_,4*t._PARAM_BLEND_DEST_POS_),t._DRAW_TRIANGLES_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),t._DRAW_TRIANGLES_CMD_ENCODER_.useVDO(te.VDO_MESHQUADTEXTURE),t._DRAW_TRIANGLES_CMD_ENCODER_.setGlobalValueByParamData(te.GLOBALVALUE_MATRIX32,7,4*t._PARAM_MATRIX_POS_),t._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_TRIANGLES_CMD_ENCODER_.uniformTextureByParamData(4*t._PARAM_UNIFORMLOCATION_POS_,4*t._PARAM_TEXLOCATION_POS_,4*t._PARAM_TEXTURE_POS_),t._DRAW_TRIANGLES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_OFFSET_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_OFFSET_POS_,4*t._PARAM_IB_SIZE_POS_,4*t._PARAM_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_TRIANGLES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_TRIANGLES_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),t._DRAW_TRIANGLES_CMD_ENCODER_.restore(),K.syncBufferToRenderThread(t._DRAW_TRIANGLES_CMD_ENCODER_)),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_||(t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_=K.instance.createCommandEncoder(152,32,!0),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.save(),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.blendFuncByParamData(4*t._PARAM_BLEND_SRC_POS_,4*t._PARAM_BLEND_DEST_POS_),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.addShaderMacro(te.SHADER_MACRO_COLOR_FILTER),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(te.GLOBALVALUE_COLORFILTER_COLOR,8,4*t._PARAM_FILTER_COLOR_POS_),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(te.GLOBALVALUE_COLORFILTER_ALPHA,8,4*t._PARAM_FILTER_ALPHA_POS_),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.useVDO(te.VDO_MESHQUADTEXTURE),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(te.GLOBALVALUE_MATRIX32,7,4*t._PARAM_MATRIX_POS_),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_VIEWS,0),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformTextureByParamData(4*t._PARAM_UNIFORMLOCATION_POS_,4*t._PARAM_TEXLOCATION_POS_,4*t._PARAM_TEXTURE_POS_),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_OFFSET_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_OFFSET_POS_,4*t._PARAM_IB_SIZE_POS_,4*t._PARAM_INDEX_ELEMENT_OFFSET_POS_),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.restore(),K.syncBufferToRenderThread(t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_)),f._paramData||(f._paramData=new ParamData(152,!0)),f._texture=e,f._x=i,f._y=_,f._vertices=r,f._uvs=a,f._indices=n,f._matrix=s?s:new v,f._alpha=o,f._color=l,f._blendMode=c;var d=new h,E=u.create(l);d.color(E.arrColor[0],E.arrColor[1],E.arrColor[2],E.arrColor[3]),f._verticesNum=f._vertices.length/2;var A=f._verticesNum;(!f.vbBuffer||f.vbBuffer.getByteLength()<24*A*3)&&(f.vbBuffer=new ParamData(24*A*3,!0)),f._vbSize=24*A*3;var D=f.vbBuffer._float32Data,R=f.vbBuffer._int32Data,m=4294967295;o&&(m=f._mixRGBandAlpha(m,o));for(var T=0,P=0;P<f._verticesNum;P++)D[T++]=i/f._matrix.a+r[2*P],D[T++]=_/f._matrix.d+r[2*P+1],D[T++]=a[2*P],D[T++]=a[2*P+1],R[T++]=m,R[T++]=4294967295;f._ibNum=n.length;var p=f._ibNum;(!f.ibBuffer||f.ibBuffer.getByteLength()<2*p)&&(f.ibBuffer=new ParamData(2*p,!0,!0)),f._ibSize=2*p;for(var M=f.ibBuffer._int16Data,O=0,L=0;L<f._ibNum;L++)M[O++]=n[L];var y=f._paramData._float32Data,S=f._paramData._int32Data;if(S[t._PARAM_UNIFORMLOCATION_POS_]=3,S[t._PARAM_TEXLOCATION_POS_]=33984,S[t._PARAM_TEXTURE_POS_]=e.bitmap._glTexture.id,S[t._PARAM_VB_POS_]=f.vbBuffer.getPtrID(),S[t._PARAM_VB_SIZE_POS_]=f._vbSize,S[t._PARAM_IB_POS_]=f.ibBuffer.getPtrID(),S[t._PARAM_IB_SIZE_POS_]=f._ibSize,S[t._PARAM_VB_OFFSET_POS_]=0,S[t._PARAM_IB_OFFSET_POS_]=0,S[t._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,y[t._PARAM_MATRIX_POS_]=f._matrix.a,y[t._PARAM_MATRIX_POS_+1]=f._matrix.b,y[t._PARAM_MATRIX_POS_+2]=f._matrix.c,y[t._PARAM_MATRIX_POS_+3]=f._matrix.d,y[t._PARAM_MATRIX_POS_+4]=f._matrix.tx,y[t._PARAM_MATRIX_POS_+5]=f._matrix.ty,c?(f._setBlendMode(c),S[t._PARAM_BLEND_SRC_POS_]=f._blend_src,S[t._PARAM_BLEND_DEST_POS_]=f._blend_dest):(S[t._PARAM_BLEND_SRC_POS_]=-1,S[t._PARAM_BLEND_DEST_POS_]=-1),l){T=t._PARAM_FILTER_COLOR_POS_;var g=d._mat;y[T++]=g[0],y[T++]=g[1],y[T++]=g[2],y[T++]=g[3],y[T++]=g[4],y[T++]=g[5],y[T++]=g[6],y[T++]=g[7],y[T++]=g[8],y[T++]=g[9],y[T++]=g[10],y[T++]=g[11],y[T++]=g[12],y[T++]=g[13],y[T++]=g[14],y[T++]=g[15],T=t._PARAM_FILTER_ALPHA_POS_;var b=d._alpha;y[T++]=255*b[0],y[T++]=255*b[1],y[T++]=255*b[2],y[T++]=255*b[3]}return K.syncBufferToRenderThread(f.vbBuffer),K.syncBufferToRenderThread(f.ibBuffer),K.syncBufferToRenderThread(f._paramData),l?f._graphicsCmdEncoder.useCommandEncoder(t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.getPtrID(),f._paramData.getPtrID(),-1):f._graphicsCmdEncoder.useCommandEncoder(t._DRAW_TRIANGLES_CMD_ENCODER_.getPtrID(),f._paramData.getPtrID(),-1),K.syncBufferToRenderThread(f._graphicsCmdEncoder),f},t.ID="DrawTriangles",t._DRAW_TRIANGLES_CMD_ENCODER_=null,t._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_=null,t._PARAM_UNIFORMLOCATION_POS_=0,t._PARAM_TEXLOCATION_POS_=1,t._PARAM_TEXTURE_POS_=2,t._PARAM_VB_POS_=3,t._PARAM_VB_SIZE_POS_=4,t._PARAM_IB_POS_=5,t._PARAM_IB_SIZE_POS_=6,t._PARAM_VB_OFFSET_POS_=7,t._PARAM_IB_OFFSET_POS_=8,t._PARAM_INDEX_ELEMENT_OFFSET_POS_=9,t._PARAM_BLEND_SRC_POS_=10,t._PARAM_BLEND_DEST_POS_=11,t._PARAM_MATRIX_POS_=12,t._PARAM_FILTER_COLOR_POS_=18,t._PARAM_FILTER_ALPHA_POS_=34,t}(),function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._text=null,this._x=0/0,this._y=0/0,this._font=null,this._color=null,this._strokeColor=null,this._strokeWidth=0,this._textAlign=null,this._draw_texture_cmd_encoder_=K.instance.createCommandEncoder(64,32,!0)}r(t,"laya.layagl.cmdNative.FillBorderTextCmdNative");var e=t.prototype;return e.createFillBorderText=function(e,i,_,r,a,n,s,o,h){var l=u.create(n),c=(l.numColor,{});c._curMat=new v,c._italicDeg=0,c._drawTextureUseColor=4294967295,c.fillStyle=n,c._fillColor=4294967295,c.setFillColor=function(t){c._fillColor=t},c.getFillColor=function(){return c._fillColor},c.mixRGBandAlpha=function(t){return t},c._drawTextureM=function(t,i,_,r,a,n,s,o){e.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),e.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),e.useVDO(te.VDO_MESHQUADTEXTURE),e.uniformEx(te.GLOBALVALUE_VIEWS,0),e.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),e.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),e.uniformTexture(3,33984,t.bitmap._glTexture);var h=new Float32Array([i,_,o[0],o[1],0,0,i+r,_,o[2],o[3],0,0,i+r,_+a,o[4],o[5],0,0,i,_+a,o[6],o[7],0,0]),u=new Int32Array(h.buffer);u[4]=u[10]=u[16]=u[22]=4294967295,u[5]=u[11]=u[17]=u[23]=4294967295,e.setRectMesh(1,h,h.length),e.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),e.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(e)},t.cbook.filltext_native(c,i,null,_,r,a,n,s,o,h)},e.recover=function(){this._graphicsCmdEncoder=null,C.recover("FillBorderTextCmd",this)},a(0,e,"text",function(){return this._text},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._text=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),a(0,e,"cmdID",function(){return"FillBorderText"}),a(0,e,"font",function(){return this._font},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._font=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),a(0,e,"color",function(){return this._color},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._color=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),a(0,e,"textAlign",function(){return this._textAlign},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._textAlign=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),a(0,e,"x",function(){return this._x},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._x=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),a(0,e,"y",function(){return this._y},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._y=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),t.create=function(e,i,_,r,a,n,s,o){t.cbook||new Error("Error:charbook not create!");var h=C.getItemByClass("FillBorderTextCmd",t),u=h._graphicsCmdEncoder=this._commandEncoder;return h._text=e,h._x=i,h._y=_,h._font=r,h._color=a,h._strokeColor=n,h._strokeWidth=s,h._textAlign=o,h._draw_texture_cmd_encoder_.clearEncoding(),h.createFillBorderText(h._draw_texture_cmd_encoder_,e,i,_,r,a,n,s,o),K.syncBufferToRenderThread(h._draw_texture_cmd_encoder_),u.useCommandEncoder(h._draw_texture_cmd_encoder_.getPtrID(),-1,-1),K.syncBufferToRenderThread(u),h},t.ID="FillBorderText",_(t,["cbook",function(){return this.cbook=he.charbookInst}]),t}(),function(){function t(){this._draw_texture_cmd_encoder_=K.instance.createCommandEncoder(64,32,!0)}r(t,"laya.layagl.cmdNative.FillBorderWordsCmdNative");var e=t.prototype;return e.createFillBorderText=function(e,i,_,r,a,n,s,o){var h=u.create(n),l=(h.numColor,{});l._curMat=new v,l._italicDeg=0,l._drawTextureUseColor=4294967295,l.fillStyle=n,l._fillColor=4294967295,l.setFillColor=function(t){l._fillColor=t},l.getFillColor=function(){return l._fillColor},l.mixRGBandAlpha=function(t){return t},l._drawTextureM=function(t,i,_,r,a,n,s,o){e.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),e.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),e.useVDO(te.VDO_MESHQUADTEXTURE),e.uniformEx(te.GLOBALVALUE_VIEWS,0),e.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),e.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),e.uniformTexture(3,33984,t.bitmap._glTexture);var h=new Float32Array([i,_,o[0],o[1],0,0,i+r,_,o[2],o[3],0,0,i+r,_+a,o[4],o[5],0,0,i,_+a,o[6],o[7],0,0]),u=new Int32Array(h.buffer);u[4]=u[10]=u[16]=u[22]=4294967295,u[5]=u[11]=u[17]=u[23]=4294967295,e.setRectMesh(1,h,h.length),e.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),e.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(e)},t.cbook.filltext_native(l,null,i,_,r,a,n,s,o,null,0)},e.recover=function(){this._graphicsCmdEncoder=null,this.words=null,C.recover("FillBorderWordsCmd",this)},a(0,e,"cmdID",function(){return"FillBorderWords"}),t.create=function(e,i,_,r,a,n,s){t.cbook||new Error("Error:charbook not create!");var o=C.getItemByClass("FillBorderWordsCmd",t),h=o._graphicsCmdEncoder=this._commandEncoder;return o.words=e,o.x=i,o.y=_,o.font=r,o.color=a,o.strokeColor=n,o.strokeWidth=s,o._draw_texture_cmd_encoder_.clearEncoding(),o.createFillBorderText(o._draw_texture_cmd_encoder_,e,i,_,r,a,n,s),K.syncBufferToRenderThread(o._draw_texture_cmd_encoder_),h.useCommandEncoder(o._draw_texture_cmd_encoder_.getPtrID(),-1,-1),K.syncBufferToRenderThread(h),o},t.ID="FillBorderWords",_(t,["cbook",function(){return this.cbook=he.charbookInst}]),t}(),function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._text=null,this._x=0/0,this._y=0/0,this._font=null,this._color=null,this._textAlign=null,this._draw_texture_cmd_encoder_=K.instance.createCommandEncoder(64,32,!0)}r(t,"laya.layagl.cmdNative.FillTextCmdNative");var e=t.prototype;return e.createFillText=function(e,i,_,r,a,n,s){var o=u.create(n),h=(o.numColor,{});h._curMat=new v,h._italicDeg=0,h._drawTextureUseColor=4294967295,h.fillStyle=n,h._fillColor=4294967295,h.setFillColor=function(t){h._fillColor=t},h.getFillColor=function(){return h._fillColor},h.mixRGBandAlpha=function(t){return t},h._drawTextureM=function(t,i,_,r,a,n,s,o){e.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),e.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),e.useVDO(te.VDO_MESHQUADTEXTURE),e.uniformEx(te.GLOBALVALUE_VIEWS,0),e.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),e.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),e.uniformTexture(3,33984,t.bitmap._glTexture);var h=new Float32Array([i,_,o[0],o[1],0,0,i+r,_,o[2],o[3],0,0,i+r,_+a,o[4],o[5],0,0,i,_+a,o[6],o[7],0,0]),u=new Int32Array(h.buffer);
u[4]=u[10]=u[16]=u[22]=4294967295,u[5]=u[11]=u[17]=u[23]=4294967295,e.setRectMesh(1,h,h.length),e.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),e.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(e)},t.cbook.filltext_native(h,i,null,_,r,a,n,null,0,s)},e.recover=function(){this._graphicsCmdEncoder=null,C.recover("FillTextCmd",this)},a(0,e,"text",function(){return this._text},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._text=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),a(0,e,"cmdID",function(){return"FillText"}),a(0,e,"font",function(){return this._font},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._font=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),a(0,e,"color",function(){return this._color},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._color=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),a(0,e,"textAlign",function(){return this._textAlign},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._textAlign=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),a(0,e,"x",function(){return this._x},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._x=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),a(0,e,"y",function(){return this._y},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._y=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),t.create=function(e,i,_,r,a,n){t.cbook||new Error("Error:charbook not create!");var s=C.getItemByClass("FillTextCmd",t),o=s._graphicsCmdEncoder=this._commandEncoder;return s._text=e,s._x=i,s._y=_,s._font=r,s._color=a,s._textAlign=n,s._draw_texture_cmd_encoder_.clearEncoding(),s.createFillText(s._draw_texture_cmd_encoder_,e,i,_,r,a,n),K.syncBufferToRenderThread(s._draw_texture_cmd_encoder_),o.useCommandEncoder(s._draw_texture_cmd_encoder_.getPtrID(),-1,-1),K.syncBufferToRenderThread(o),s},t.ID="FillText",_(t,["cbook",function(){return this.cbook=he.charbookInst}]),t}(),function(){function t(){this._draw_texture_cmd_encoder_=K.instance.createCommandEncoder(64,32,!0)}r(t,"laya.layagl.cmdNative.FillWordsCmdNative");var e=t.prototype;return e.createFillText=function(e,i,_,r,a,n){var s=u.create(n),o=(s.numColor,{});o._curMat=new v,o._italicDeg=0,o._drawTextureUseColor=4294967295,o.fillStyle=n,o._fillColor=4294967295,o.setFillColor=function(t){o._fillColor=t},o.getFillColor=function(){return o._fillColor},o.mixRGBandAlpha=function(t){return t},o._drawTextureM=function(t,i,_,r,a,n,s,o){e.blendFuncByGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,te.GLOBALVALUE_BLENDFUNC_DEST),e.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),e.useVDO(te.VDO_MESHQUADTEXTURE),e.uniformEx(te.GLOBALVALUE_VIEWS,0),e.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),e.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),e.uniformTexture(3,33984,t.bitmap._glTexture);var h=new Float32Array([i,_,o[0],o[1],0,0,i+r,_,o[2],o[3],0,0,i+r,_+a,o[4],o[5],0,0,i,_+a,o[6],o[7],0,0]),u=new Int32Array(h.buffer);u[4]=u[10]=u[16]=u[22]=4294967295,u[5]=u[11]=u[17]=u[23]=4294967295,e.setRectMesh(1,h,h.length),e.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),e.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(e)},t.cbook.filltext_native(o,null,i,_,r,a,n,null,0,null)},e.recover=function(){this._graphicsCmdEncoder=null,this.words=null,C.recover("FillWordsCmd",this)},a(0,e,"cmdID",function(){return"FillWords"}),t.create=function(e,i,_,r,a){t.cbook||new Error("Error:charbook not create!");var n=C.getItemByClass("FillWordsCmd",t),s=n._graphicsCmdEncoder=this._commandEncoder;return n.words=e,n.x=i,n.y=_,n.font=r,n.color=a,n._draw_texture_cmd_encoder_.clearEncoding(),n.createFillText(n._draw_texture_cmd_encoder_,e,i,_,r,a),K.syncBufferToRenderThread(n._draw_texture_cmd_encoder_),s.useCommandEncoder(n._draw_texture_cmd_encoder_.getPtrID(),-1,-1),K.syncBufferToRenderThread(s),n},t.ID="FillWords",_(t,["cbook",function(){return this.cbook=he.charbookInst}]),t}(),function(){function t(){this._graphicsCmdEncoder=null}r(t,"laya.layagl.cmdNative.RestoreCmdNative");var e=t.prototype;return e.recover=function(){C.recover("RestoreCmd",this)},a(0,e,"cmdID",function(){return"Restore"}),t.create=function(){var e=C.getItemByClass("RestoreCmd",t),i=e._graphicsCmdEncoder=this._commandEncoder;return i.restore(),K.syncBufferToRenderThread(i),e},t.ID="Restore",t}(),function(){function t(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(12,!0)}r(t,"laya.layagl.cmdNative.RotateCmdNative");var e=t.prototype;return e.recover=function(){C.recover("RotateCmd",this)},a(0,e,"cmdID",function(){return"Rotate"}),a(0,e,"angle",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"pivotX",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"pivotY",function(){return this._paramData._float32Data[2]},function(t){this._paramData._float32Data[2]=t,K.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,_){var r=C.getItemByClass("RotateCmd",t),a=r._graphicsCmdEncoder=this._commandEncoder,n=r._paramData._float32Data;n[0]=e,n[1]=i,n[2]=_;var s=r._paramData.getPtrID();return K.syncBufferToRenderThread(r._paramData),a.setGlobalValueEx(te.GLOBALVALUE_MATRIX32,13,s,0),K.syncBufferToRenderThread(a),r},t.ID="Rotate",t}(),function(){function t(){this._graphicsCmdEncoder=null}r(t,"laya.layagl.cmdNative.SaveCmdNative");var e=t.prototype;return e.recover=function(){C.recover("SaveCmd",this)},a(0,e,"cmdID",function(){return"Save"}),t.create=function(){var e=C.getItemByClass("SaveCmd",t),i=e._graphicsCmdEncoder=this._commandEncoder;return i.save(),K.syncBufferToRenderThread(i),e},t.ID="Save",t}(),function(){function t(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(16,!0)}r(t,"laya.layagl.cmdNative.ScaleCmdNative");var e=t.prototype;return e.recover=function(){C.recover("ScaleCmd",this)},a(0,e,"cmdID",function(){return"Scale"}),a(0,e,"scaleX",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"scaleY",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"pivotX",function(){return this._paramData._float32Data[2]},function(t){this._paramData._float32Data[2]=t,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"pivotY",function(){return this._paramData._float32Data[3]},function(t){this._paramData._float32Data[3]=t,K.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,_,r){var a=C.getItemByClass("ScaleCmd",t),n=a._graphicsCmdEncoder=this._commandEncoder,s=a._paramData._float32Data;s[0]=e,s[1]=i,s[2]=_,s[3]=r;var o=a._paramData.getPtrID();return K.syncBufferToRenderThread(a._paramData),n.setGlobalValueEx(te.GLOBALVALUE_MATRIX32,12,o,0),K.syncBufferToRenderThread(n),a},t.ID="Scale",t}(),function(){function t(){this._graphicsCmdEncoder=null,this._matrix=null,this._paramData=new ParamData(32,!0)}r(t,"laya.layagl.cmdNative.TransformCmdNative");var e=t.prototype;return e.recover=function(){this._matrix=null,C.recover("TransformCmd",this)},a(0,e,"cmdID",function(){return"Transform"}),a(0,e,"matrix",function(){return this._matrix},function(t){this._matrix=t;var e=this._paramData._float32Data;e[0]=this._matrix.a,e[1]=this._matrix.b,e[2]=this._matrix.c,e[3]=this._matrix.d,e[4]=this._matrix.tx,e[5]=this._matrix.ty,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"pivotX",function(){return this._paramData._float32Data[6]},function(t){this._paramData._float32Data[6]=t,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"pivotY",function(){return this._paramData._float32Data[7]},function(t){this._paramData._float32Data[7]=t,K.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,_){var r=C.getItemByClass("TransformCmd",t),a=r._graphicsCmdEncoder=this._commandEncoder,n=r._paramData._float32Data;n[0]=e.a,n[1]=e.b,n[2]=e.c,n[3]=e.d,n[4]=e.tx,n[5]=e.ty,n[6]=i,n[7]=_,r._matrix=e;var s=r._paramData.getPtrID();return K.syncBufferToRenderThread(r._paramData),a.setGlobalValueEx(te.GLOBALVALUE_MATRIX32,14,s,0),K.syncBufferToRenderThread(a),r},t.ID="Transform",t}(),function(){function t(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(8,!0)}r(t,"laya.layagl.cmdNative.TranslateCmdNative");var e=t.prototype;return e.recover=function(){C.recover("TranslateCmd",this)},a(0,e,"ty",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,K.syncBufferToRenderThread(this._paramData)}),a(0,e,"cmdID",function(){return"Translate"}),a(0,e,"tx",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,K.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i){var _=C.getItemByClass("TranslateCmd",t),r=_._graphicsCmdEncoder=this._commandEncoder,a=_._paramData._float32Data;a[0]=e,a[1]=i;var n=_._paramData.getPtrID();return K.syncBufferToRenderThread(_._paramData),r.setGlobalValueEx(te.GLOBALVALUE_MATRIX32,9,n,0),K.syncBufferToRenderThread(r),_},t.ID="Translate",t}(),function(){function t(){this._idata=[]}r(t,"laya.layagl.CommandEncoder");var e=t.prototype;return e.getArrayData=function(){return this._idata},e.getPtrID=function(){return 0},e.beginEncoding=function(){},e.endEncoding=function(){},e.clearEncoding=function(){this._idata.length=0},e.getCount=function(){return this._idata.length},e.add_ShaderValue=function(t){this._idata.push(t)},e.addShaderUniform=function(t){this.add_ShaderValue(t)},t}()),j=function(){function t(){}return r(t,"laya.layagl.ConchCmdReplace"),t.__init__=function(){var t,e=laya.display.cmd,i=laya.layagl.cmdNative;for(t in e)i[t+"Native"]&&(e[t].create=i[t+"Native"].create)},t}(),Q=function(){function t(){this._commandEncoder=null}r(t,"laya.layagl.ConchGraphicsAdpt");var e=t.prototype;return e._createData=function(){this._commandEncoder=K.instance.createCommandEncoder(128,64,!0)},e._clearData=function(){this._commandEncoder&&this._commandEncoder.clearEncoding()},e._destroyData=function(){this._commandEncoder&&(this._commandEncoder.clearEncoding(),this._commandEncoder=null)},t.__init__=function(){var e=R.prototype,i=t.prototype,_=["_createData","_clearData","_destroyData"],r=0,a=0;a=_.length;var n;for(r=0;a>r;r++)n=_[r],e[n]=i[n]},t}(),K=function(){function t(){}r(t,"laya.layagl.LayaGL");var e=t.prototype;return e.createCommandEncoder=function(t,e,i){return void 0===t&&(t=128),void 0===e&&(e=64),void 0===i&&(i=!1),new Z(this,t,e,i)},e.beginCommandEncoding=function(){},e.endCommandEncoding=function(){},e.calcMatrixFromScaleSkewRotation=function(){},e.setGLTemplate=function(){},e.setEndGLTemplate=function(){},e.matrix4x4Multiply=function(){},e.evaluateClipDatasRealTime=function(){},t.getFrameCount=function(){return 0},t.syncBufferToRenderThread=function(t,e){void 0===e&&(e=0)},t.createArrayBufferRef=function(){},t.createArrayBufferRefs=function(){},t.EXECUTE_JS_THREAD_BUFFER=0,t.EXECUTE_RENDER_THREAD_BUFFER=1,t.EXECUTE_COPY_TO_RENDER=2,t.EXECUTE_COPY_TO_RENDER3D=3,t.VALUE_OPERATE_ADD=0,t.VALUE_OPERATE_SUB=1,t.VALUE_OPERATE_MUL=2,t.VALUE_OPERATE_DIV=3,t.VALUE_OPERATE_M2_MUL=4,t.VALUE_OPERATE_M3_MUL=5,t.VALUE_OPERATE_M4_MUL=6,t.VALUE_OPERATE_M32_MUL=7,t.VALUE_OPERATE_SET=8,t.VALUE_OPERATE_M32_TRANSLATE=9,t.VALUE_OPERATE_M32_SCALE=10,t.VALUE_OPERATE_M32_ROTATE=11,t.VALUE_OPERATE_M32_SCALE_PIVOT=12,t.VALUE_OPERATE_M32_ROTATE_PIVOT=13,t.VALUE_OPERATE_M32_TRANSFORM_PIVOT=14,t.VALUE_OPERATE_BYTE4_COLOR_MUL=15,t.ARRAY_BUFFER_TYPE_DATA=0,t.ARRAY_BUFFER_TYPE_CMD=1,t.ARRAY_BUFFER_REF_REFERENCE=0,t.ARRAY_BUFFER_REF_COPY=1,t.UPLOAD_SHADER_UNIFORM_TYPE_ID=0,t.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1,t.instance=null,t}(),q=function(){function t(){this._customCmds=null,this._targets=null,this._width=0,this._height=0}r(t,"laya.layagl.LayaGLRenderingContext");var e=t.prototype;return e.drawTexture=function(t,e,i,_,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===_&&(_=0),void 0===r&&(r=0),this.drawImage(t,e,i,_,r)},e.drawImage=function(t,e,i,_,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===_&&(_=0),void 0===r&&(r=0),this._customCmds.push(d.create.call(this,t,e,i,_,r))},e.fillText=function(t,e,i,_,r,a){this._customCmds.push(E.create.call(this,t,e,i,_||U.defaultFontStr(),r,a))},e.save=function(){this._customCmds.push(B.create.call(this))},e.restore=function(){this._customCmds.push(S.create.call(this))},e.translate=function(t,e){this._customCmds.push(X.create.call(this,t,e))},e.rotate=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._customCmds.push(g.create.call(this,t,e,i))},e.scale=function(t,e,i,_){void 0===i&&(i=0),void 0===_&&(_=0),this._customCmds.push(I.create.call(this,t,e,i,_))},e.transform=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._customCmds.push(G.create.call(this,t,e,i))},e.beginRT=function(){$e.pushRT(),this._targets.start(),this.clear()},e.clear=function(){},e.endRT=function(){$e.popRT()},e.drawCanvas=function(t,e,i){var _=t.context._targets;this._customCmds.push(f.create.call(this,_,e,i,_.width,_.height))},e.drawTarget=function(t,e,i,_,r,a){var n=new ArrayBuffer(96),s=new Int32Array(n),o=new Float32Array(n),h=0!=r?r:e.width,u=0!=a?a:e.height,l=$e.flipyuv,c=0;o[c++]=i,o[c++]=_,o[c++]=l[0],o[c++]=l[1],s[c++]=4294967295,s[c++]=4294967295,o[c++]=i+h,o[c++]=_,o[c++]=l[2],o[c++]=l[3],s[c++]=4294967295,s[c++]=4294967295,o[c++]=i+h,o[c++]=_+u,o[c++]=l[4],o[c++]=l[5],s[c++]=4294967295,s[c++]=4294967295,o[c++]=i,o[c++]=_+u,o[c++]=l[6],o[c++]=l[7],s[c++]=4294967295,s[c++]=4294967295,t.useProgramEx(te.PROGRAMEX_DRAWTEXTURE),t.useVDO(te.VDO_MESHQUADTEXTURE),t.uniformEx(te.GLOBALVALUE_VIEWS,0),t.uniformEx(te.GLOBALVALUE_CLIP_MAT_DIR,1),t.uniformEx(te.GLOBALVALUE_CLIP_MAT_POS,2),t.uniformTexture(0,33984,e._getSource()),t.setRectMesh(1,n),t.modifyMesh(te.GLOBALVALUE_MATRIX32,0,7),t.modifyMesh(te.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15)},a(0,e,"asBitmap",function(){return!this._targets},function(t){if(t){if(this._targets||(this._targets=new $e(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets=null}),t}(),$=function(){function t(){}return r(t,"laya.layagl.LayaGLRunner"),t.uploadShaderUniforms=function(t,e,i,_){for(var r=i._data,a=e.getArrayData(),n=0,s=0,o=a.length;o>s;s++){var h=a[s];if(_||-1!==h.textureID){var u=r[h.dataOffset];null!=u&&(n+=h.fun.call(h.caller,h,u))}}return n},t.uploadCustomUniform=function(t,e,i,_){var r=0,a=e[i];return a&&null!=_&&(r+=a.fun.call(a.caller,a,_)),r},t.uploadShaderUniformsForNative=function(t,e,i){var _=0;i._runtimeCopyValues.length>=0&&(_=1);var r=i._data;return t.uploadShaderUniforms(e,r,_)},t}(),J=function(){function t(){this._commStr="",this._commandEncoder=null,this._id=0,this._commandEncoder=K.instance.createCommandEncoder(64,16,!1)}r(t,"laya.layagl.LayaGLTemplate");var e=t.prototype;return e.addComd=function(t,e){this._commStr+=t+"("+e+");",this._commandEncoder[t].apply(this._commandEncoder,e)},t.createByRenderType=function(e){var i=t.GLS[e]=new t;O.isConchApp&&K.instance.setGLTemplate(e,i._commandEncoder.getPtrID());for(var _=1;8192>=_;){var r=e&_;if(r&&t.__FUN_PARAM__[_])for(var a=t.__FUN_PARAM__[_],n=0,s=a.length;s>n;n++){var o=a[n];i.addComd(o.func,o.args)}_<<=1}return i._id=e,console.log("template="+i._commStr),i},t.createByRenderTypeEnd=function(e){var i=t.GLSE[e]=new t;O.isConchApp&&K.instance.setEndGLTemplate(e,i._commandEncoder.getPtrID());for(var _=8192;_>1;){var r=e&_;if(r&&t.__FUN_PARAM_END_[_])for(var a=t.__FUN_PARAM_END_[_],n=0,s=a.length;s>n;n++){var o=a[n];i.addComd(o.func,o.args)}_>>=1}return i._id=e,console.log("templateEnd="+i._commStr),i},t.__init__=function(){t.__FUN_PARAM__[1]=[{func:"setGlobalValueByParamData",args:[te.GLOBALVALUE_DRAWTEXTURE_COLOR,15,88]}],t.__FUN_PARAM__[2]=[{func:"calcLocalMatrix32",args:[60,64,24,28,32,36,40,44,48,52,56]},{func:"setGlobalValueByParamData",args:[te.GLOBALVALUE_MATRIX32,7,64]}],t.__FUN_PARAM__[4]=[{func:"setGlobalValueByParamData",args:[te.GLOBALVALUE_BLENDFUNC_SRC,8,284]},{func:"setGlobalValueByParamData",args:[te.GLOBALVALUE_BLENDFUNC_DEST,8,288]}],t.__FUN_PARAM__[256]=[{func:"useCommandEncoderByParamData",args:[96,100,1]}],t.__FUN_PARAM__[512]=[{func:"callbackJSByParamData",args:[216,272]},{func:"useCommandEncoderByParamData",args:[92,-1,1]}],t.__FUN_PARAM__[1024]=[{func:"callbackJSByParamData",args:[216,248]},{func:"useCommandEncoderByParamData",args:[104,-1,3]}],t.__FUN_PARAM__[2048]=[{func:"callbackJSByParamData",args:[216,220]},{func:"useCommandEncoderByParamData",args:[108,-1,1]}],t.__FUN_PARAM__[64]=[{func:"setClipByParamData",args:[te.GLOBALVALUE_CLIP_MAT_DIR,te.GLOBALVALUE_CLIP_MAT_POS,te.GLOBALVALUE_MATRIX32,112]},{func:"setGlobalValueByParamData",args:[te.GLOBALVALUE_MATRIX32,9,128]}],t.__FUN_PARAM__[16]=[{func:"callbackJSByParamData",args:[216,260]},{func:"useCommandEncoderByParamData",args:[256,-1,0]}],t.__FUN_PARAM__[32]=[{func:"callbackJSByParamData",args:[216,276]},{func:"useCommandEncoderByParamData",args:[280,-1,0]}],t.__FUN_PARAM__[8]=[{func:"callbackJSByParamData",args:[216,224]},{func:"loadDataToRegByParamData",args:[0,252,4]},{func:"ifGreater0",args:[0,2147483647]},{func:"useCommandEncoderByParamData",args:[232,-1,0]}],t.__FUN_PARAM__[128]=[{func:"useCommandEncoderByParamData",args:[292,296,1]},{func:"useCommandEncoderByParamData",args:[300,304,1]}]},t.__init_END_=function(){t.__FUN_PARAM_END_[16]=[{func:"loadDataToRegByParamData",args:[0,252,4]},{func:"ifGreater0",args:[0,2]},{func:"callbackJSByParamData",args:[216,268]},{func:"useCommandEncoderByParamData",args:[264,-1,1]}],t.__FUN_PARAM_END_[8]=[{func:"callbackJSByParamData",args:[216,228]},{func:"useCommandEncoderByParamData",args:[236,-1,0]},{func:"useCommandEncoderByParamData",args:[240,244,1]}]},t.GLS=[],t.GLSE=[],t.__FUN_PARAM__=[],t.__FUN_PARAM_END_=[],t}(),te=function(){function t(){}return r(t,"laya.layagl.LayaNative2D"),t._init_simple_texture_cmdEncoder_=function(){t._SIMPLE_TEXTURE_CMDENCODER_=K.instance.createCommandEncoder(124,32,!0),t._SIMPLE_TEXTURE_CMDENCODER_.useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWTEXTURE),t._SIMPLE_TEXTURE_CMDENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHQUADTEXTURE),t._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),t._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),t._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),t._SIMPLE_TEXTURE_CMDENCODER_.uniformTextureByParamData(0,4,8),t._SIMPLE_TEXTURE_CMDENCODER_.blendFuncByGlobalValue(laya.layagl.LayaNative2D.GLOBALVALUE_BLENDFUNC_SRC,laya.layagl.LayaNative2D.GLOBALVALUE_BLENDFUNC_DEST),t._SIMPLE_TEXTURE_CMDENCODER_.setRectMeshByParamData(12,20,16),t._SIMPLE_TEXTURE_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._SIMPLE_TEXTURE_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._SIMPLE_TEXTURE_CMDENCODER_)},t._init_simple_rect_cmdEncoder_=function(){t._SIMPLE_RECT_CMDENCODER_=K.instance.createCommandEncoder(84,32,!0),t._SIMPLE_RECT_CMDENCODER_.useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWTEXTURE),t._SIMPLE_RECT_CMDENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHQUADTEXTURE),t._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),t._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),t._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),t._SIMPLE_RECT_CMDENCODER_.setRectMeshByParamData(0,8,4),t._SIMPLE_RECT_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._SIMPLE_RECT_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._SIMPLE_RECT_CMDENCODER_)},t._init_rect_border_cmdEncoder_=function(){t._RECT_BORDER_CMD_ENCODER_=K.instance.createCommandEncoder(84,32,!0),t._RECT_BORDER_CMD_ENCODER_.useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWVG),t._RECT_BORDER_CMD_ENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHVG),t._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),t._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),t._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),t._RECT_BORDER_CMD_ENCODER_.setMeshByParamData(20,0,4,140,8,12,16),t._RECT_BORDER_CMD_ENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._RECT_BORDER_CMD_ENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t._RECT_BORDER_CMD_ENCODER_)},t.__init__=function(){if(O.isConchApp){var e=K.instance;t.GLOBALVALUE_MATRIX32=e.addGlobalValueDefine(0,5126,6,new Float32Array([1,0,0,1,0,0])),t.GLOBALVALUE_DRAWTEXTURE_COLOR=e.addGlobalValueDefine(0,5124,1,new Uint32Array([4294967295])),t.GLOBALVALUE_ITALICDEG=e.addGlobalValueDefine(0,5126,1,new Float32Array([0])),t.GLOBALVALUE_CLIP_MAT_DIR=e.addGlobalValueDefine(0,5126,4,new Float32Array([1e6,0,0,1e6])),t.GLOBALVALUE_CLIP_MAT_POS=e.addGlobalValueDefine(0,5126,2,new Float32Array([0,0])),t.GLOBALVALUE_BLENDFUNC_SRC=e.addGlobalValueDefine(0,5124,1,new Int32Array([1])),t.GLOBALVALUE_BLENDFUNC_DEST=e.addGlobalValueDefine(0,5124,1,new Int32Array([771])),t.GLOBALVALUE_COLORFILTER_COLOR=e.addGlobalValueDefine(0,5126,16,new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])),t.GLOBALVALUE_COLORFILTER_ALPHA=e.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,1])),t.GLOBALVALUE_BLURFILTER_STRENGTH=e.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),t.GLOBALVALUE_BLURFILTER_BLURINFO=e.addGlobalValueDefine(0,5126,2,new Float32Array([0,0])),t.GLOBALVALUE_GLOWFILTER_COLOR=e.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),t.GLOBALVALUE_GLOWFILTER_BLURINFO1=e.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),t.GLOBALVALUE_GLOWFILTER_BLURINFO2=e.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),e.endGlobalValueDefine(),t.PROGRAMEX_DRAWTEXTURE=K.instance.createProgramEx("/*\n	texture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n	uniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n	vec4 pos=mmat*vec4(posuv.xy,0.,1.);\n	gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n	gl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n	v_texcoordAlpha.xy = posuv.zw;\n	//v_texcoordAlpha.z = attribColor.a/255.0;\n	v_color = attribColor/255.0;\n	v_color.xyz*=v_color.w;//反正后面也要预乘\n	\n	v_useTex = attribFlags.r/255.0;\n	float clipw = length(clipMatDir.xy);\n	float cliph = length(clipMatDir.zw);\n	vec2 clippos = posuv.xy - clipMatPos.xy;	//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n	if(clipw>20000. && cliph>20000.)\n		cliped = vec2(0.5,0.5);\n	else {\n		//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n		cliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n	}\n\n}","/*\n	texture和fillrect使用的。\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n//FILLTEXTURE\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n\nvoid main() {\n	if(cliped.x<0.) discard;\n	if(cliped.x>1.) discard;\n	if(cliped.y<0.) discard;\n	if(cliped.y>1.) discard;\n	\n#ifdef FILLTEXTURE	\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n	gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n	gl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n	gl_FragColor =   blur();\n	gl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n	mat4 alphaMat =colorMat;\n\n	alphaMat[0][3] *= gl_FragColor.a;\n	alphaMat[1][3] *= gl_FragColor.a;\n	alphaMat[2][3] *= gl_FragColor.a;\n\n	gl_FragColor = gl_FragColor * alphaMat;\n	gl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n	const float c_IterationTime = 10.0;\n	float floatIterationTotalTime = c_IterationTime * c_IterationTime;\n	vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n	vec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n	vec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n	float maxNum = u_blurInfo1.x * u_blurInfo1.y;\n	vec2 vec2Off = vec2(0.0,0.0);\n	float floatOff = c_IterationTime/2.0;\n	for(float i = 0.0;i<=c_IterationTime; ++i){\n		for(float j = 0.0;j<=c_IterationTime; ++j){\n			vec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n			vec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n		}\n	}\n	gl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n	gl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}","posuv,attribColor,attribFlags","size,clipMatDir,clipMatPos,texture,colorMat,colorAlpha,strength_sig2_2sig2_gauss1,blurInfo,u_color,u_blurInfo1,u_blurInfo2"),t.PROGRAMEX_DRAWVG=K.instance.createProgramEx("attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n	uniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n	\n#ifdef WORLDMAT\n	vec4 pos=mmat*vec4(position.xy,0.,1.);\n	gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n	gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif	\n	float clipw = length(clipMatDir.xy);\n	float cliph = length(clipMatDir.zw);\n	vec2 clippos = position.xy - clipMatPos.xy;	//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n	if(clipw>20000. && cliph>20000.)\n		cliped = vec2(0.5,0.5);\n	else {\n		//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n		cliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n	}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}","precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n	//vec4 a=vec4(color.r, color.g, color.b, 1);\n	//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n	gl_FragColor.rgb*=color.a;\n	if(cliped.x<0.) discard;\n	if(cliped.x>1.) discard;\n	if(cliped.y<0.) discard;\n	if(cliped.y>1.) discard;\n}","position,attribColor","size,clipMatDir,clipMatPos"),t.PROGRAMEX_DRAWPARTICLE=K.instance.createProgramEx("attribute vec4 a_CornerTextureCoordinate;\nattribute vec3 a_Position;\nattribute vec3 a_Velocity;\nattribute vec4 a_StartColor;\nattribute vec4 a_EndColor;\nattribute vec3 a_SizeRotation;\nattribute vec2 a_Radius;\nattribute vec4 a_Radian;\nattribute float a_AgeAddScale;\nattribute float a_Time;\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\n\nuniform float u_CurrentTime;\nuniform float u_Duration;\nuniform float u_EndVelocity;\nuniform vec3 u_Gravity;\n\nuniform vec2 size;\nuniform mat4 u_mmat;\n\nvec4 ComputeParticlePosition(in vec3 position, in vec3 velocity,in float age,in float normalizedAge)\n{\n\n   float startVelocity = length(velocity);//起始标量速度\n   float endVelocity = startVelocity * u_EndVelocity;//结束标量速度\n\n   float velocityIntegral = startVelocity * normalizedAge +(endVelocity - startVelocity) * normalizedAge *normalizedAge/2.0;//计算当前速度的标量（单位空间），vt=v0*t+(1/2)*a*(t^2)\n   \n   vec3 addPosition = normalize(velocity) * velocityIntegral * u_Duration;//计算受自身速度影响的位置，转换标量到矢量    \n   addPosition += u_Gravity * age * normalizedAge;//计算受重力影响的位置\n   \n   float radius=mix(a_Radius.x, a_Radius.y, normalizedAge); //计算粒子受半径和角度影响（无需计算角度和半径时，可用宏定义优化屏蔽此计算）\n   float radianHorizontal =mix(a_Radian.x,a_Radian.z,normalizedAge);\n   float radianVertical =mix(a_Radian.y,a_Radian.w,normalizedAge);\n   \n   float r =cos(radianVertical)* radius;\n   addPosition.y += sin(radianVertical) * radius;\n	\n   addPosition.x += cos(radianHorizontal) *r;\n   addPosition.z += sin(radianHorizontal) *r;\n  \n   addPosition.y=-addPosition.y;//2D粒子位置更新需要取负，2D粒子坐标系Y轴正向朝上\n   position+=addPosition;\n   return  vec4(position,1.0);\n}\n\nfloat ComputeParticleSize(in float startSize,in float endSize, in float normalizedAge)\n{    \n    float size = mix(startSize, endSize, normalizedAge);\n    return size;\n}\n\nmat2 ComputeParticleRotation(in float rot,in float age)\n{    \n    float rotation =rot * age;\n    //计算2x2旋转矩阵.\n    float c = cos(rotation);\n    float s = sin(rotation);\n    return mat2(c, -s, s, c);\n}\n\nvec4 ComputeParticleColor(in vec4 startColor,in vec4 endColor,in float normalizedAge)\n{\n	vec4 color=mix(startColor,endColor,normalizedAge);\n    //硬编码设置，使粒子淡入很快，淡出很慢,6.7的缩放因子把置归一在0到1之间，可以谷歌x*(1-x)*(1-x)*6.7的制图表\n    color.a *= normalizedAge * (1.0-normalizedAge) * (1.0-normalizedAge) * 6.7;\n   \n    return color;\n}\n\nvoid main()\n{\n   float age = u_CurrentTime - a_Time;\n   age *= 1.0 + a_AgeAddScale;\n   float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   gl_Position = ComputeParticlePosition(a_Position, a_Velocity, age, normalizedAge);//计算粒子位置\n   float pSize = ComputeParticleSize(a_SizeRotation.x,a_SizeRotation.y, normalizedAge);\n   mat2 rotation = ComputeParticleRotation(a_SizeRotation.z, age);\n	\n    mat4 mat=u_mmat;\n    gl_Position=vec4((mat*gl_Position).xy,0.0,1.0);\n    gl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize*vec2(mat[0][0],mat[1][1]);\n    gl_Position=vec4((gl_Position.x/size.x-0.5)*2.0,(0.5-gl_Position.y/size.y)*2.0,0.0,1.0);\n   \n   v_Color = ComputeParticleColor(a_StartColor,a_EndColor, normalizedAge);\n   v_TextureCoordinate =a_CornerTextureCoordinate.zw;\n}\n\n","#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\n\nvoid main()\n{	\n	gl_FragColor=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n	gl_FragColor.xyz *= v_Color.w;\n}","a_CornerTextureCoordinate,a_Position,a_Velocity,a_StartColor,a_EndColor,a_SizeRotation,a_Radius,a_Radian,a_AgeAddScale,a_Time","u_CurrentTime,u_Duration,u_EndVelocity,u_Gravity,size,u_mmat,u_texture"),t.VDO_MESHQUADTEXTURE=e.createVDO(new Int32Array([5126,0,4,24,5121,16,4,24,5121,20,4,24])),t.VDO_MESHVG=e.createVDO(new Int32Array([5126,0,2,12,5121,8,4,12])),t.VDO_MESHPARTICLE=e.createVDO(new Int32Array([5126,0,4,116,5126,16,3,116,5126,28,3,116,5126,40,4,116,5126,56,4,116,5126,72,3,116,5126,84,2,116,5126,92,4,116,5126,108,1,116,5126,112,1,116])),t._init_simple_texture_cmdEncoder_(),t._init_simple_rect_cmdEncoder_(),t._init_rect_border_cmdEncoder_(),t.SHADER_MACRO_COLOR_FILTER=K.instance.defineShaderMacro("#define COLOR_FILTER",[{uname:4,id:t.GLOBALVALUE_COLORFILTER_COLOR},{uname:5,id:t.GLOBALVALUE_COLORFILTER_ALPHA}]),t.SHADER_MACRO_BLUR_FILTER=K.instance.defineShaderMacro("#define BLUR_FILTER",[{uname:6,id:t.GLOBALVALUE_BLURFILTER_STRENGTH},{uname:7,id:t.GLOBALVALUE_BLURFILTER_BLURINFO}]),t.SHADER_MACRO_GLOW_FILTER=K.instance.defineShaderMacro("#define GLOW_FILTER",[{uname:8,id:t.GLOBALVALUE_GLOWFILTER_COLOR},{uname:9,id:t.GLOBALVALUE_GLOWFILTER_BLURINFO1},{uname:10,id:t.GLOBALVALUE_GLOWFILTER_BLURINFO2}]),J.__init__(),J.__init_END_(),new he,le.charRender=new Ve
}},t._SIMPLE_TEXTURE_CMDENCODER_=null,t._SIMPLE_RECT_CMDENCODER_=null,t._RECT_BORDER_CMD_ENCODER_=null,t.PROGRAMEX_DRAWTEXTURE=0,t.PROGRAMEX_DRAWVG=0,t.PROGRAMEX_DRAWRECT=0,t.PROGRAMEX_DRAWPARTICLE=0,t.VDO_MESHQUADTEXTURE=0,t.VDO_MESHVG=0,t.VDO_MESHPARTICLE=0,t.GLOBALVALUE_VIEWS=0,t.GLOBALVALUE_MATRIX32=0,t.GLOBALVALUE_DRAWTEXTURE_COLOR=0,t.GLOBALVALUE_ITALICDEG=0,t.GLOBALVALUE_CLIP_MAT_DIR=0,t.GLOBALVALUE_CLIP_MAT_POS=0,t.GLOBALVALUE_BLENDFUNC_SRC=0,t.GLOBALVALUE_BLENDFUNC_DEST=0,t.GLOBALVALUE_COLORFILTER_COLOR=0,t.GLOBALVALUE_COLORFILTER_ALPHA=0,t.GLOBALVALUE_BLURFILTER_STRENGTH=0,t.GLOBALVALUE_BLURFILTER_BLURINFO=0,t.SHADER_MACRO_COLOR_FILTER=0,t.SHADER_MACRO_BLUR_FILTER=0,t.SHADER_MACRO_GLOW_FILTER=0,t.GLOBALVALUE_GLOWFILTER_COLOR=0,t.GLOBALVALUE_GLOWFILTER_BLURINFO1=0,t.GLOBALVALUE_GLOWFILTER_BLURINFO2=0,t}(),ee=function(){function t(t,e,i,_,r,a,n){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===_&&(_=1),void 0===r&&(r=0),void 0===a&&(a=0),this._nums=n=n?n:new Float32Array(6),n[0]=t,n[1]=e,n[2]=i,n[3]=_,n[4]=r,n[5]=a,this._checkTransform()}r(t,"laya.layagl.MatrixConch");var e=t.prototype;return e.identity=function(){var t=this._nums;return t[0]=t[3]=1,t[1]=t[4]=t[5]=t[2]=0,this._bTransform=!1,this},e._checkTransform=function(){var t=this._nums;return this._bTransform=1!==t[0]||0!==t[1]||0!==t[2]||1!==t[3]},e.setTranslate=function(t,e){return this._nums[4]=t,this._nums[5]=e,this},e.translate=function(t,e){return this._nums[4]+=t,this._nums[5]+=e,this},e.scale=function(t,e){var i=this._nums;return i[0]*=t,i[3]*=e,i[2]*=t,i[1]*=e,i[4]*=t,i[5]*=e,this._bTransform=!0,this},e.rotate=function(t){var e=this._nums,i=Math.cos(t),_=Math.sin(t),r=e[0],a=e[2],n=e[4];return e[0]=r*i-e[1]*_,e[1]=r*_+e[1]*i,e[2]=a*i-e[3]*_,e[3]=a*_+e[3]*i,e[4]=n*i-e[5]*_,e[5]=n*_+e[5]*i,this._bTransform=!0,this},e.skew=function(t,e){var i=this._nums,_=Math.tan(t),r=Math.tan(e),a=i[0],n=i[1];return i[0]+=r*i[2],i[1]+=r*i[3],i[2]+=_*a,i[3]+=_*n,this},e.invertTransformPoint=function(t){var e=this._nums,i=e[0],_=e[1],r=e[2],a=e[3],n=e[4],s=i*a-_*r,o=a/s,h=-_/s,u=-r/s,l=i/s,c=(r*e[5]-a*n)/s,f=-(i*e[5]-_*n)/s;return t.setTo(o*t.x+u*t.y+c,h*t.x+l*t.y+f)},e.transformPoint=function(t){var e=this._nums;return t.setTo(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},e.transformPointN=function(t){var e=this._nums;return t.setTo(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y)},e.getScaleX=function(){var t=this._nums;return 0===t[1]?this.a:Math.sqrt(t[0]*t[0]+t[1]*t[1])},e.getScaleY=function(){var t=this._nums;return 0===t[2]?t[3]:Math.sqrt(t[2]*t[2]+t[3]*t[3])},e.invert=function(){var t=this._nums,e=t[0],i=t[1],_=t[2],r=t[3],a=t[4],n=e*r-i*_;return t[0]=r/n,t[1]=-i/n,t[2]=-_/n,t[3]=e/n,t[4]=(_*this.ty-r*a)/n,t[5]=-(e*this.ty-i*a)/n,this},e.setTo=function(t,e,i,_,r,a){var n=this._nums;return n[0]=t,n[1]=e,n[2]=i,n[3]=_,n[4]=r,n[5]=a,this},e.concat=function(t){var e=this._nums,i=t._nums,_=e[0],r=e[2],a=e[4];return e[0]=_*i[0]+e[1]*i[2],e[1]=_*i[1]+e[1]*i[3],e[2]=r*i[0]+e[3]*i[2],e[3]=r*i[1]+e[3]*i[3],e[4]=a*i[0]+e[5]*i[2]+i[4],e[5]=a*i[1]+e[5]*i[3]+i[5],this},e.scaleEx=function(t,e){var i=this._nums,_=i[0],r=i[1],a=i[2],n=i[3];0!==r||0!==a?(i[0]=t*_,i[1]=t*r,i[2]=e*a,i[3]=e*n):(i[0]=t*_,i[1]=0*n,i[2]=0*_,i[3]=e*n),this._bTransform=!0},e.rotateEx=function(t){var e=this._nums,i=Math.cos(t),_=Math.sin(t),r=e[0],a=e[1],n=e[2],s=e[3];0!==a||0!==n?(e[0]=i*r+_*n,e[1]=i*a+_*s,e[2]=-_*r+i*n,e[3]=-_*a+i*s):(e[0]=i*r,e[1]=_*s,e[2]=-_*r,e[3]=i*s),this._bTransform=!0},e.clone=function(){var e=this._nums,i=t.create(),_=i._nums;return _[0]=e[0],_[1]=e[1],_[2]=e[2],_[3]=e[3],_[4]=e[4],_[5]=e[5],i._bTransform=this._bTransform,i},e.copyTo=function(t){var e=this._nums,i=t._nums;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],t._bTransform=this._bTransform,t},e.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},e.destroy=function(){this.recover()},e.recover=function(){t._pool.push(this)},a(0,e,"a",function(){return this._nums[0]},function(t){this._nums[0]=t}),a(0,e,"b",function(){return this._nums[1]},function(t){this._nums[1]=t}),a(0,e,"c",function(){return this._nums[2]},function(t){this._nums[2]=t}),a(0,e,"d",function(){return this._nums[3]},function(t){this._nums[3]=t}),a(0,e,"tx",function(){return this._nums[4]},function(t){this._nums[4]=t}),a(0,e,"ty",function(){return this._nums[5]},function(t){this._nums[5]=t}),t.mul=function(t,e,i){var _=t._nums,r=e._nums,a=i._nums,n=_[0],s=_[1],o=_[2],h=_[3],u=_[4],l=_[5],c=r[0],f=r[1],d=r[2],E=r[3],A=r[4],D=r[5];return 0!==f||0!==d?(a[0]=n*c+s*d,a[1]=n*f+s*E,a[2]=o*c+h*d,a[3]=o*f+h*E,a[4]=c*u+d*l+A,a[5]=f*u+E*l+D):(a[0]=n*c,a[1]=s*E,a[2]=o*c,a[3]=h*E,a[4]=c*u+A,a[5]=E*l+D),i},t.mul16=function(t,e,i){var _=t._nums,r=e._nums,a=_[0],n=_[1],s=_[2],o=_[3],h=_[4],u=_[5],l=r[0],c=r[1],f=r[2],d=r[3],E=r[4],A=r[5];return 0!==c||0!==f?(i[0]=a*l+n*f,i[1]=a*c+n*d,i[4]=s*l+o*f,i[5]=s*c+o*d,i[12]=l*h+f*u+E,i[13]=c*h+d*u+A):(i[0]=a*l,i[1]=n*d,i[4]=s*l,i[5]=o*d,i[12]=l*h+E,i[13]=d*u+A),i},t.create=function(e){var i;return t._pool.length?(i=t._pool.pop(),e&&(i._nums=e),i.identity(),i):new t(1,0,0,1,0,0,e)},t.A=0,t.B=1,t.C=2,t.D=3,t.TX=4,t.TY=5,t.EMPTY=new t,t.TEMP=new t,t._pool=[],t}(),ie=(function(){function t(){this._renderType=0,this._repaint=0,this._x=0/0,this._y=0/0}r(t,"laya.layagl.QuickTestTool");var e=t.prototype;return e.render=function(e,i,_){F.spriteCount++,t._addType(this._renderType),t.showRenderTypeInfo(this._renderType),L.renders[this._renderType]._fun(this,e,i+this._x,_+this._y),this._repaint=0},e._stageRender=function(e,_,r){t._countStart(),t._PreStageRender.call(i.stage,e,_,r),t._countEnd()},t.getMCDName=function(e){return t._typeToNameDic[e]},t.showRenderTypeInfo=function(e,i){if(void 0===i&&(i=!1),i||!t.showedDic[e]){if(t.showedDic[e]=!0,!t._rendertypeToStrDic[e]){var _=[],r=0;for(r=1;e>=r;)r&e&&_.push(t.getMCDName(r&e)),r<<=1;t._rendertypeToStrDic[e]=_.join(",")}console.log("cmd:",t._rendertypeToStrDic[e])}},t.__init__=function(){t._typeToNameDic[1]="ALPHA",t._typeToNameDic[2]="TRANSFORM",t._typeToNameDic[256]="TEXTURE",t._typeToNameDic[512]="GRAPHICS",t._typeToNameDic[4096]="ONECHILD",t._typeToNameDic[8192]="CHILDS",t._typeToNameDic[3]="TRANSFORM|ALPHA",t._typeToNameDic[8]="CANVAS",t._typeToNameDic[4]="BLEND",t._typeToNameDic[16]="FILTERS",t._typeToNameDic[32]="MASK",t._typeToNameDic[64]="CLIP",t._typeToNameDic[1024]="LAYAGL3D"},t._countStart=function(){var e;for(e in t._countDic)t._countDic[e]=0},t._countEnd=function(){t._i++,t._i>60&&(t.showCountInfo(),t._i=0)},t._addType=function(e){t._countDic[e]?t._countDic[e]+=1:t._countDic[e]=1},t.showCountInfo=function(){console.log("===================");var e;for(e in t._countDic)console.log("count:"+t._countDic[e]),t.showRenderTypeInfo(e,!0)},t.enableQuickTest=function(){t.__init__(),x.prototype.render=t.prototype.render,t._PreStageRender=N.prototype.render,N.prototype.render=t.prototype._stageRender},t.showedDic={},t._rendertypeToStrDic={},t._typeToNameDic={},t._PreStageRender=null,t._countDic={},t._i=0,t}(),function(){function t(){}return r(t,"laya.webgl.canvas.BlendMode"),t._init_=function(){t.fns=[t.BlendNormal,t.BlendAdd,t.BlendMultiply,t.BlendScreen,t.BlendOverlay,t.BlendLight,t.BlendMask,t.BlendDestinationOut],t.targetFns=[t.BlendNormalTarget,t.BlendAddTarget,t.BlendMultiplyTarget,t.BlendScreenTarget,t.BlendOverlayTarget,t.BlendLightTarget,t.BlendMask,t.BlendDestinationOut]},t.BlendNormal=function(t){ge.setBlendFunc(t,1,771)},t.BlendAdd=function(t){ge.setBlendFunc(t,1,772)},t.BlendMultiply=function(t){ge.setBlendFunc(t,774,771)},t.BlendScreen=function(t){ge.setBlendFunc(t,1,1)},t.BlendOverlay=function(t){ge.setBlendFunc(t,1,769)},t.BlendLight=function(t){ge.setBlendFunc(t,1,1)},t.BlendNormalTarget=function(t){ge.setBlendFunc(t,1,771)},t.BlendAddTarget=function(t){ge.setBlendFunc(t,1,772)},t.BlendMultiplyTarget=function(t){ge.setBlendFunc(t,774,771)},t.BlendScreenTarget=function(t){ge.setBlendFunc(t,1,1)},t.BlendOverlayTarget=function(t){ge.setBlendFunc(t,1,769)},t.BlendLightTarget=function(t){ge.setBlendFunc(t,1,1)},t.BlendMask=function(t){ge.setBlendFunc(t,0,770)},t.BlendDestinationOut=function(t){ge.setBlendFunc(t,0,0)},t.activeBlendFunction=null,t.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],t.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1},t.NORMAL="normal",t.ADD="add",t.MULTIPLY="multiply",t.SCREEN="screen",t.OVERLAY="overlay",t.LIGHT="light",t.MASK="mask",t.DESTINATIONOUT="destination-out",t.LIGHTER="lighter",t.fns=[],t.targetFns=[],t}()),_e=function(){function t(t){this._color=null,this.setValue(t)}r(t,"laya.webgl.canvas.DrawStyle");var e=t.prototype;return e.setValue=function(t){this._color=t?t instanceof laya.utils.ColorUtils?t:u.create(t):u.create("#000000")},e.reset=function(){this._color=u.create("#000000")},e.toInt=function(){return this._color.numColor},e.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.ColorUtils?this._color.numColor===t.numColor:!1},e.toColorStr=function(){return this._color.strColor},t.create=function(e){if(e){var i=e instanceof laya.utils.ColorUtils?e:u.create(e);return i._drawStyle||(i._drawStyle=new t(e))}return t.DEFAULT},t.DEFAULT=new t("#000000"),t}(),re=function(){function t(){this._lastOriX=0,this._lastOriY=0,this.paths=[],this._curPath=null}var e;r(t,"laya.webgl.canvas.Path");var i=t.prototype;return i.beginPath=function(t){this.paths.length=1,this._curPath=this.paths[0]=new e,this._curPath.convex=t},i.closePath=function(){this._curPath.loop=!0},i.newPath=function(){this._curPath=new e,this.paths.push(this._curPath)},i.addPoint=function(t,e){this._curPath.path.push(t,e)},i.push=function(t,i){this._curPath?this._curPath.path.length>0&&(this._curPath=new e,this.paths.push(this._curPath)):(this._curPath=new e,this.paths.push(this._curPath));var _=this._curPath;_.path=t.slice(),_.convex=i},i.reset=function(){this.paths.length=0},t.__init$=function(){e=function(){function t(){this.path=[],this.loop=!1,this.convex=!1}return r(t,""),t}()},t}(),ae=function(){function t(){this._clipInfoID=-1,this._globalClipMatrix=new v,this._clipRect=new M}r(t,"laya.webgl.canvas.save.SaveClipRect");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){this._globalClipMatrix.copyTo(e._globalClipMatrix),this._clipRect.clone(e._clipRect),e._clipInfoID=this._clipInfoID,t.POOL[t.POOL._length++]=this},t.save=function(e){if(131072!=(131072&e._saveMark._saveuse)){e._saveMark._saveuse|=131072;var i=t.POOL,_=i._length>0?i[--i._length]:new t;e._globalClipMatrix.copyTo(_._globalClipMatrix),e._clipRect.clone(_._clipRect),_._clipInfoID=e._clipInfoID;var r=e._save;r[r._length++]=_}},t.POOL=z._createArray(),t}(),ne=function(){function t(){this._saveuse=0}r(t,"laya.webgl.canvas.save.SaveMark");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!0},e.restore=function(e){e._saveMark=this._preSaveMark,t.POOL[t.POOL._length++]=this},t.Create=function(e){var i=t.POOL,_=i._length>0?i[--i._length]:new t;return _._saveuse=0,_._preSaveMark=e._saveMark,e._saveMark=_,_},t.POOL=z._createArray(),t}(),se=function(){function t(){this._matrix=new v}r(t,"laya.webgl.canvas.save.SaveTransform");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._curMat=this._savematrix,t.POOL[t.POOL._length++]=this},t.save=function(e){var i=e._saveMark;if(2048!==(2048&i._saveuse)){i._saveuse|=2048;var _=t.POOL,r=_._length>0?_[--_._length]:new t;r._savematrix=e._curMat,e._curMat=e._curMat.copyTo(r._matrix);var a=e._save;a[a._length++]=r}},t.POOL=z._createArray(),t}(),oe=function(){function t(){this._mat=new v}r(t,"laya.webgl.canvas.save.SaveTranslate");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){this._mat.copyTo(e._curMat),t.POOL[t.POOL._length++]=this},t.save=function(e){var i=t.POOL,_=i._length>0?i[--i._length]:new t;e._curMat.copyTo(_._mat);var r=e._save;r[r._length++]=_},t.POOL=z._createArray(),t}(),he=function(){function t(){this.fontPages=[],this.fontPagesName=[],this._curPage=null,this.tempUV=[0,0,1,0,1,1,0,1],this.fontScaleX=1,this.fontScaleY=1,this._curStrPos=0,this.tempMat=new v,o.onMiniGame&&!o.onAndroid&&(t.isWan1Wan=!0),t.charbookInst=this,le.charRender=O.isConchApp?new Ve:new Fe}var e;r(t,"laya.webgl.resource.CharBook");var a=t.prototype;return a.selectFont=function(e,i){var _,r=Math.max(this.fontScaleX,this.fontScaleY),a=i*r;if(e===t._lastFont&&a===t._lastFontSz)_=t._lastCharPage;else{var n=le.getBmpSize(i)*r,s=Math.floor(n/t.gridSize),o=e+s,h=this.fontPagesName.indexOf(o);if(0>h){var u=new le(e,n,O.isConchApp?0:Math.ceil(i/4));this.fontPages.push(u),this.fontPagesName.push(o),_=u}else _=this.fontPages[h];_.selectSize(i,n),t._lastFont=e,t._lastFontSz=a,t._lastCharPage=_}return _},a.isEmoji=function(e){return t._emojiReg.test(e)},a.getNextChar=function(t){var e=t.length,i=this._curStrPos;if(i>=e)return null;for(var _=i,r=0;e>_;_++){var a=t.charCodeAt(_);if(55296!=(55296&a))if(65038!==a&&65039!==a){if(8205!=a){if(1==r)break;_++;break}r=1}else r=1;else r=1}return this._curStrPos=_,t.substring(i,_)},a.hasFreedText=function(t,e){if(t&&t.length>0)for(var i=e,_=t.length;_>i;i++){var r=t[i];if(r)for(var a=0,n=r.length;n>a;a++){var s=r[a].ri;if(s.tex.__destroyed)return!0}}return!1},a._fast_filltext=function(e,i,_,r,a,n,s,o,h,u,l){if(void 0===l&&(l=0),!(i&&i.length<1||_&&_.length<1)){if(t._curFont=n._font,this.fontScaleX=this.fontScaleY=1,t.scaleFontWithCtx){var f=e.getMatScaleX(),d=e.getMatScaleY();if(1e-4>f||.1>d)return;f>1&&(this.fontScaleX=f),d>1&&(this.fontScaleY=d)}n._italic&&(e._italicDeg=12),this._curPage=this.selectFont(n._family,n._size);var E=r,A=i,D=i,R=0,m=!_&&i instanceof laya.utils.WordText,T=!!_,v=t.cacheRenderInfoInWordText&&m?A.pageChars:[];switch(m?(D=A._text,R=A.width,0>R&&(R=A.width=this._curPage.getWidth(D))):R=this._curPage.getWidth(D),u){case c.ENUM_TEXTALIGN_CENTER:E=r-R/2;break;case c.ENUM_TEXTALIGN_RIGHT:E=r-R;break;default:E=r}A&&A.lastGCCnt!=this._curPage.gcCnt&&(A.lastGCCnt=this._curPage.gcCnt,m&&this.hasFreedText(v,A.startID)&&(v=A.pageChars=[]));var P=m?A.startID:0,p=m?A.startIDStroke:0;if(!v||v.length<1){var C=null;t.scaleFontWithCtx&&(le.charRender.scale(Math.max(this.fontScaleX,1),Math.max(this.fontScaleY,1)),(this.fontScaleX>1||this.fontScaleY>1)&&(C=""+(10*this.fontScaleX|0)+(10*this.fontScaleY|0))),P=-1,p=-1;var M=0,O=0;this._curStrPos=0;var L;if(T){var y=_[this._curStrPos++];L=y.char,M=y.x,O=y.y}else L=this.getNextChar(D);for(var S=n._bold;L;){var g,b=this.isEmoji(L);if(g=this._curPage.getChar(L,h,n._size,s,o,S,!1,C),g.isSpace);else{var B=v[g.tex.id];B||(v[g.tex.id]=B=[],(0>P||P>g.tex.id)&&(P=g.tex.id)),B.push({ri:g,isEmoji:b,x:M,y:O,color:"#"+(16777215&s).toString(16),nColor:s,w:g.bmpWidth/this.fontScaleX,h:g.bmpHeight/this.fontScaleY})}T?(y=_[this._curStrPos++],y?(L=y.char,M=y.x,O=y.y):L=null):(L=this.getNextChar(D),M+=g.width)}m&&(A.startID=P,A.startIDStroke=p)}this._drawResortedWords(e,E,v,P,a),e._italicDeg=0}},a.fillWords=function(e,i,_,r,a,n,s,o){if(i&&!(i.length<=0)){var h=u.create(n).numColor,l=s?u.create(s).numColor:0;t._curFont=a;var c=D.Parse(a);this._fast_filltext(e,null,i,_,r,c,h,l,o,0,0)}},a.filltext=function(e,i,_,r,a,n,s,o,h,l){if(void 0===l&&(l=0),!(i.length<=0)){var f=u.create(n).numColor,d=s?u.create(s).numColor:0;t._curFont=a;var E=D.Parse(a),A=0;switch(h){case"center":A=c.ENUM_TEXTALIGN_CENTER;break;case"right":A=c.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(e,i,null,_,r,E,f,d,o,A,l)}},a.filltext_native=function(e,i,_,r,a,n,s,o,h,l,c){if(void 0===c&&(c=0),!(i&&i.length<=0)){var f=u.create(s).numColor,d=o?u.create(o).numColor:0;if(t._curFont=n,this.fontScaleX=this.fontScaleY=1,t.scaleFontWithCtx){var E=e._curMat.getScaleX(),A=e._curMat.getScaleY();if(1e-4>E||.1>A)return;this.fontScaleX=E,this.fontScaleY=A,le.charRender.scale(this.fontScaleX,this.fontScaleY)}var R=D.Parse(n),m=R._family,T=R._bold;R._italic&&(e._italicDeg=12),this._curPage=this.selectFont(m,R._size*this.fontScaleX);var v=r,P=i,p=i,C=0,M=!_&&p instanceof laya.utils.WordText,O=!!_,L=t.cacheRenderInfoInWordText&&M?P.pageChars:[];switch(M?(p=P.toString(),C=P.width,0>C&&(C=P.width=this._curPage.getWidth(p))):C=this._curPage.getWidth(p),l){case"center":v=r-C/2;break;case"right":v=r-C;break;default:v=r}if(L){for(var y=!1,S=0,g=L.length;g>S;S++){var b=L[S];if(b){for(var B=0,I=b.length;I>B;B++){var x=b[B];if(x.ri.tex.__destroyed){y=!0;break}}if(y)break}}y&&(L=P.pageChars=[])}if(!L||L.length<=0){var N=null;t.scaleFontWithCtx&&(le.charRender.scale(Math.max(this.fontScaleX,1),Math.max(this.fontScaleY,1)),(this.fontScaleX>1||this.fontScaleY>1)&&(N=""+(10*this.fontScaleX|0)+(10*this.fontScaleY|0)));var F=0,V=0;this._curStrPos=0;var w;if(O){var U=_[this._curStrPos++];w=U.char,F=U.x,V=U.y}else w=this.getNextChar(p);for(T=R._bold;w;){var W,G=this.isEmoji(w);if(W=this._curPage.getChar(w,h,R._size,f,d,T,!1,N),W.isSpace);else{var X=L[W.tex.id];X||(L[W.tex.id]=X=[]),X.push({ri:W,isEmoji:G,x:F,y:V,color:s,nColor:f})}O?(U=_[this._curStrPos++],U?(w=U.char,F=U.x,V=U.y):w=null):(F+=W.width,w=this.getNextChar(p))}}var k=e._drawTextureUseColor;this._drawResortedWords_native(e,v,L,a),e._drawTextureUseColor=k,e._italicDeg=0}},a._drawResortedWords=function(t,e,i,_,r){var a=t.getFillColor();t.setFillColor(t.mixRGBandAlpha(16777215)),e-=this._curPage.margin_left,r-=this._curPage.margin_top;for(var n=_,s=i.length;s>n;n++){var o=i[n];if(o){var h=o.length;if(!(0>=h)){t._useNewTex2DSubmit(o[0].ri.tex.texture,4*h);for(var u=0;h>u;u++){var l=o[u],c=l.ri;c.isSpace||(c.touch(),t._drawTexRect(e+l.x,r+l.y,l.w,l.h,c.uv),t.touches&&t.touches.push(c))}}}}t.setFillColor(a),t._curSubmit._key.other=-1},a._drawResortedWords_native=function(e,i,_,r){for(var a=0,n=0,s=_.length;s>n;n++){var o=_[n];if(o)for(var h=0,u=o.length;u>h;h++){var l=o[h],c=l.ri;c.isSpace||(e._drawTextureUseColor=t.getFontBmpWithColor?!1:!l.isEmoji,a!=l.nColor&&(e.fillStyle=l.color,a=l.nColor),c.touch(),this._drawCharRenderInfo(e,l.ri,i+l.x,l.y+r))}}},a._drawCharRenderInfo=function(t,e,i,_){t._drawTextureM(e.tex.texture,i-this._curPage.margin_left,_-this._curPage.margin_top,e.bmpWidth,e.bmpHeight,null,1,e.uv),t.touches&&t.touches.push(e)},a.GC=function(){var t=this.fontPages.length;if(t){var e=F.loopCount%t;this.fontPages[e].removeLRU()}},t.textureWidth=512,t.cacheRenderInfoInWordText=!0,t.scaleFontWithCtx=!0,t.getFontBmpWithColor=!0,t.gridSize=16,t.debug=!1,t._curFont=null,t.charbookInst=null,t._fontMem=0,t._lastFont=null,t._lastFontSz=0,t._lastCharPage=null,t.isWan1Wan=!1,_(t,["_emojiReg",function(){return this._emojiReg=/(?:0\u20E3|1\u20E3|2\u20E3|3\u20E3|4\u20E3|5\u20E3|6\u20E3|7\u20E3|8\u20E3|9\u20E3|#\u20E3|\*\u20E3|\uD83C(?:\uDDE6\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF2|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFD|\uDDFF)|\uDDE7\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFC|\uDDFE|\uDDFF)|\uDDE8\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDE9\uD83C(?:\uDDEA|\uDDEC|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDFF)|\uDDEA\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDED|\uDDF7|\uDDF8|\uDDF9|\uDDFA)|\uDDEB\uD83C(?:\uDDEE|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDF7)|\uDDEC\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF1|\uDDF2|\uDDF3|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFE)|\uDDED\uD83C(?:\uDDF0|\uDDF2|\uDDF3|\uDDF7|\uDDF9|\uDDFA)|\uDDEE\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9)|\uDDEF\uD83C(?:\uDDEA|\uDDF2|\uDDF4|\uDDF5)|\uDDF0\uD83C(?:\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDF2|\uDDF3|\uDDF5|\uDDF7|\uDDFC|\uDDFE|\uDDFF)|\uDDF1\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDEE|\uDDF0|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFE)|\uDDF2\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDF3\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFF)|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C(?:\uDDE6|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF7|\uDDF8|\uDDF9|\uDDFC|\uDDFE)|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C(?:\uDDEA|\uDDF4|\uDDF8|\uDDFA|\uDDFC)|\uDDF8\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDE9|\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFD|\uDDFE|\uDDFF)|\uDDF9\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF9|\uDDFB|\uDDFC|\uDDFF)|\uDDFA\uD83C(?:\uDDE6|\uDDEC|\uDDF2|\uDDF8|\uDDFE|\uDDFF)|\uDDFB\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDEE|\uDDF3|\uDDFA)|\uDDFC\uD83C(?:\uDDEB|\uDDF8)|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C(?:\uDDEA|\uDDF9)|\uDDFF\uD83C(?:\uDDE6|\uDDF2|\uDDFC)))|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2694\u2696\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD79\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED0\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3]|\uD83E[\uDD10-\uDD18\uDD80-\uDD84\uDDC0]/g},"_uint32",function(){return this._uint32=new Uint32Array(1)},"trash",function(){return this.trash=new e(t.textureWidth)}]),t.__init$=function(){e=function(){function t(t){this.poolLen=0,this.cleanTm=0,this.texW=0,this.pool=new Array(10),this.texW=t}r(t,"");var e=t.prototype;return e.getAPage=function(t){if(this.poolLen>0){var e=this.pool[--this.poolLen];return e.setGridNum(t),this.poolLen>0&&this.clean(),e}return new He(this.texW,this.texW,t)},e.discardPage=function(t){this.clean(),t&&(this.poolLen>=this.pool.length&&(this.pool=this.pool.concat(new Array(10))),t.reset(),this.pool[this.poolLen++]=t)},e.clean=function(){var t=i.stage.getFrameTm();if(0===this.cleanTm&&(this.cleanTm=t),t-this.cleanTm>3e4){for(var e=0;e<this.poolLen;e++){var _=this.pool[e];t-_._discardTm>2e4&&(_.destroy(),this.pool[e]=this.pool[this.poolLen-1],this.poolLen--,e--)}this.cleanTm=t}},t}()},t}(),ue=function(){function t(t){this._par=null,this._loaded=!0,this.bitmap={},this.bitmap.id=t.id,this._par=t}r(t,"laya.webgl.resource.CharInternalTexture");var e=t.prototype;return e._getSource=function(){return this._par._source},t}(),le=function(){function t(t,e,i){this.pages=[],this.fontFamily=null,this._slotW=0,this._gridW=0,this._gridNum=0,this._baseSize=0,this._lastSz=0,this._spaceWidthMap=[],this._minScoreID=-1,this._selectedSizeIdx=0,this.margin_left=0,this.margin_top=0,this.margin_bottom=0,this.margin_right=0,this.gcCnt=0,this._textureWidth=he.textureWidth,this.fontFamily=t,this.margin_top=this.margin_left=this.margin_right=this.margin_bottom=i,this._baseSize=Math.floor(e/he.gridSize)*he.gridSize,this._selectedSizeIdx=e-this._baseSize|0,this._slotW=Math.ceil(e/he.gridSize)*he.gridSize,this._gridW=Math.floor(this._textureWidth/this._slotW),this._gridW<=0&&console.error("文字太大,需要修改texture大小"),this._gridNum=this._gridW*this._gridW,console.log("gridInfo:slotW="+this._slotW+",gridw="+this._gridW+",gridNum="+this._gridNum+",textureW="+this._textureWidth)}r(t,"laya.webgl.resource.CharPages");var e=t.prototype;return e.getWidth=function(e){return t.charRender.getWidth(e)},e.selectSize=function(t,e){this._selectedSizeIdx=e-this._baseSize|0},e.getSpaceChar=function(){if(this._spaceWidthMap[this._selectedSizeIdx])return this._spaceWidthMap[this._selectedSizeIdx];var t=new ce;return this._spaceWidthMap[this._selectedSizeIdx]=t,t.width=this.getWidth(" "),t.isSpace=!0,t},e.getChar=function(t,e,i,_,r,a,n,s){if(" "===t)return this.getSpaceChar(n);var o,h=e>0?t+"_"+e+r:t;_=16777215&_,r=16777215&r,he.getFontBmpWithColor&&(h+=16777215===_?"#w":16711680===_?"#b":1048320===_?"#g":255===_?"#r":"#"+_.toString(16)),a&&(h+="B"),s&&(h+=s);for(var u=0,l=this.pages.length;l>u;u++){var c=this.pages[u],f=c.charMaps[this._selectedSizeIdx];if(f&&(o=f.get(h)))return n&&o.touch(),o}o=new ce,this._getASlot(o);var d=o.tex.charMaps[this._selectedSizeIdx];!d&&(d=o.tex.charMaps[this._selectedSizeIdx]=new Map),d.set(h,o),n&&o.touch();var E="",A="";he.getFontBmpWithColor&&(E=((65280&_)+((255&_)<<16)+((16711680&_)>>16)).toString(16),E="#000000".substr(0,7-E.length)+E,e&&(A=((65280&r)+((255&r)<<16)+((16711680&r)>>16)).toString(16),A="#000000".substr(0,7-A.length)+A)),o.height=i;var D=this.getCharBmp(t,he._curFont,e,E,A,o);o.bmpWidth=D.width,o.bmpHeight=D.height;var R=Math.floor(o.pos/this._gridW),m=o.pos%this._gridW,T=m*this._slotW,v=R*this._slotW,P=this._textureWidth,p=T/P,C=v/P,M=(T+D.width)/P,O=(v+D.height)/P,L=o.uv;return L[0]=p,L[1]=C,L[2]=M,L[3]=C,L[4]=M,L[5]=O,L[6]=p,L[7]=O,o.tex.addChar(D,T,v),o},e._getASlot=function(t){for(var e,i=this.pages.length,_=0,r=0;i>r;r++)if(e=this.pages[r],_=e.findAGrid(),_>=0)return t.tex=e,t.pos=_,void 0;if(e=he.trash.getAPage(this._gridNum),this.pages.push(e),_=e.findAGrid(),-1==_)throw"_getASlot error!";t.tex=e,t.pos=_},e.getAllPageScore=function(){for(var t=0,e=this.pages.length,i=F.loopCount,_=0,r=1e4;e>t;t++){var a=this.pages[t];a._scoreTick==i?_+=a._score:a._score=0,a._score<r&&(r=a._score,this._minScoreID=t)}return _},e.removeLRU=function(){var t,e=this._gridNum*this.pages.length-this.getAllPageScore();if(e>=this._gridNum){if(this._minScoreID>=0){console.log("remove font page "+this._minScoreID),t=this.pages[this._minScoreID];var i=t._score;he.trash.discardPage(t),this.pages[this._minScoreID]=this.pages[this.pages.length-1],this.pages.pop();for(var _=F.loopCount,r=0,a=this.pages.length;a>r&&i>0;r++){t=this.pages[r];var n=t.removeOld(_);i-=n}}return this.gcCnt++,!0}return!1},e.getCharBmp=function(e,i,_,r,a,n){return t.charRender.getCharBmp(e,i,_,r,a,n,this.margin_left,this.margin_top,this.margin_right,this.margin_bottom)},t.getBmpSize=function(t){return 1.5*t},t.charRender=null,t}(),ce=function(){function t(){this.tex=null,this.uv=[0,0,1,1],this.pos=0,this.width=0,this.height=0,this.bmpWidth=0,this.bmpHeight=0,this.touchTick=0,this.isSpace=!1}r(t,"laya.webgl.resource.CharRenderInfo");var e=t.prototype;return e.touch=function(){var t=F.loopCount;this.tex._scoreTick!=t&&(this.tex._score=0,this.tex._scoreTick=t),this.touchTick!=t&&this.tex._score++,this.touchTick=t},t}(),fe=function(){function t(){}r(t,"laya.webgl.resource.ICharRender");var e=t.prototype;return e.getWidth=function(){return 0},e.scale=function(){},e.getCharBmp=function(){return null},t}(),de=function(){function t(){}return r(t,"laya.webgl.resource.WebGLRTMgr"),t.getRT=function(e,i){e=0|e,i=0|i,e>=1e4&&console.error("getRT error! w too big");var _,r=1e4*i+e,a=t.dict[r];return a&&a.length>0?(_=a.pop(),_._mgrKey=r,_):(_=new $e(e,i,1,-1),_._mgrKey=r,_)},t.releaseRT=function(e){if(!(e._mgrKey<=0)){var i=t.dict[e._mgrKey];!i&&(i=[],t.dict[e._mgrKey]=i),e._mgrKey=0,i.push(e)}},t.dict={},t}(),Ee=function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new we,this.fillStyle=_e.DEFAULT,this.strokeStyle=_e.DEFAULT}r(t,"laya.webgl.shader.d2.Shader2D");var e=t.prototype;return e.destroy=function(){this.defines=null,this.filters=null},t.__init__=function(){var t,e;t="/*\n	texture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n	uniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n	vec4 pos=mmat*vec4(posuv.xy,0.,1.);\n	gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n	gl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n	v_texcoordAlpha.xy = posuv.zw;\n	//v_texcoordAlpha.z = attribColor.a/255.0;\n	v_color = attribColor/255.0;\n	v_color.xyz*=v_color.w;//反正后面也要预乘\n	\n	v_useTex = attribFlags.r/255.0;\n	float clipw = length(clipMatDir.xy);\n	float cliph = length(clipMatDir.zw);\n	vec2 clippos = posuv.xy - clipMatPos.xy;	//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n	if(clipw>20000. && cliph>20000.)\n		cliped = vec2(0.5,0.5);\n	else {\n		//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n		cliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n	}\n\n}",e="/*\n	texture和fillrect使用的。\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n//FILLTEXTURE\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n\nvoid main() {\n	if(cliped.x<0.) discard;\n	if(cliped.x>1.) discard;\n	if(cliped.y<0.) discard;\n	if(cliped.y>1.) discard;\n	\n#ifdef FILLTEXTURE	\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n	gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n	gl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n	gl_FragColor =   blur();\n	gl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n	mat4 alphaMat =colorMat;\n\n	alphaMat[0][3] *= gl_FragColor.a;\n	alphaMat[1][3] *= gl_FragColor.a;\n	alphaMat[2][3] *= gl_FragColor.a;\n\n	gl_FragColor = gl_FragColor * alphaMat;\n	gl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n	const float c_IterationTime = 10.0;\n	float floatIterationTotalTime = c_IterationTime * c_IterationTime;\n	vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n	vec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n	vec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n	float maxNum = u_blurInfo1.x * u_blurInfo1.y;\n	vec2 vec2Off = vec2(0.0,0.0);\n	float floatOff = c_IterationTime/2.0;\n	for(float i = 0.0;i<=c_IterationTime; ++i){\n		for(float j = 0.0;j<=c_IterationTime; ++j){\n			vec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n			vec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n		}\n	}\n	gl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n	gl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}",Ke.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n	uniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n	\n#ifdef WORLDMAT\n	vec4 pos=mmat*vec4(position.xy,0.,1.);\n	gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n	gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif	\n	float clipw = length(clipMatDir.xy);\n	float cliph = length(clipMatDir.zw);\n	vec2 clippos = position.xy - clipMatPos.xy;	//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n	if(clipw>20000. && cliph>20000.)\n		cliped = vec2(0.5,0.5);\n	else {\n		//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n		cliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n	}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n	//vec4 a=vec4(color.r, color.g, color.b, 1);\n	//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n	gl_FragColor.rgb*=color.a;\n	if(cliped.x<0.) discard;\n	if(cliped.x>1.) discard;\n	if(cliped.y<0.) discard;\n	if(cliped.y>1.) discard;\n}",Ke.preCompile2D(0,4,t,e,null),t="/*\n	texture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n	uniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n	vec4 pos=mmat*vec4(posuv.xy,0.,1.);\n	gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n	gl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n	v_texcoordAlpha.xy = posuv.zw;\n	//v_texcoordAlpha.z = attribColor.a/255.0;\n	v_color = attribColor/255.0;\n	v_color.xyz*=v_color.w;//反正后面也要预乘\n	\n	v_useTex = attribFlags.r/255.0;\n	float clipw = length(clipMatDir.xy);\n	float cliph = length(clipMatDir.zw);\n	vec2 clippos = posuv.xy - clipMatPos.xy;	//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n	if(clipw>20000. && cliph>20000.)\n		cliped = vec2(0.5,0.5);\n	else {\n		//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n		cliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n	}\n\n}",e='#ifdef FSHIGHPRECISION\n	precision highp float;\n#else\n	precision mediump float;\n#endif\n\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n\n#import?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n\n#import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_uniform;\n\n#import?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n\n#import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_uniform;\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   \n   #import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_logic;\n   \n   #import?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   \n   #import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_logic;\n   \n   #import?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Ke.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n	vec4 t_color = texture2D(texture, v_texcoord);\n	gl_FragColor = t_color.rgba * v_color;\n	gl_FragColor *= alpha;\n}",Ke.preCompile2D(0,512,t,e,null)
},t}(),Ae=function(){function t(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}r(t,"laya.webgl.shader.ShaderDefinesBase");var e=t.prototype;return e.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},e.addInt=function(t){return this._value|=t,this._value},e.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},e.isDefine=function(t){return(this._value&t)===t},e.getValue=function(){return this._value},e.setValue=function(t){this._value=t},e.toNameDic=function(){var e=this._int2nameMap[this._value];return e?e:t._toText(this._value,this._int2name,this._int2nameMap)},t._reg=function(t,e,i,_){i[t]=e,_[e]=t},t._toText=function(t,e,i){var _=i[t];if(_)return _;for(var r={},a=1,n=0;32>n&&(a=1<<n,!(a>t));n++)if(t&a){var s=e[a];s&&(r[s]="")}return i[t]=r,r},t._toInt=function(t,e){for(var i=t.split("."),_=0,r=0,a=i.length;a>r;r++){var n=e[i[r]];if(!n)throw new Error("Defines to int err:"+t+"/"+i[r]);_|=n}return _},t}(),De=function(){function t(){this.ib=null,this.vb=null;Se.mainContext;this.ib=ei.create(35048),this.vb=ii.create(8)}r(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),Re=(function(){function t(){}return r(t,"laya.webgl.shader.ShaderValue"),t}(),function(){function t(){}return r(t,"laya.webgl.shapes.BasePoly"),t.createLine2=function(e,i,_,r,a,n,s){if(e.length<4)return null;var o=t.tempData.length>e.length+2?t.tempData:new Array(e.length+2);o[0]=e[0],o[1]=e[1];var h=2,u=0,l=e.length;for(u=2;l>u;u+=2)Math.abs(e[u]-e[u-2])+Math.abs(e[u+1]-e[u-1])>.01&&(o[h++]=e[u],o[h++]=e[u+1]);n&&Math.abs(e[0]-o[h-2])+Math.abs(e[1]-o[h-1])>.01&&(o[h++]=e[0],o[h++]=e[1]);var c=a;l=h/2;var f,d,E,A,D,R,m,T,v,P,p,C,M,O,L,y,S,g,b,B,I,x=_/2;E=o[0],A=o[1],D=o[2],R=o[3],v=-(A-R),P=E-D,I=Math.sqrt(v*v+P*P),v=v/I*x,P=P/I*x;var N=v,F=P;for(s&&(v=s.a*N+s.c*F,P=s.b*N+s.d*F),c.push(E-v,A-P,E+v,A+P),u=1;l-1>u;u++)E=o[2*(u-1)],A=o[2*(u-1)+1],D=o[2*u],R=o[2*u+1],m=o[2*(u+1)],T=o[2*(u+1)+1],v=-(A-R),P=E-D,I=Math.sqrt(v*v+P*P),v=v/I*x,P=P/I*x,s&&(N=v,F=P,v=s.a*N+s.c*F,P=s.b*N+s.d*F),p=-(R-T),C=D-m,I=Math.sqrt(p*p+C*C),p=p/I*x,C=C/I*x,s&&(N=p,F=C,p=s.a*N+s.c*F,C=s.b*N+s.d*F),M=-P+A-(-P+R),O=-v+D-(-v+E),L=(-v+E)*(-P+R)-(-v+D)*(-P+A),y=-C+T-(-C+R),S=-p+D-(-p+m),g=(-p+m)*(-C+R)-(-p+D)*(-C+T),b=M*S-y*O,Math.abs(b)<.1?(b+=10.1,c.push(D-v,R-P,D+v,R+P)):(f=(O*g-S*L)/b,d=(y*L-M*g)/b,B=(f-D)*(f-D)+(d-R)+(d-R),c.push(f,d,D-(f-D),R-(d-R)));for(E=o[h-4],A=o[h-3],D=o[h-2],R=o[h-1],v=-(A-R),P=E-D,I=Math.sqrt(v*v+P*P),v=v/I*x,P=P/I*x,s&&(N=v,F=P,v=s.a*N+s.c*F,P=s.b*N+s.d*F),c.push(D-v,R-P,D+v,R+P),u=1;l>u;u++)i.push(r+2*(u-1),r+2*(u-1)+1,r+2*u+1,r+2*u+1,r+2*u,r+2*(u-1));return c},t.createLineTriangle=function(t,e,i,_){var r=t.slice(),a=r.length,n=r[0],s=r[1],o=r[2],h=r[2],u=0,l=0,c=0,f=0,d=a/2;if(!(1>=d)&&2!=d){for(var E=new Array(4*d),A=0,D=0,R=0;d-1>R;R++)n=r[D++],s=r[D++],o=r[D++],h=r[D++],c=o-n,f=h-s,0!=c&&0!=f&&(u=Math.sqrt(c*c+f*f),u>.001&&(l=4*A,E[l]=n,E[l+1]=s,E[l+2]=c/u,E[l+3]=f/u,A++));for(_?(n=r[a-2],s=r[a-1],o=r[0],h=r[1],c=o-n,f=h-s,0!=c&&0!=f&&(u=Math.sqrt(c*c+f*f),u>.001&&(l=4*A,E[l]=n,E[l+1]=s,E[l+2]=c/u,E[l+3]=f/u,A++))):(l=4*A,E[l]=n,E[l+1]=s,E[l+2]=c/u,E[l+3]=f/u,A++),D=0,R=0;d>R;R++){n=r[D],s=r[D+1],o=r[D+2],h=r[D+3];{r[D+4],r[D+5]}}}},_(t,["tempData",function(){return this.tempData=new Array(256)}]),t}()),me=function(){function t(){}return r(t,"laya.webgl.shapes.Earcut"),t.earcut=function(e,i,_){_=_||2;var r=i&&i.length,a=r?i[0]*_:e.length,n=t.linkedList(e,0,a,_,!0),s=[];if(!n)return s;var o,h,u,l,c,f,d;if(r&&(n=t.eliminateHoles(e,i,n,_)),e.length>80*_){o=u=e[0],h=l=e[1];for(var E=_;a>E;E+=_)c=e[E],f=e[E+1],o>c&&(o=c),h>f&&(h=f),c>u&&(u=c),f>l&&(l=f);d=Math.max(u-o,l-h),d=0!==d?1/d:0}return t.earcutLinked(n,s,_,o,h,d),s},t.linkedList=function(e,i,_,r,a){var n,s;if(a===t.signedArea(e,i,_,r)>0)for(n=i;_>n;n+=r)s=t.insertNode(n,e[n],e[n+1],s);else for(n=_-r;n>=i;n-=r)s=t.insertNode(n,e[n],e[n+1],s);return s&&t.equals(s,s.next)&&(t.removeNode(s),s=s.next),s},t.filterPoints=function(e,i){if(!e)return e;i||(i=e);var _,r=e;do if(_=!1,r.steiner||!t.equals(r,r.next)&&0!==t.area(r.prev,r,r.next))r=r.next;else{if(t.removeNode(r),r=i=r.prev,r===r.next)break;_=!0}while(_||r!==i);return i},t.earcutLinked=function(e,i,_,r,a,n,s){if(e){!s&&n&&t.indexCurve(e,r,a,n);for(var o,h,u=e;e.prev!==e.next;)if(o=e.prev,h=e.next,n?t.isEarHashed(e,r,a,n):t.isEar(e))i.push(o.i/_),i.push(e.i/_),i.push(h.i/_),t.removeNode(e),e=h.next,u=h.next;else if(e=h,e===u){s?1===s?(e=t.cureLocalIntersections(e,i,_),t.earcutLinked(e,i,_,r,a,n,2)):2===s&&t.splitEarcut(e,i,_,r,a,n):t.earcutLinked(t.filterPoints(e,null),i,_,r,a,n,1);break}}},t.isEar=function(e){var i=e.prev,_=e,r=e.next;if(t.area(i,_,r)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(t.pointInTriangle(i.x,i.y,_.x,_.y,r.x,r.y,a.x,a.y)&&t.area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0},t.isEarHashed=function(e,i,_,r){var a=e.prev,n=e,s=e.next;if(t.area(a,n,s)>=0)return!1;for(var o=a.x<n.x?a.x<s.x?a.x:s.x:n.x<s.x?n.x:s.x,h=a.y<n.y?a.y<s.y?a.y:s.y:n.y<s.y?n.y:s.y,u=a.x>n.x?a.x>s.x?a.x:s.x:n.x>s.x?n.x:s.x,l=a.y>n.y?a.y>s.y?a.y:s.y:n.y>s.y?n.y:s.y,c=t.zOrder(o,h,i,_,r),f=t.zOrder(u,l,i,_,r),d=e.nextZ;d&&d.z<=f;){if(d!==e.prev&&d!==e.next&&t.pointInTriangle(a.x,a.y,n.x,n.y,s.x,s.y,d.x,d.y)&&t.area(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=e.prevZ;d&&d.z>=c;){if(d!==e.prev&&d!==e.next&&t.pointInTriangle(a.x,a.y,n.x,n.y,s.x,s.y,d.x,d.y)&&t.area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0},t.cureLocalIntersections=function(e,i,_){var r=e;do{var a=r.prev,n=r.next.next;!t.equals(a,n)&&t.intersects(a,r,r.next,n)&&t.locallyInside(a,n)&&t.locallyInside(n,a)&&(i.push(a.i/_),i.push(r.i/_),i.push(n.i/_),t.removeNode(r),t.removeNode(r.next),r=e=n),r=r.next}while(r!==e);return r},t.splitEarcut=function(e,i,_,r,a,n){var s=e;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&t.isValidDiagonal(s,o)){var h=t.splitPolygon(s,o);return s=t.filterPoints(s,s.next),h=t.filterPoints(h,h.next),t.earcutLinked(s,i,_,r,a,n),t.earcutLinked(h,i,_,r,a,n),void 0}o=o.next}s=s.next}while(s!==e)},t.eliminateHoles=function(e,i,_,r){var a,n,s,o,h,u=[];for(a=0,n=i.length;n>a;a++)s=i[a]*r,o=n-1>a?i[a+1]*r:e.length,h=t.linkedList(e,s,o,r,!1),h===h.next&&(h.steiner=!0),u.push(t.getLeftmost(h));for(u.sort(t.compareX),a=0;a<u.length;a++)t.eliminateHole(u[a],_),_=t.filterPoints(_,_.next);return _},t.compareX=function(t,e){return t.x-e.x},t.eliminateHole=function(e,i){if(i=t.findHoleBridge(e,i)){var _=t.splitPolygon(i,e);t.filterPoints(_,_.next)}},t.findHoleBridge=function(e,i){var _,r=i,a=e.x,n=e.y,s=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var o=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a>=o&&o>s){if(s=o,o===a){if(n===r.y)return r;if(n===r.next.y)return r.next}_=r.x<r.next.x?r:r.next}}r=r.next}while(r!==i);if(!_)return null;if(a===s)return _.prev;var h,u=_,l=_.x,c=_.y,f=1/0;for(r=_.next;r!==u;)a>=r.x&&r.x>=l&&a!==r.x&&t.pointInTriangle(c>n?a:s,n,l,c,c>n?s:a,n,r.x,r.y)&&(h=Math.abs(n-r.y)/(a-r.x),(f>h||h===f&&r.x>_.x)&&t.locallyInside(r,e)&&(_=r,f=h)),r=r.next;return _},t.indexCurve=function(e,i,_,r){var a=e;do null===a.z&&(a.z=t.zOrder(a.x,a.y,i,_,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,t.sortLinked(a)},t.sortLinked=function(t){var e,i,_,r,a,n,s,o,h=1;do{for(i=t,t=null,a=null,n=0;i;){for(n++,_=i,s=0,e=0;h>e&&(s++,_=_.nextZ,_);e++);for(o=h;s>0||o>0&&_;)0!==s&&(0===o||!_||i.z<=_.z)?(r=i,i=i.nextZ,s--):(r=_,_=_.nextZ,o--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=_}a.nextZ=null,h*=2}while(n>1);return t},t.zOrder=function(t,e,i,_,r){return t=32767*(t-i)*r,e=32767*(e-_)*r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1},t.getLeftmost=function(t){var e=t,i=t;do e.x<i.x&&(i=e),e=e.next;while(e!==t);return i},t.pointInTriangle=function(t,e,i,_,r,a,n,s){return(r-n)*(e-s)-(t-n)*(a-s)>=0&&(t-n)*(_-s)-(i-n)*(e-s)>=0&&(i-n)*(a-s)-(r-n)*(_-s)>=0},t.isValidDiagonal=function(e,i){return e.next.i!==i.i&&e.prev.i!==i.i&&!t.intersectsPolygon(e,i)&&t.locallyInside(e,i)&&t.locallyInside(i,e)&&t.middleInside(e,i)},t.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},t.equals=function(t,e){return t.x===e.x&&t.y===e.y},t.intersects=function(e,i,_,r){return t.equals(e,i)&&t.equals(_,r)||t.equals(e,r)&&t.equals(_,i)?!0:t.area(e,i,_)>0!=t.area(e,i,r)>0&&t.area(_,r,e)>0!=t.area(_,r,i)>0},t.intersectsPolygon=function(e,i){var _=e;do{if(_.i!==e.i&&_.next.i!==e.i&&_.i!==i.i&&_.next.i!==i.i&&t.intersects(_,_.next,e,i))return!0;_=_.next}while(_!==e);return!1},t.locallyInside=function(e,i){return t.area(e.prev,e,e.next)<0?t.area(e,i,e.next)>=0&&t.area(e,e.prev,i)>=0:t.area(e,i,e.prev)<0||t.area(e,e.next,i)<0},t.middleInside=function(t,e){var i=t,_=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(_=!_),i=i.next;while(i!==t);return _},t.splitPolygon=function(t,e){var i=new Te(t.i,t.x,t.y),_=new Te(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,_.next=i,i.prev=_,a.next=_,_.prev=a,_},t.insertNode=function(t,e,i,_){var r=new Te(t,e,i);return _?(r.next=_.next,r.prev=_,_.next.prev=r,_.next=r):(r.prev=r,r.next=r),r},t.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},t.signedArea=function(t,e,i,_){for(var r=0,a=e,n=i-_;i>a;a+=_)r+=(t[n]-t[a])*(t[a+1]+t[n+1]),n=a;return r},t}(),Te=function(){function t(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return r(t,"laya.webgl.shapes.EarcutNode"),t}(),ve=function(){function t(e){this.clipInfoID=-1,this._numEle=0,this._ref=1,this._key=new pe,void 0===e&&(e=1e4),this._renderType=e,this._id=++t.ID}r(t,"laya.webgl.submit.Submit");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.getID=function(){return this._id},e.releaseRender=function(){t.RENDERBASE!=this&&--this._ref<1&&(t.POOL[t._poolSize++]=this,this.shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},e.getRenderType=function(){return this._renderType},e.renderSubmit=function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var i=Se.mainContext;return this._mesh.useMesh(i),this.shaderValue.upload(),ie.activeBlendFunction!==this._blendFn&&(ge.setBlend(i,!0),this._blendFn(i),ie.activeBlendFunction=this._blendFn),i.drawElements(4,this._numEle,5123,this._startIdx),F.drawCall++,F.trianglesFaces+=this._numEle/3,1},e._cloneInit=function(t,e,i,_){t._ref=1,t._mesh=i,t._id=this._id,t._key.copyFrom(this._key),t._parent=this,t._blendFn=this._blendFn,t._renderType=this._renderType,t._startIdx=_*Me.BYTES_PIDX,t._numEle=this._numEle,t.shaderValue=this.shaderValue,this.shaderValue.ref++,this._ref++},e.clone=function(){return null},e.reUse=function(){return 0},e.toString=function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key},t.__init__=function(){var e=t.RENDERBASE=new t(-1);e.shaderValue=new Y(0,0),e.shaderValue.ALPHA=1,e._ref=4294967295},t.create=function(e,i,_){var r=t._poolSize?t.POOL[--t._poolSize]:new t;r._ref=1,r._mesh=i,r._key.clear(),r._startIdx=i.indexNum*Me.BYTES_PIDX,r._numEle=0;var a=e._nBlendType;r._blendFn=e._targets?ie.targetFns[a]:ie.fns[a],r.shaderValue=_,r.shaderValue.setValue(e._shader2D);var n=e._shader2D.filters;return n&&r.shaderValue.setFilters(n),r},t.createShape=function(e,i,_,r){var a=t._poolSize?t.POOL[--t._poolSize]:new t;a._mesh=i,a._numEle=_,a._startIdx=2*i.indexNum,a._ref=1,a.shaderValue=r,a.shaderValue.setValue(e._shader2D);var n=e._nBlendType;return a._blendFn=e._targets?ie.targetFns[n]:ie.fns[n],a},t.TYPE_2D=1e4,t.TYPE_CANVAS=10003,t.TYPE_CMDSETRT=10004,t.TYPE_CUSTOM=10005,t.TYPE_BLURRT=10006,t.TYPE_CMDDESTORYPRERT=10007,t.TYPE_DISABLESTENCIL=10008,t.TYPE_OTHERIBVB=10009,t.TYPE_PRIMITIVE=10010,t.TYPE_RT=10011,t.TYPE_BLUR_RT=10012,t.TYPE_TARGET=10013,t.TYPE_CHANGE_VALUE=10014,t.TYPE_SHAPE=10015,t.TYPE_TEXTURE=10016,t.TYPE_FILLTEXTURE=10017,t.KEY_ONCE=-1,t.KEY_FILLRECT=1,t.KEY_DRAWTEXTURE=2,t.KEY_VG=3,t.KEY_TRIANGLES=4,t.RENDERBASE=null,t.ID=1,t.preRender=null,t._poolSize=0,t.POOL=[],t}(),Pe=function(){function t(){this.fun=null,this._this=null,this.args=null,this._ref=1,this._key=new pe}r(t,"laya.webgl.submit.SubmitCMD");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){return this.fun.apply(this._this,this.args),1},e.getRenderType=function(){return 0},e.reUse=function(t,e){return this._ref++,e},e.releaseRender=function(){if(--this._ref<1){var e=t.POOL;e[e._length++]=this}},e.clone=function(){return null},t.create=function(e,i,_){var r=t.POOL._length?t.POOL[--t.POOL._length]:new t;return r.fun=i,r.args=e,r._this=_,r._ref=1,r._key.clear(),r},t.POOL=(t.POOL=[],t.POOL._length=0,t.POOL),t}(),pe=function(){function t(){this.blendShader=0,this.submitType=0,this.other=0,this.clear()}r(t,"laya.webgl.submit.SubmitKey");var e=t.prototype;return e.clear=function(){this.submitType=-1,this.blendShader=this.other=0},e.copyFrom=function(t){this.other=t.other,this.blendShader=t.blendShader,this.submitType=t.submitType},e.copyFrom2=function(t,e,i){this.blendShader=t.blendShader,this.other=i,this.submitType=e},e.equal3_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal4_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal_3=function(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader},e.equal=function(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader},t}(),Ce=function(){function t(){this._mesh=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this._ref=1,this.srcRT=null,this._key=new pe}r(t,"laya.webgl.submit.SubmitTarget");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){var t=Se.mainContext;this._mesh.useMesh(t);var e=this.srcRT;return e&&(this.shaderValue.texture=e._getSource(),this.shaderValue.upload(),this.blend(),F.drawCall++,F.trianglesFaces+=this._numEle/3,Se.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},e.blend=function(){if(ie.activeBlendFunction!==ie.fns[this.blendType]){var t=Se.mainContext;t.enable(3042),ie.fns[this.blendType](t),ie.activeBlendFunction=ie.fns[this.blendType]}},e.getRenderType=function(){return 0},e.releaseRender=function(){if(--this._ref<1){var e=t.POOL;e[e._length++]=this}},e.reUse=function(t,e){return this._startIdx=e,this._ref++,e},t.create=function(e,i,_,r){var a=t.POOL._length?t.POOL[--t.POOL._length]:new t;if(a._mesh=i,a.srcRT=r,a._startIdx=i.indexNum*Me.BYTES_PIDX,a._ref=1,a._key.clear(),a._numEle=0,a.blendType=e._nBlendType,a._key.blendShader=a.blendType,a.shaderValue=_,a.shaderValue.setValue(e._shader2D),e._colorFiler){var n=e._colorFiler;_.defines.add(n.type),_.colorMat=n._mat,_.colorAlpha=n._alpha}return a},t.POOL=(t.POOL=[],t.POOL._length=0,t.POOL),t}(),Me=(function(){function t(){}r(t,"laya.webgl.text.ArabicReshaper");var e=t.prototype;return e.characterMapContains=function(e){for(var i=0;i<t.charsMap.length;++i)if(t.charsMap[i][0]===e)return!0;return!1},e.getCharRep=function(e){for(var i=0;i<t.charsMap.length;++i)if(t.charsMap[i][0]===e)return t.charsMap[i];return!1},e.getCombCharRep=function(e,i){for(var _=0;_<t.combCharsMap.length;++_)if(t.combCharsMap[_][0][0]===e&&t.combCharsMap[_][0][1]===i)return t.combCharsMap[_];return!1},e.isTransparent=function(e){for(var i=0;i<t.transChars.length;++i)if(t.transChars[i]===e)return!0;return!1},e.getOriginalCharsFromCode=function(e){var i=0;for(i=0;i<t.charsMap.length;++i)if(t.charsMap[i].indexOf(e)>-1)return String.fromCharCode(t.charsMap[i][0]);for(i=0;i<t.combCharsMap.length;++i)if(t.combCharsMap[i].indexOf(e)>-1)return String.fromCharCode(t.combCharsMap[i][0][0])+String.fromCharCode(t.combCharsMap[i][0][1]);return String.fromCharCode(e)},e.convertArabic=function(t){for(var e,i,_="",r=0;r<t.length;++r){var a=t.charCodeAt(r);if(this.characterMapContains(a)){for(var n=null,s=null,o=r-1,h=r+1;o>=0&&this.isTransparent(t.charCodeAt(o));--o);for(n=o>=0?t.charCodeAt(o):null,e=n?this.getCharRep(n):!1,(!e||null==e[2]&&null==e[3])&&(n=null);h<t.length&&this.isTransparent(t.charCodeAt(h));++h);if(s=h<t.length?t.charCodeAt(h):null,e=s?this.getCharRep(s):!1,(!e||null==e[3]&&null==e[4])&&(s=null),1604===a&&null!=s&&(1570===s||1571===s||1573===s||1575===s)){i=this.getCombCharRep(a,s),_+=null!=n?String.fromCharCode(i[4]):String.fromCharCode(i[1]),++r;continue}if(e=this.getCharRep(a),null!=n&&null!=s&&null!=e[3]){_+=String.fromCharCode(e[3]);continue}if(null!=n&&null!=e[4]){_+=String.fromCharCode(e[4]);continue}if(null!=s&&null!=e[2]){_+=String.fromCharCode(e[2]);continue}_+=String.fromCharCode(e[1])}else _+=String.fromCharCode(a)}return _},e.convertArabicBack=function(t){var e="",i=0,_=0;for(_=0;_<t.length;++_)i=t.charCodeAt(_),e+=this.getOriginalCharsFromCode(i);return e},_(t,["charsMap",function(){return this.charsMap=[[1569,65152,null,null,null],[1570,65153,null,null,65154],[1571,65155,null,null,65156],[1572,65157,null,null,65158],[1573,65159,null,null,65160],[1574,65161,65163,65164,65162],[1575,65165,null,null,65166],[1576,65167,65169,65170,65168],[1577,65171,null,null,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,null,null,65194],[1584,65195,null,null,65196],[1585,65197,null,null,65198],[1586,65199,null,null,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,1600,1600,1600],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,null,null,65262],[1609,65263,null,null,65264],[1610,65265,65267,65268,65266],[1662,64342,64344,64345,64343],[1740,64508,64510,64511,64509],[1670,64378,64380,64381,64379],[1705,64398,64400,64401,64399],[1711,64402,64404,64405,64403],[1688,64394,null,null,64395]]},"combCharsMap",function(){return this.combCharsMap=[[[1604,1570],65269,null,null,65270],[[1604,1571],65271,null,null,65272],[[1604,1573],65273,null,null,65274],[[1604,1575],65275,null,null,65276]]},"transChars",function(){return this.transChars=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}]),t}(),function(){function t(){}return r(t,"laya.webgl.utils.CONST3D2D"),t.BYTES_PE=4,t.BYTES_PIDX=2,t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,t}()),Oe=(function(){function t(){}return r(t,"laya.webgl.utils.MatirxArray"),t.ArrayMul=function(e,i,_){if(!e)return t.copyArray(i,_),void 0;if(!i)return t.copyArray(e,_),void 0;for(var r=0/0,a=0/0,n=0/0,s=0/0,o=0;4>o;o++)r=e[o],a=e[o+4],n=e[o+8],s=e[o+12],_[o]=r*i[0]+a*i[1]+n*i[2]+s*i[3],_[o+4]=r*i[4]+a*i[5]+n*i[6]+s*i[7],_[o+8]=r*i[8]+a*i[9]+n*i[10]+s*i[11],_[o+12]=r*i[12]+a*i[13]+n*i[14]+s*i[15]},t.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]},t}(),function(){function t(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new ii(t,35048),e?this._vb._resizeBuffer(e,!1):l.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*t,!1),this._ib=new ei,i&&this._ib._resizeBuffer(i,!1)}r(t,"laya.webgl.utils.Mesh2D");var e=t.prototype;return e.cloneWithNewVB=function(){var e=new t(this._stride,0,0);return e._ib=this._ib,e._quadNum=this._quadNum,e._attribInfo=this._attribInfo,e},e.cloneWithNewVBIB=function(){var e=new t(this._stride,0,0);return e._attribInfo=this._attribInfo,e},e.getVBW=function(){return this._vb.setNeedUpload(),this._vb},e.getVBR=function(){return this._vb},e.getIBR=function(){return this._ib},e.getIBW=function(){return this._ib.setNeedUpload(),this._ib},e.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,_=0,r=0;t>r;r++)e[i++]=_,e[i++]=_+2,e[i++]=_+1,e[i++]=_,e[i++]=_+3,e[i++]=_+2,_+=4;this._ib.setNeedUpload()},e.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},e.configVAO=function(t){if(!this._applied){this._applied=!0,this._vao||(this._vao=t.createVertexArray()),ge.bindVertexArray(t,this._vao),this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var e=this._attribInfo.length/3,i=0,_=0;e>_;_++){var r=this._attribInfo[i+1],a=this._attribInfo[i],n=this._attribInfo[i+2];t.enableVertexAttribArray(_),t.vertexAttribPointer(_,r,a,!1,this._stride,n),i+=3}ge.bindVertexArray(t,null)}},e.useMesh=function(t){this._applied||this.configVAO(t),ge.bindVertexArray(t,this._vao),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()},e.getEleNum=function(){return this._ib.getBuffer().byteLength/2},e.releaseMesh=function(){},e.destroy=function(){},e.clearVB=function(){this._vb.clear()},t._gvaoid=0,t}()),Le=function(){function t(){}return r(t,"laya.webgl.utils.RenderState2D"),t.mat2MatArray=function(e,i){var _=e,r=i;return r[0]=_.a,r[1]=_.b,r[2]=t.EMPTYMAT4_ARRAY[2],r[3]=t.EMPTYMAT4_ARRAY[3],r[4]=_.c,r[5]=_.d,r[6]=t.EMPTYMAT4_ARRAY[6],r[7]=t.EMPTYMAT4_ARRAY[7],r[8]=t.EMPTYMAT4_ARRAY[8],r[9]=t.EMPTYMAT4_ARRAY[9],r[10]=t.EMPTYMAT4_ARRAY[10],r[11]=t.EMPTYMAT4_ARRAY[11],r[12]=_.tx,r[13]=_.ty,r[14]=t.EMPTYMAT4_ARRAY[14],r[15]=t.EMPTYMAT4_ARRAY[15],i},t.restoreTempArray=function(){t.TEMPMAT4_ARRAY[0]=1,t.TEMPMAT4_ARRAY[1]=0,t.TEMPMAT4_ARRAY[4]=0,t.TEMPMAT4_ARRAY[5]=1,t.TEMPMAT4_ARRAY[12]=0,t.TEMPMAT4_ARRAY[13]=0},t.clear=function(){t.worldScissorTest=!1,t.worldAlpha=1},t._MAXSIZE=99999999,t.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.worldMatrix4=t.TEMPMAT4_ARRAY,t.worldAlpha=1,t.worldScissorTest=!1,t.worldShaderDefines=null,t.worldFilters=null,t.width=0,t.height=0,_(t,["worldMatrix",function(){return this.worldMatrix=new v}]),t}(),ye=function(){function t(t,i,_,r){function a(t){var i=[],_=new e(i);return n._compileToTree(_,t.split("\n"),0,i,r),_}var n=this,s=o.now();this._VS=a(t),this._PS=a(i),this._nameMap=_,o.now()-s>2&&console.log("ShaderCompile use time:"+(o.now()-s)+"  size:"+t.length+"/"+i.length)}var e,i;r(t,"laya.webgl.utils.ShaderCompile");var a=t.prototype;return a._compileToTree=function(i,_,r,a,n){var s,o,h,u,l,c,f,d=0,E=0,A=0,D=0;for(E=r;E<_.length;E++)if(h=_[E],!(h.length<1)&&(d=h.indexOf("//"),0!==d)){if(d>=0&&(h=h.substr(0,d)),s=f||new e(a),f=null,s.text=h,s.noCompile=!0,(d=h.indexOf("#"))>=0){for(u="#",D=d+1,A=h.length;A>D;D++){var R=h.charAt(D);if(" "===R||"	"===R||"?"===R)break;u+=R}switch(s.name=u,u){case"#ifdef":case"#ifndef":if(s.src=h,s.noCompile=null!=h.match(/[!&|()=<>]/),s.noCompile?console.log("function():Boolean{return "+h.substr(d+s.name.length)+"}"):(c=h.replace(/^\s*/,"").split(/\s+/),s.setCondition(c[1],"#ifdef"===u?1:2),s.text="//"+s.text),s.setParent(i),i=s,n)for(c=h.substr(D).split(t._splitToWordExps3),D=0;D<c.length;D++)h=c[D],h.length&&(n[h]=!0);continue;case"#if":if(s.src=h,s.noCompile=!0,s.setParent(i),i=s,n)for(c=h.substr(D).split(t._splitToWordExps3),D=0;D<c.length;D++)h=c[D],h.length&&"defined"!=h&&(n[h]=!0);continue;case"#else":s.src=h,i=i.parent,o=i.childs[i.childs.length-1],s.noCompile=o.noCompile,s.noCompile||(s.condition=o.condition,s.conditionType=1==o.conditionType?2:1,s.text="//"+s.text+" "+o.text+" "+s.conditionType),s.setParent(i),i=s;continue;case"#endif":i=i.parent,o=i.childs[i.childs.length-1],s.noCompile=o.noCompile,s.noCompile||(s.text="//"+s.text),s.setParent(i);continue;case"#include":c=t.splitToWords(h,null);var m=t.includes[c[1]];if(!m)throw"ShaderCompile error no this include file:"+c[1];if((d=c[0].indexOf("?"))<0){s.setParent(i),h=m.getWith("with"==c[2]?c[3]:null),this._compileToTree(s,h.split("\n"),0,a,n),s.text="";continue}s.setCondition(c[0].substr(d+1),1),s.text=m.getWith("with"==c[2]?c[3]:null);break;case"#import":c=t.splitToWords(h,null),l=c[1],a.push({node:s,file:t.includes[l],ofs:s.text.length});continue}}else{if(o=i.childs[i.childs.length-1],o&&!o.name){a.length>0&&t.splitToWords(h,o),f=s,o.text+="\n"+h;continue}a.length>0&&t.splitToWords(h,s)}s.setParent(i)}},a.createShader=function(t,e,i,_){var r={},a="";if(t)for(var n in t)a+="#define "+n+"\n",r[n]=!0;var s=this._VS.toscript(r,[]),o=this._PS.toscript(r,[]);return(i||Ke.create)(a+s.join("\n"),a+o.join("\n"),e,this._nameMap,_)},t._parseOne=function(e,i,_,r,a,n){var s={type:t.shaderParamsMap[_[r+1]],name:_[r+2],size:isNaN(parseInt(_[r+3]))?1:parseInt(_[r+3])};return n&&("attribute"==a?e.push(s):i.push(s)),":"==_[r+3]&&(s.type=_[r+4],r+=2),r+=2},t.addInclude=function(e,_){if(!_||0===_.length)throw new Error("add shader include file err:"+e);if(t.includes[e])throw new Error("add shader include file err, has add:"+e);t.includes[e]=new i(_)},t.preGetParams=function(e,i){var _=[e,i],r={},a=[],n=[],s={},o=[];r.attributes=a,r.uniforms=n,r.defines=s;for(var h=0,u=0,l=0;2>l;l++){_[l]=_[l].replace(t._removeAnnotation,"");var c,f=_[l].match(t._reg);for(h=0,u=f.length;u>h;h++){var d=f[h];if("attribute"==d||"uniform"==d)h=t._parseOne(a,n,f,h,d,!0);else{if("#define"==d){d=f[++h],o[d]=1;continue}if("#ifdef"==d){c=f[++h];{s[c]=s[c]||[]}for(h++;u>h;h++)if(d=f[h],"attribute"==d||"uniform"==d)h=t._parseOne(a,n,f,h,d,o[c]);else if("#else"==d)for(h++;u>h;h++)if(d=f[h],"attribute"==d||"uniform"==d)h=t._parseOne(a,n,f,h,d,!o[c]);else if("#endif"==d)break}}}}return r},t.splitToWords=function(t,e){for(var i,_,r=[],a=-1,n=0,s=t.length;s>n;n++)if(i=t.charAt(n)," 	=+-*/&%!<>()'\",;".indexOf(i)>=0){if(a>=0&&n-a>1&&(_=t.substr(a,n-a),r.push(_)),'"'==i||"'"==i){var o=t.indexOf(i,n+1);if(0>o)throw"Sharder err:"+t;r.push(t.substr(n+1,o-n-1)),n=o,a=-1;continue}"("==i&&e&&r.length>0&&(_=r[r.length-1]+";","vec4;main;".indexOf(_)<0&&(e.useFuns+=_)),a=-1}else 0>a&&(a=n);return s>a&&s-a>1&&(_=t.substr(a,s-a),r.push(_)),r},t.IFDEF_NO=0,t.IFDEF_YES=1,t.IFDEF_ELSE=2,t.IFDEF_PARENT=3,t._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),t._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),t._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),t.includes={},_(t,["shaderParamsMap",function(){return this.shaderParamsMap={"float":5126,"int":5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),t.__init$=function(){e=function(){function t(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}r(t,"");var e=t.prototype;return e.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},e.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},e.toscript=function(e,i){return this._toscript(e,i,++t.__id)},e._toscript=function(t,e,i){if(this.childs.length<1&&!this.text)return e;e.length;if(this.condition){var _=!!this.condition.call(t);if(2===this.conditionType&&(_=!_),!_)return e}if(this.text&&e.push(this.text),this.childs.length>0&&this.childs.forEach(function(_){_._toscript(t,e,i)}),this.includefiles.length>0&&this.useFuns.length>0)for(var r,a=0,n=this.includefiles.length;n>a;a++)this.includefiles[a].curUseID!=i&&(r=this.includefiles[a].file.getFunsScript(this.useFuns),r.length>0&&(this.includefiles[a].curUseID=i,e[0]=r+e[0]));return e},t.__id=1,t}(),i=function(){function e(e){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=e;for(var i=0,_=0,r=0;;){if(i=e.indexOf("#begin",i),0>i)break;for(r=i+5;;){if(r=e.indexOf("#end",r),0>r)break;if("i"!==e.charAt(r+4))break;r+=5}if(0>r)throw"add include err,no #end:"+e;_=e.indexOf("\n",i);var a=t.splitToWords(e.substr(i,_-i),null);"code"==a[1]?this.codes[a[2]]=e.substr(_+1,r-_-1):"function"==a[1]&&(_=e.indexOf("function",i),_+="function".length,this.funs[a[3]]=e.substr(_+1,r-_-1),this.funnames+=a[3]+";"),i=r+1}}r(e,"");var i=e.prototype;return i.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},i.getFunsScript=function(t){var e="";for(var i in this.funs)t.indexOf(i+";")>=0&&(e+=this.funs[i]);return e},e}()},t}(),Se=(function(){function t(){}return r(t,"laya.webgl.VertexArrayObject"),t}()(function(){function e(e){t.console&&t.console.error&&t.console.error(e)}function i(e){t.console&&t.console.log&&t.console.log(e)}function _(t,i){a[t]=!0,void 0!==i&&e(i)}function r(t){var e=t.getError;t.getError=function(){var i;do i=e.apply(t),i!=t.NO_ERROR&&(a[i]=!0);while(i!=t.NO_ERROR);for(var i in a)if(a[i])return delete a[i],parseInt(i);return t.NO_ERROR}}var a={},n=function o(t){var e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(var i=0;i<this.attribs.length;i++){var _=new o.VertexAttrib(e);this.attribs[i]=_}this.maxAttrib=0};n.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=t.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},n.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var s=function(t){var e=this;this.gl=t,r(t);var _=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(t){return t==e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject==e.defaultVertexArrayObject?null:e.currentVertexArrayObject:_.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(t){var i=e.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,t);var r=i.attribs[t];return r.enabled=!0,_.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(t){var i=e.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,t);var r=i.attribs[t];return r.enabled=!1,_.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(i,r){switch(i){case t.ARRAY_BUFFER:e.currentArrayBuffer=r;break;case t.ELEMENT_ARRAY_BUFFER:e.currentVertexArrayObject.elementArrayBuffer=r}return _.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(i,r){var a=e.currentVertexArrayObject,n=a.attribs[i];
switch(r){case t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return n.buffer;case t.VERTEX_ATTRIB_ARRAY_ENABLED:return n.enabled;case t.VERTEX_ATTRIB_ARRAY_SIZE:return n.size;case t.VERTEX_ATTRIB_ARRAY_STRIDE:return n.stride;case t.VERTEX_ATTRIB_ARRAY_TYPE:return n.type;case t.VERTEX_ATTRIB_ARRAY_NORMALIZED:return n.normalized;default:return _.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(t,i,r,a,n,s){var o=e.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,t);var h=o.attribs[t];return h.buffer=e.currentArrayBuffer,h.size=i,h.type=r,h.normalized=a,h.stride=n,h.offset=s,h.recache(),_.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas.addEventListener("webglcontextrestored",function(){i("OESVertexArrayObject emulation library context restored"),e.reset_()},!0),this.reset_()};s.prototype.VERTEX_ARRAY_BINDING_OES=34229,s.prototype.reset_=function(){var t=void 0!==this.vertexArrayObjects;if(t)for(var e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;var i=this.gl;this.maxVertexAttribs=i.getParameter(i.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new n(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},s.prototype.createVertexArrayOES=function(){var t=new n(this);return this.vertexArrayObjects.push(t),t},s.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject==t&&this.bindVertexArrayOES(null)},s.prototype.isVertexArrayOES=function(t){return t&&t instanceof n&&t.hasBeenBound&&t.ext==this?!0:!1},s.prototype.bindVertexArrayOES=function(t){var e=this.gl;if(t&&!t.isAlive)return _(e.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject"),void 0;var i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var a=this.currentVertexArrayObject;if(r!=a){r&&a.elementArrayBuffer==r.elementArrayBuffer||i.bindBuffer.call(e,e.ELEMENT_ARRAY_BUFFER,a.elementArrayBuffer);for(var n=this.currentArrayBuffer,s=Math.max(r?r.maxAttrib:0,a.maxAttrib),o=0;s>=o;o++){var h=a.attribs[o],u=r?r.attribs[o]:null;if(r&&h.enabled==u.enabled||(h.enabled?i.enableVertexAttribArray.call(e,o):i.disableVertexAttribArray.call(e,o)),h.enabled){var l=!1;r&&h.buffer==u.buffer||(n!=h.buffer&&(i.bindBuffer.call(e,e.ARRAY_BUFFER,h.buffer),n=h.buffer),l=!0),(l||h.cached!=u.cached)&&i.vertexAttribPointer.call(e,o,h.size,h.type,h.normalized,h.stride,h.offset)}}this.currentArrayBuffer!=n&&i.bindBuffer.call(e,e.ARRAY_BUFFER,this.currentArrayBuffer)}},t._setupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){var e=i.call(this,t);return e?e:"OES_vertex_array_object"!==t?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new s(this)),this.__OESVertexArrayObject)}},t._forceSetupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){if("OES_vertex_array_object"===t)return this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new s(this)),this.__OESVertexArrayObject;var e=i.call(this,t);return e?e:null}}}()),function(){function e(){}return r(e,"laya.webgl.WebGL"),e._uint8ArraySlice=function(){for(var t=this,e=t.length,i=new Uint8Array(t.length),_=0;e>_;_++)i[_]=t[_];return i},e._float32ArraySlice=function(){for(var t=this,e=t.length,i=new Float32Array(t.length),_=0;e>_;_++)i[_]=t[_];return i},e._uint16ArraySlice=function(){var t,e=arguments,i=this,_=0,r=0;if(0===e.length)for(_=i.length,t=new Uint16Array(_),r=0;_>r;r++)t[r]=i[r];else if(2===e.length){var a=e[0],n=e[1];if(n>a)for(_=n-a,t=new Uint16Array(_),r=a;n>r;r++)t[r-a]=i[r];else t=new Uint16Array(0)}return t},e._nativeRender_enable=function(){e.isNativeRender_enable||(e.isNativeRender_enable=!0,T.create=function(t,e){return new Je(t,e,1,!1,!1)},ge.__init_native(),Le.width=o.window.innerWidth,Le.height=o.window.innerHeight,b.measureText=function(e,i){return t.conchTextCanvas.font=i,t.conchTextCanvas.measureText(e)},b.enableNative=function(){$.uploadShaderUniforms=$.uploadShaderUniformsForNative;var e=N;if(e.prototype.repaint=e.prototype.repaintForNative,e.prototype.render=e.prototype.renderToNative,O.isConchApp){Z=t.GLCommandEncoder,K=t.LayaGLContext;var i=t.CanvasRenderingContext.prototype,_=q.prototype;q=t.CanvasRenderingContext,i.drawImage=_.drawImage,i.drawTexture=_.drawTexture,i.fillText=_.fillText,i.save=_.save,i.restore=_.restore,i.translate=_.translate,i.scale=_.scale,i.rotate=_.rotate,i.transform=_.transform,i.beginRT=_.beginRT,i.endRT=_.endRT,i.drawCanvas=_.drawCanvas,i.drawTarget=_.drawTarget,i._$get_asBitmap=_._$get_asBitmap,i._$set_asBitmap=_._$set_asBitmap,a(0,i,"asBitmap",i._$get_asBitmap,i._$set_asBitmap)}ze.init(),te.__init__()})},e._webglRender_enable=function(){O.isWebGL||(O.isWebGL=!0,b.initRender=function(t,i,_){function r(t){var e,i=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];l.useWebGL2||i.shift();for(var _=0;_<i.length;_++){try{e=t.getContext(i[_],{stencil:l.isStencil,alpha:l.isAlpha,antialias:l.isAntialias,premultipliedAlpha:l.premultipliedAlpha,preserveDrawingBuffer:l.preserveDrawingBuffer})}catch(r){}if(e)return"webgl2"===i[_]&&(laya.webgl.WebGL._isWebGL2=!0),new K,e}return null}var a=K.instance=laya.webgl.WebGL.mainContext=r(O._mainCanvas.source);if(!a)return!1;t.size(i,_),ge.__init__(a),be.__init__(),ve.__init__();var n=new be;O._context=n,t._setContext(n),laya.webgl.WebGL.shaderHighPrecision=!1;try{var s=a.getShaderPrecisionFormat(35632,36338);e.shaderHighPrecision=s.precision?!0:!1}catch(o){}return K.instance=a,w.__init__(),we.__init__(),Y.__init__(),Ee.__init__(),qe.__int__(a),ie._init_(a),!0},T.create=function(t,e){return new Je(t,e,1,!1,!1)},b.createRenderSprite=function(t,e){return new Be(t,e)},b.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},b.clear=function(t){Le.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=O.context,_=0==e._submits._length||l.preserveDrawingBuffer?u.create(t).arrColor:i.stage._wgColor;_&&e.clearBG(_[0],_[1],_[2],_[3]),Le.clear()},b.drawToCanvas=function(t,e,i,_,r,a){r-=t.x,a-=t.y,r|=0,a|=0,i|=0,_|=0;var n=new be;n.size(i,_),n.asBitmap=!0,n._targets.start(),L.renders[e]._fun(t,n,r,a),n.flush(),n._targets.end(),n._targets.restore();var s=n._targets.getData(0,0,i,_);n.destroy();for(var o=new ImageData(i,_),h=4*i,u=(new Uint8Array(h),o.data),l=_-1,c=l*h,f=0;l>=0;l--)u.set(s.subarray(f,f+h),c),c-=h,f+=h;var d=new m(!0);d.size(i,_);var E=d.getContext("2d");return E.putImageData(o,0,0),d},b.getTexturePixels=function(){return alert("由于编不过，注掉了"),null},A._filter=function(t,e,i,_){var r=e,a=this._next;if(a){var n=t.filters,s=n.length;if(1==s&&32==n[0].type)return e.save(),e.setColorFilter(n[0]),a._fun.call(a,t,e,i,_),e.restore(),void 0;var o,h=Y.create(1,0),u=p.TEMP,l=r._curMat,c=v.create();l.copyTo(c);var f=0,d=0,E=!1,A=t._cacheStyle.filterCache||null;if(A&&0==t.getRepaint()){if(E=t._cacheStyle.hasGlowFilter||!1,E&&(f=50,d=25),o=t.getBounds(),o.width<=0||o.height<=0)return;o.width+=f,o.height+=f,u.x=o.x*c.a+o.y*c.c,u.y=o.y*c.d+o.x*c.b,o.x=u.x,o.y=u.y,u.x=o.width*c.a+o.height*c.c,u.y=o.height*c.d+o.width*c.b,o.width=u.x,o.height=u.y}else{E=t._isHaveGlowFilter(),E&&(f=50,d=25),o=new M,o.copyFrom(t.getSelfBounds()),o.x+=t.x,o.y+=t.y,o.x-=t.pivotX+4,o.y-=t.pivotY+4;var D=o.x,R=o.y;if(o.width+=f+8,o.height+=f+8,u.x=o.x*c.a+o.y*c.c,u.y=o.y*c.d+o.x*c.b,o.x=u.x,o.y=u.y,u.x=o.width*c.a+o.height*c.c,u.y=o.height*c.d+o.width*c.b,o.width=u.x,o.height=u.y,o.width<=0||o.height<=0)return;A&&de.releaseRT(A);var m=de.getRT(o.width,o.height),T=de.getRT(o.width,o.height);t._getCacheStyle().filterCache=A,r.pushRT(),r.useRT(m);var P=t.x-D+d,C=t.y-R+d;a._fun.call(a,t,e,P,C),r.useRT(T);for(var O=0;s>O;O++){0!=O&&(r.useRT(m),r.drawTarget(T,0,0,o.width,o.height,v.TEMP.identity(),h,null,ie.TOINT.overlay),r.useRT(T));var L=n[O];switch(L.type){case 16:L._glRender&&L._glRender.render(m,e,o.width,o.height,L);break;case 8:L._glRender&&L._glRender.render(m,e,o.width,o.height,L);break;case 32:r.setColorFilter(L),r.drawTarget(m,0,0,o.width,o.height,v.EMPTY.identity(),Y.create(1,0)),r.setColorFilter(null)}}r.popRT()}i=i-d-t.x,_=_-d-t.y,u.setTo(i,_),c.transformPoint(u),i=u.x+o.x,_=u.y+o.y,r._drawRenderTexture(T,i,_,o.width,o.height,v.TEMP.identity(),1,$e.defuv),c.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=e._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=e._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=e._uint8ArraySlice))},e.enable=function(){return o.__init__(),o._supportWebGL?(O.isConchApp?e._nativeRender_enable():e._webglRender_enable(),!0):!1},e.onStageResize=function(t,i){null!=e.mainContext&&(e.mainContext.viewport(0,0,t,i),Le.width=t,Le.height=i)},e.mainContext=null,e.shaderHighPrecision=!1,e._isWebGL2=!1,e.isNativeRender_enable=!1,e}()),ge=function(){function e(){}r(e,"laya.webgl.WebGLContext");var i=e.prototype;return i.getContextAttributes=function(){return null},i.isContextLost=function(){},i.getSupportedExtensions=function(){return null},i.getExtension=function(){return null},i.activeTexture=function(){},i.attachShader=function(){},i.bindAttribLocation=function(){},i.bindBuffer=function(){},i.bindFramebuffer=function(){},i.bindRenderbuffer=function(){},i.bindTexture=function(){},i.useTexture=function(){},i.blendColor=function(){},i.blendEquation=function(){},i.blendEquationSeparate=function(){},i.blendFunc=function(){},i.blendFuncSeparate=function(){},i.bufferData=function(){},i.bufferSubData=function(){},i.checkFramebufferStatus=function(){return null},i.clear=function(){},i.clearColor=function(){},i.clearDepth=function(){},i.clearStencil=function(){},i.colorMask=function(){},i.compileShader=function(){},i.copyTexImage2D=function(){},i.copyTexSubImage2D=function(){},i.createBuffer=function(){},i.createFramebuffer=function(){},i.createProgram=function(){},i.createRenderbuffer=function(){},i.createShader=function(){},i.createTexture=function(){return null},i.cullFace=function(){},i.deleteBuffer=function(){},i.deleteFramebuffer=function(){},i.deleteProgram=function(){},i.deleteRenderbuffer=function(){},i.deleteShader=function(){},i.deleteTexture=function(){},i.depthFunc=function(){},i.depthMask=function(){},i.depthRange=function(){},i.detachShader=function(){},i.disable=function(){},i.disableVertexAttribArray=function(){},i.drawArrays=function(){},i.drawElements=function(){},i.enable=function(){},i.enableVertexAttribArray=function(){},i.finish=function(){},i.flush=function(){},i.framebufferRenderbuffer=function(){},i.framebufferTexture2D=function(){},i.frontFace=function(){return null},i.generateMipmap=function(){return null},i.getActiveAttrib=function(){return null},i.getActiveUniform=function(){return null},i.getAttribLocation=function(){return 0},i.getParameter=function(){return null},i.getBufferParameter=function(){return null},i.getError=function(){return null},i.getFramebufferAttachmentParameter=function(){},i.getProgramParameter=function(){return 0},i.getProgramInfoLog=function(){return null},i.getRenderbufferParameter=function(){return null},i.getShaderPrecisionFormat=function(){return null},i.getShaderParameter=function(){},i.getShaderInfoLog=function(){return null},i.getShaderSource=function(){return null},i.getTexParameter=function(){},i.getUniform=function(){},i.getUniformLocation=function(){return null},i.getVertexAttrib=function(){return null},i.getVertexAttribOffset=function(){return null},i.hint=function(){},i.isBuffer=function(){},i.isEnabled=function(){},i.isFramebuffer=function(){},i.isProgram=function(){},i.isRenderbuffer=function(){},i.isShader=function(){},i.isTexture=function(){},i.lineWidth=function(){},i.linkProgram=function(){},i.pixelStorei=function(){},i.polygonOffset=function(){},i.readPixels=function(){},i.renderbufferStorage=function(){},i.sampleCoverage=function(){},i.scissor=function(){},i.shaderSource=function(){},i.stencilFunc=function(){},i.stencilFuncSeparate=function(){},i.stencilMask=function(){},i.stencilMaskSeparate=function(){},i.stencilOp=function(){},i.stencilOpSeparate=function(){},i.texImage2D=function(){},i.texParameterf=function(){},i.texParameteri=function(){},i.texSubImage2D=function(){},i.uniform1f=function(){},i.uniform1fv=function(){},i.uniform1i=function(){},i.uniform1iv=function(){},i.uniform2f=function(){},i.uniform2fv=function(){},i.uniform2i=function(){},i.uniform2iv=function(){},i.uniform3f=function(){},i.uniform3fv=function(){},i.uniform3i=function(){},i.uniform3iv=function(){},i.uniform4f=function(){},i.uniform4fv=function(){},i.uniform4i=function(){},i.uniform4iv=function(){},i.uniformMatrix2fv=function(){},i.uniformMatrix3fv=function(){},i.uniformMatrix4fv=function(){},i.useProgram=function(){},i.validateProgram=function(){},i.vertexAttrib1f=function(){},i.vertexAttrib1fv=function(){},i.vertexAttrib2f=function(){},i.vertexAttrib2fv=function(){},i.vertexAttrib3f=function(){},i.vertexAttrib3fv=function(){},i.vertexAttrib4f=function(){},i.vertexAttrib4fv=function(){},i.vertexAttribPointer=function(){},i.viewport=function(){},i.configureBackBuffer=function(t,e,i,_,r){void 0===_&&(_=!0),void 0===r&&(r=!1)},i.compressedTexImage2D=function(){},i.createVertexArray=function(){throw"not implemented"},i.bindVertexArray=function(){throw"not implemented"},i.deleteVertexArray=function(){throw"not implemented"},i.isVertexArray=function(){throw"not implemented"},e.__init__=function(i){if(e.__init_native(),laya.webgl.WebGLContext._checkExtensions(i),!Se._isWebGL2){t._setupVertexArrayObject&&(o.onMiniGame?t._forceSetupVertexArrayObject(i):t._setupVertexArrayObject(i));var _=(i.rawgl||i).getExtension("OES_vertex_array_object");if(_){console.log("EXT:webgl support OES_vertex_array_object！");var r=i;r.createVertexArray=function(){return _.createVertexArrayOES()},r.bindVertexArray=function(t){_.bindVertexArrayOES(t)},r.deleteVertexArray=function(t){_.deleteVertexArrayOES(t)},r.isVertexArray=function(t){_.isVertexArrayOES(t)}}}},e._getExtension=function(t,i){var _=e._extentionVendorPrefixes;for(var r in _){var a=t.getExtension(_[r]+i);if(a)return a}return null},e._checkExtensions=function(t){return e._extTextureFilterAnisotropic=e._getExtension(t,"EXT_texture_filter_anisotropic"),e._compressedTextureS3tc=e._getExtension(t,"WEBGL_compressed_texture_s3tc"),e._compressedTexturePvrtc=e._getExtension(t,"WEBGL_compressed_texture_pvrtc"),e._compressedTextureEtc1=e._getExtension(t,"WEBGL_compressed_texture_etc1"),null},e.__init_native=function(){if(O.isConchApp){var t=e;t.useProgram=t.useProgramForNative,t.activeTexture=t.activeTextureForNative,t.bindTexture=t.bindTextureForNative,t.bindVertexArray=t.bindVertexArrayForNative,t.setDepthTest=t.setDepthTestForNative,t.setDepthMask=t.setDepthMaskForNative,t.setDepthFunc=t.setDepthFuncForNative,t.setBlend=t.setBlendForNative,t.setBlendFunc=t.setBlendFuncForNative,t.setCullFace=t.setCullFaceForNative,t.setFrontFace=t.setFrontFaceForNative,t._checkExtensions(o.window.LayaGLContext.instance)}},e.useProgram=function(t,i){return e._useProgram===i?!1:(t.useProgram(i),e._useProgram=i,!0)},e.setDepthTest=function(t,i){i!==e._depthTest&&(e._depthTest=i,i?t.enable(2929):t.disable(2929))},e.setDepthMask=function(t,i){i!==e._depthMask&&(e._depthMask=i,t.depthMask(i))},e.setDepthFunc=function(t,i){i!==e._depthFunc&&(e._depthFunc=i,t.depthFunc(i))},e.setBlend=function(t,i){i!==e._blend&&(e._blend=i,i?t.enable(3042):t.disable(3042))},e.setBlendFunc=function(t,i,_){(i!==e._sFactor||_!==e._dFactor)&&(e._sFactor=i,e._dFactor=_,t.blendFunc(i,_))},e.setCullFace=function(t,i){i!==e._cullFace&&(e._cullFace=i,i?t.enable(2884):t.disable(2884))},e.setFrontFace=function(t,i){i!==e._frontFace&&(e._frontFace=i,t.frontFace(i))},e.activeTexture=function(t,i){e._activedTextureID!==i&&(t.activeTexture(i),e._activedTextureID=i)},e.bindTexture=function(t,i,_){e._activeTextures[e._activedTextureID-33984]!==_&&(t.bindTexture(i,_),e._activeTextures[e._activedTextureID-33984]=_)},e.bindVertexArray=function(t,i){e._bindedVAO!==i&&(t.bindVertexArray(i),e._bindedVAO=i)},e.useProgramForNative=function(t,e){return t.useProgram(e),!0},e.setDepthTestForNative=function(t,e){e?t.enable(2929):t.disable(2929)},e.setDepthMaskForNative=function(t,e){t.depthMask(e)},e.setDepthFuncForNative=function(t,e){t.depthFunc(e)},e.setBlendForNative=function(t,e){e?t.enable(3042):t.disable(3042)},e.setBlendFuncForNative=function(t,e,i){t.blendFunc(e,i)},e.setCullFaceForNative=function(t,e){e?t.enable(2884):t.disable(2884)},e.setFrontFaceForNative=function(t,e){t.frontFace(e)},e.activeTextureForNative=function(t,e){t.activeTexture(e)},e.bindTextureForNative=function(t,e,i){t.bindTexture(e,i)},e.bindVertexArrayForNative=function(t,e){t.bindVertexArray(e)},e.DEPTH_BUFFER_BIT=256,e.STENCIL_BUFFER_BIT=1024,e.COLOR_BUFFER_BIT=16384,e.POINTS=0,e.LINES=1,e.LINE_LOOP=2,e.LINE_STRIP=3,e.TRIANGLES=4,e.TRIANGLE_STRIP=5,e.TRIANGLE_FAN=6,e.ZERO=0,e.ONE=1,e.SRC_COLOR=768,e.ONE_MINUS_SRC_COLOR=769,e.SRC_ALPHA=770,e.ONE_MINUS_SRC_ALPHA=771,e.DST_ALPHA=772,e.ONE_MINUS_DST_ALPHA=773,e.DST_COLOR=774,e.ONE_MINUS_DST_COLOR=775,e.SRC_ALPHA_SATURATE=776,e.FUNC_ADD=32774,e.BLEND_EQUATION=32777,e.BLEND_EQUATION_RGB=32777,e.BLEND_EQUATION_ALPHA=34877,e.FUNC_SUBTRACT=32778,e.FUNC_REVERSE_SUBTRACT=32779,e.BLEND_DST_RGB=32968,e.BLEND_SRC_RGB=32969,e.BLEND_DST_ALPHA=32970,e.BLEND_SRC_ALPHA=32971,e.CONSTANT_COLOR=32769,e.ONE_MINUS_CONSTANT_COLOR=32770,e.CONSTANT_ALPHA=32771,e.ONE_MINUS_CONSTANT_ALPHA=32772,e.BLEND_COLOR=32773,e.ARRAY_BUFFER=34962,e.ELEMENT_ARRAY_BUFFER=34963,e.ARRAY_BUFFER_BINDING=34964,e.ELEMENT_ARRAY_BUFFER_BINDING=34965,e.STREAM_DRAW=35040,e.STATIC_DRAW=35044,e.DYNAMIC_DRAW=35048,e.BUFFER_SIZE=34660,e.BUFFER_USAGE=34661,e.CURRENT_VERTEX_ATTRIB=34342,e.FRONT=1028,e.BACK=1029,e.CULL_FACE=2884,e.FRONT_AND_BACK=1032,e.BLEND=3042,e.DITHER=3024,e.STENCIL_TEST=2960,e.DEPTH_TEST=2929,e.SCISSOR_TEST=3089,e.POLYGON_OFFSET_FILL=32823,e.SAMPLE_ALPHA_TO_COVERAGE=32926,e.SAMPLE_COVERAGE=32928,e.NO_ERROR=0,e.INVALID_ENUM=1280,e.INVALID_VALUE=1281,e.INVALID_OPERATION=1282,e.OUT_OF_MEMORY=1285,e.CW=2304,e.CCW=2305,e.LINE_WIDTH=2849,e.ALIASED_POINT_SIZE_RANGE=33901,e.ALIASED_LINE_WIDTH_RANGE=33902,e.CULL_FACE_MODE=2885,e.FRONT_FACE=2886,e.DEPTH_RANGE=2928,e.DEPTH_WRITEMASK=2930,e.DEPTH_CLEAR_VALUE=2931,e.DEPTH_FUNC=2932,e.STENCIL_CLEAR_VALUE=2961,e.STENCIL_FUNC=2962,e.STENCIL_FAIL=2964,e.STENCIL_PASS_DEPTH_FAIL=2965,e.STENCIL_PASS_DEPTH_PASS=2966,e.STENCIL_REF=2967,e.STENCIL_VALUE_MASK=2963,e.STENCIL_WRITEMASK=2968,e.STENCIL_BACK_FUNC=34816,e.STENCIL_BACK_FAIL=34817,e.STENCIL_BACK_PASS_DEPTH_FAIL=34818,e.STENCIL_BACK_PASS_DEPTH_PASS=34819,e.STENCIL_BACK_REF=36003,e.STENCIL_BACK_VALUE_MASK=36004,e.STENCIL_BACK_WRITEMASK=36005,e.VIEWPORT=2978,e.SCISSOR_BOX=3088,e.COLOR_CLEAR_VALUE=3106,e.COLOR_WRITEMASK=3107,e.UNPACK_ALIGNMENT=3317,e.PACK_ALIGNMENT=3333,e.MAX_TEXTURE_SIZE=3379,e.MAX_VIEWPORT_DIMS=3386,e.SUBPIXEL_BITS=3408,e.RED_BITS=3410,e.GREEN_BITS=3411,e.BLUE_BITS=3412,e.ALPHA_BITS=3413,e.DEPTH_BITS=3414,e.STENCIL_BITS=3415,e.POLYGON_OFFSET_UNITS=10752,e.POLYGON_OFFSET_FACTOR=32824,e.TEXTURE_BINDING_2D=32873,e.SAMPLE_BUFFERS=32936,e.SAMPLES=32937,e.SAMPLE_COVERAGE_VALUE=32938,e.SAMPLE_COVERAGE_INVERT=32939,e.NUM_COMPRESSED_TEXTURE_FORMATS=34466,e.COMPRESSED_TEXTURE_FORMATS=34467,e.DONT_CARE=4352,e.FASTEST=4353,e.NICEST=4354,e.GENERATE_MIPMAP_HINT=33170,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.DEPTH_COMPONENT=6402,e.ALPHA=6406,e.RGB=6407,e.RGBA=6408,e.LUMINANCE=6409,e.LUMINANCE_ALPHA=6410,e.UNSIGNED_SHORT_4_4_4_4=32819,e.UNSIGNED_SHORT_5_5_5_1=32820,e.UNSIGNED_SHORT_5_6_5=33635,e.FRAGMENT_SHADER=35632,e.VERTEX_SHADER=35633,e.MAX_VERTEX_ATTRIBS=34921,e.MAX_VERTEX_UNIFORM_VECTORS=36347,e.MAX_VARYING_VECTORS=36348,e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,e.MAX_TEXTURE_IMAGE_UNITS=34930,e.MAX_FRAGMENT_UNIFORM_VECTORS=36349,e.SHADER_TYPE=35663,e.DELETE_STATUS=35712,e.LINK_STATUS=35714,e.VALIDATE_STATUS=35715,e.ATTACHED_SHADERS=35717,e.ACTIVE_UNIFORMS=35718,e.ACTIVE_ATTRIBUTES=35721,e.SHADING_LANGUAGE_VERSION=35724,e.CURRENT_PROGRAM=35725,e.NEVER=512,e.LESS=513,e.EQUAL=514,e.LEQUAL=515,e.GREATER=516,e.NOTEQUAL=517,e.GEQUAL=518,e.ALWAYS=519,e.KEEP=7680,e.REPLACE=7681,e.INCR=7682,e.DECR=7683,e.INVERT=5386,e.INCR_WRAP=34055,e.DECR_WRAP=34056,e.VENDOR=7936,e.RENDERER=7937,e.VERSION=7938,e.NEAREST=9728,e.LINEAR=9729,e.NEAREST_MIPMAP_NEAREST=9984,e.LINEAR_MIPMAP_NEAREST=9985,e.NEAREST_MIPMAP_LINEAR=9986,e.LINEAR_MIPMAP_LINEAR=9987,e.TEXTURE_MAG_FILTER=10240,e.TEXTURE_MIN_FILTER=10241,e.TEXTURE_WRAP_S=10242,e.TEXTURE_WRAP_T=10243,e.TEXTURE_2D=3553,e.TEXTURE_3D=32879,e.TEXTURE=5890,e.TEXTURE_CUBE_MAP=34067,e.TEXTURE_BINDING_CUBE_MAP=34068,e.TEXTURE_CUBE_MAP_POSITIVE_X=34069,e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,e.MAX_CUBE_MAP_TEXTURE_SIZE=34076,e.TEXTURE0=33984,e.TEXTURE1=33985,e.TEXTURE2=33986,e.TEXTURE3=33987,e.TEXTURE4=33988,e.TEXTURE5=33989,e.TEXTURE6=33990,e.TEXTURE7=33991,e.TEXTURE8=33992,e.TEXTURE9=33993,e.TEXTURE10=33994,e.TEXTURE11=33995,e.TEXTURE12=33996,e.TEXTURE13=33997,e.TEXTURE14=33998,e.TEXTURE15=33999,e.TEXTURE16=34e3,e.TEXTURE17=34001,e.TEXTURE18=34002,e.TEXTURE19=34003,e.TEXTURE20=34004,e.TEXTURE21=34005,e.TEXTURE22=34006,e.TEXTURE23=34007,e.TEXTURE24=34008,e.TEXTURE25=34009,e.TEXTURE26=34010,e.TEXTURE27=34011,e.TEXTURE28=34012,e.TEXTURE29=34013,e.TEXTURE30=34014,e.TEXTURE31=34015,e.ACTIVE_TEXTURE=34016,e.REPEAT=10497,e.CLAMP_TO_EDGE=33071,e.MIRRORED_REPEAT=33648,e.FLOAT_VEC2=35664,e.FLOAT_VEC3=35665,e.FLOAT_VEC4=35666,e.INT_VEC2=35667,e.INT_VEC3=35668,e.INT_VEC4=35669,e.BOOL=35670,e.BOOL_VEC2=35671,e.BOOL_VEC3=35672,e.BOOL_VEC4=35673,e.FLOAT_MAT2=35674,e.FLOAT_MAT3=35675,e.FLOAT_MAT4=35676,e.SAMPLER_2D=35678,e.SAMPLER_CUBE=35680,e.VERTEX_ATTRIB_ARRAY_ENABLED=34338,e.VERTEX_ATTRIB_ARRAY_SIZE=34339,e.VERTEX_ATTRIB_ARRAY_STRIDE=34340,e.VERTEX_ATTRIB_ARRAY_TYPE=34341,e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,e.VERTEX_ATTRIB_ARRAY_POINTER=34373,e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,e.COMPILE_STATUS=35713,e.LOW_FLOAT=36336,e.MEDIUM_FLOAT=36337,e.HIGH_FLOAT=36338,e.LOW_INT=36339,e.MEDIUM_INT=36340,e.HIGH_INT=36341,e.FRAMEBUFFER=36160,e.RENDERBUFFER=36161,e.RGBA4=32854,e.RGB5_A1=32855,e.RGB565=36194,e.DEPTH_COMPONENT16=33189,e.STENCIL_INDEX=6401,e.STENCIL_INDEX8=36168,e.DEPTH_STENCIL=34041,e.RENDERBUFFER_WIDTH=36162,e.RENDERBUFFER_HEIGHT=36163,e.RENDERBUFFER_INTERNAL_FORMAT=36164,e.RENDERBUFFER_RED_SIZE=36176,e.RENDERBUFFER_GREEN_SIZE=36177,e.RENDERBUFFER_BLUE_SIZE=36178,e.RENDERBUFFER_ALPHA_SIZE=36179,e.RENDERBUFFER_DEPTH_SIZE=36180,e.RENDERBUFFER_STENCIL_SIZE=36181,e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,e.COLOR_ATTACHMENT0=36064,e.DEPTH_ATTACHMENT=36096,e.STENCIL_ATTACHMENT=36128,e.DEPTH_STENCIL_ATTACHMENT=33306,e.NONE=0,e.FRAMEBUFFER_COMPLETE=36053,e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,e.FRAMEBUFFER_UNSUPPORTED=36061,e.FRAMEBUFFER_BINDING=36006,e.RENDERBUFFER_BINDING=36007,e.MAX_RENDERBUFFER_SIZE=34024,e.INVALID_FRAMEBUFFER_OPERATION=1286,e.UNPACK_FLIP_Y_WEBGL=37440,e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,e.CONTEXT_LOST_WEBGL=37442,e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,e.BROWSER_DEFAULT_WEBGL=37444,e._extTextureFilterAnisotropic=null,e._compressedTextureS3tc=null,e._compressedTexturePvrtc=null,e._compressedTextureEtc1=null,e._glTextureIDs=[33984,33985,33986,33987,33988,33989,33990,33991],e._useProgram=null,e._depthTest=!0,e._depthMask=!0,e._blend=!1,e._cullFace=!1,e._activedTextureID=33984,e._bindedVAO=null,_(e,["_extentionVendorPrefixes",function(){return this._extentionVendorPrefixes=["","WEBKIT_","MOZ_"]},"_activeTextures",function(){return this._activeTextures=new Array(8)},"_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),e}(),be=function(t){function e(){if(this._drawTriUseAbsMatrix=!1,this._id=++e._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._renderCount=0,this._isConvexCmd=!0,this._submits=null,this._curSubmit=null,this.meshlist=[],this._clipInfoID=0,this._lastMatScaleX=1,this._lastMatScaleY=1,this._lastMat_a=1,this._lastMat_b=0,this._lastMat_c=0,this._lastMat_d=1,this._nBlendType=0,this._saveMark=null,this._drawTextureUseColor=!1,this._italicDeg=0,this._lastTex=null,this._fillColor=0,this._flushCnt=0,this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,e.__super.call(this),this._width=99999999,this._height=99999999,this._submitKey=new pe,this._transedPoints=new Array(8),this._temp4Points=new Array(8),this._clipRect=e.MAXCLIPRECT,this._globalClipMatrix=new v(99999999,0,0,99999999,0,0),this._shader2D=new Ee,this.mOutPoint,e._contextcount++,!e.defTexture){var t=new Je(2,2);t.setPixels(new Uint8Array(16)),e.defTexture=new W(t)}this._lastTex=e.defTexture,this.clear()}var s;r(e,"laya.webgl.canvas.WebGLContext2D",t);var o=e.prototype;return o.clearBG=function(t,e,i,_){var r=Se.mainContext;r.clearColor(t,e,i,_),r.clear(16384)},o._getSubmits=function(){return this._submits},o._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var t=0,e=this._submits._length;e>t;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path=null,this._save=null;var i=0;for(t=0,i=this.meshlist.length;i>t;t++){var _=this.meshlist[t];_.destroy()}this.meshlist.length=0,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}},o.destroy=function(){--e._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._mesh.destroy()},o.clear=function(){this._submits||(this._other=s.DEFAULT,this._curMat=v.create(),this._mesh=Ge.getAMesh(),this.meshlist.push(this._mesh),this._pathMesh=ke.getAMesh(),this.meshlist.push(this._pathMesh),this._triangleMesh=Xe.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[ne.Create(this)],this._save.length=10,this._shader2D=new Ee),this._submitKey.clear(),this._mesh.clearVB(),this._renderCount++,this._drawCount=1,this._other=s.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=e.MAXCLIPRECT,this._curSubmit=ve.RENDERBASE,ve.RENDERBASE._ref=16777215,ve.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=_e.DEFAULT;for(var t=0,i=this._submits._length;i>t;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},o.size=function(t,e){(this._width!=t||this._height!=e)&&(this._width=t,this._height=e,this._targets&&(this._targets.destroy(),this._targets=new $e(t,e,1,-1)),O._context==this&&(Se.mainContext.viewport(0,0,t,e),Le.width=t,Le.height=e)),0===t&&0===e&&this._releaseMem()},o.getMatScaleX=function(){return this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b?this._lastMatScaleX:(this._lastMatScaleX=this._curMat.getScaleX(),this._lastMat_a=this._curMat.a,this._lastMat_b=this._curMat.b,this._lastMatScaleX)},o.getMatScaleY=function(){return this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d?this._lastMatScaleY:(this._lastMatScaleY=this._curMat.getScaleY(),this._lastMat_c=this._curMat.c,this._lastMat_d=this._curMat.d,this._lastMatScaleY)},o.setFillColor=function(t){this._fillColor=t},o.getFillColor=function(){return this._fillColor},o.translate=function(t,e){(0!==t||0!==e)&&(oe.save(this),this._curMat._bTransform?(se.save(this),this._curMat.tx+=t*this._curMat.a+e*this._curMat.c,this._curMat.ty+=t*this._curMat.b+e*this._curMat.d):(this._curMat.tx=t,this._curMat.ty=e))},o.save=function(){this._save[this._save._length++]=ne.Create(this)},o.restore=function(){var t=this._save._length,e=this._nBlendType;if(!(1>t)){for(var i=t-1;i>=0;i--){var _=this._save[i];if(_.restore(this),_.isSaveMark())return this._save._length=i,void 0}e!=this._nBlendType&&(this._curSubmit=ve.RENDERBASE)}},o.fillText=function(t,e,i,_,r){this._fillText(t,null,e,i,_,r,null,0,null)},o._fillText=function(t,i,_,r,a,n,s,o,h,u){void 0===u&&(u=0),t?e._charBook.filltext(this,t,_,r,a,n,s,o,h,u):i&&e._charBook.fillWords(this,i,_,r,a,n,s,o)},o._fast_filltext=function(t,i,_,r,a,n,s,o,h){void 0===h&&(h=0),e._charBook._fast_filltext(this,t,null,i,_,r,a,n,s,o,h)},o.fillWords=function(t,e,i,_,r){this._fillText(null,t,e,i,_,r,null,-1,null,0)},o.fillBorderWords=function(t,e,i,_,r,a,n){this._fillBorderText(null,t,e,i,_,r,a,n,null)},o.drawText=function(t,e,i,_,r,a){this._fillText(t,null,e,i,_,u.create(r).strColor,null,-1,a)},o.strokeWord=function(t,e,i,_,r,a,n){this._fillText(t,null,e,i,_,null,u.create(r).strColor,a||1,n)},o.fillBorderText=function(t,e,i,_,r,a,n,s){this._fillBorderText(t,null,e,i,_,u.create(r).strColor,u.create(a).strColor,n,s)},o._fillBorderText=function(t,e,i,_,r,a,n,s,o){this._fillText(t,e,i,_,r,a,n,s||1,o)},o._fillRect=function(t,e,i,_,r){var a=this._curSubmit,n=a&&2===a._key.submitType&&a._key.blendShader===this._submitKey.blendShader;this._mesh.vertNum+4>65535&&(this._mesh=Ge.getAMesh(),this.meshlist.push(this._mesh),n=!1),n&&(n=n&&this.isSameClipInfo(a)),this.transformQuad(t,e,i,_,0,this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,W.NO_UV,r,!1),n||(a=this._curSubmit=We.create(this,this._mesh,Y.create(1,0)),this._submits[this._submits._length++]=a,this.copyClipInfo(a,this._globalClipMatrix),a.shaderValue.textureHost=this._lastTex,a._key.copyFrom2(this._submitKey,2,this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1),a._renderType=10016),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},o.fillRect=function(t,e,i,_,r){var a=r?_e.create(r):this._shader2D.fillStyle,n=this.mixRGBandAlpha(a.toInt());this._fillRect(t,e,i,_,n)},o.fillTexture=function(t,e,_,r,a,n,s){if(!t._getSource())return this.sprite&&i.systemTimer.callLater(this,this._repaintSprite),void 0;var o=this._curSubmit,h=!1;this._mesh.vertNum+4>65535&&(this._mesh=Ge.getAMesh(),this.meshlist.push(this._mesh),h=!1);var u=(t.bitmap,!0),l=!0;switch(n){case"repeat":break;case"repeat-x":l=!1;break;case"repeat-y":u=!1;break;case"no-repeat":u=l=!1}var c=this._temp4Points,f=0,d=0,E=0,A=0,D=0,R=0;if(s.x<0?(E=e,f=-s.x%t.width/t.width):E=e+s.x,s.y<0?(A=_,d=-s.y%t.height/t.height):A=_+s.y,D=e+r,R=_+a,!u&&(D=Math.min(D,e+s.x+t.width)),!l&&(R=Math.min(R,_+s.y+t.height)),!(e>D||_>R||E>D||A>R)){var m=(D-e-s.x)/t.width,T=(R-_-s.y)/t.height;if(this.transformQuad(E,A,D-E,R-A,0,this._curMat,this._transedPoints),c[0]=f,c[1]=d,c[2]=m,c[3]=d,c[4]=m,c[5]=T,c[6]=f,c[7]=T,!this.clipedOff(this._transedPoints)){var v=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,c,v,!0);var P=Y.create(1,0);P.defines.add(256),P.u_TexRange=t.uvrect,o=this._curSubmit=We.create(this,this._mesh,P),this._submits[this._submits._length++]=o,this.copyClipInfo(o,this._globalClipMatrix),o.shaderValue.textureHost=t,o._renderType=10016,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4
}this.breakNextMerge()}},o.setColorFilter=function(t){z.save(this,8388608,this,!0),this._colorFiler=t,this._curSubmit=ve.RENDERBASE},o.drawTexture=function(t,e,i,_,r){this._drawTextureM(t,e,i,_,r,null,1,null)},o.drawTextures=function(t,e,_,r){if(!t._getSource())return this.sprite&&i.systemTimer.callLater(this,this._repaintSprite),void 0;for(var a=e.length/2,n=0,s=0;a>s;s++)this._inner_drawTexture(t,t.bitmap.id,e[n++]+_,e[n++]+r,0,0,null,null,1)},o._drawTextureAddSubmit=function(t,e){var i=null;i=We.create(this,this._mesh,Y.create(1,0)),this._submits[this._submits._length++]=i,i.shaderValue.textureHost=e,i._key.copyFrom2(this._submitKey,2,t),i._renderType=10016,this._curSubmit=i},o._drawTextureM=function(t,e,_,r,a,n,s,o){return t._getSource()?this._inner_drawTexture(t,t.bitmap.id,e,_,r,a,n,o,s):(this.sprite&&i.systemTimer.callLater(this,this._repaintSprite),!1)},o._drawRenderTexture=function(t,e,i,_,r,a,n,s){return this._inner_drawTexture(t,-1,e,i,_,r,a,s,1)},o.submitDebugger=function(){this._submits[this._submits._length++]=Pe.create([],function(){},this)},o.copyClipInfo=function(t,e){var i=t.shaderValue.clipMatDir;i[0]=e.a,i[1]=e.b,i[2]=e.c,i[3]=e.d;var _=t.shaderValue.clipMatPos;_[0]=e.tx,_[1]=e.ty,t.clipInfoID=this._clipInfoID},o.isSameClipInfo=function(t){return t.clipInfoID===this._clipInfoID},o._useNewTex2DSubmit=function(t,e){this._mesh.vertNum+e>65535&&(this._mesh=Ge.getAMesh(),this.meshlist.push(this._mesh));var i=We.create(this,this._mesh,Y.create(1,0));this._submits[this._submits._length++]=this._curSubmit=i,i.shaderValue.textureHost=t,this.copyClipInfo(i,this._globalClipMatrix)},o._drawTexRect=function(t,e,i,_,r){this.transformQuad(t,e,i,_,this._italicDeg,this._curMat,this._transedPoints);var a=this._transedPoints;a[0]=a[0]+.5|0,a[1]=a[1]+.5|0,a[2]=a[2]+.5|0,a[3]=a[3]+.5|0,a[4]=a[4]+.5|0,a[5]=a[5]+.5|0,a[6]=a[6]+.5|0,a[7]=a[7]+.5|0,this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,r,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},o._inner_drawTexture=function(t,i,_,r,a,n,s,o,h){var u=this._curSubmit._key;if(o=o||t._uv,4===u.submitType&&u.other===i){var l=e._drawTexToDrawTri_Vert;return l[0]=_,l[1]=r,l[2]=_+a,l[3]=r,l[4]=_+a,l[5]=r+n,l[6]=_,l[7]=r+n,this._drawTriUseAbsMatrix=!0,this.drawTriangles(t,0,0,l,o,e._drawTexToDrawTri_Index,s,h,null,"normal"),this._drawTriUseAbsMatrix=!1,!0}this._drawCount++;var c=i>=0&&2===u.submitType&&u.other===i;c&&(c=c&&this.isSameClipInfo(this._curSubmit)),this._lastTex=t;var f=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*h);if(this._mesh.vertNum+4>65535&&(this._mesh=Ge.getAMesh(),this.meshlist.push(this._mesh),c=!1),this.transformQuad(_,r,a||t.width,n||t.height,this._italicDeg,s||this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){if(this._mesh.addQuad(this._transedPoints,o,f,!0),!c){var d=We.create(this,this._mesh,Y.create(1,0));this._submits[this._submits._length++]=this._curSubmit=d,d.shaderValue.textureHost=t,d._key.other=i,this.copyClipInfo(d,this._globalClipMatrix)}return this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,!0}return!1},o.transform4Points=function(t,e,i){var _=e.tx,r=e.ty;e._bTransform?(i[0]=t[0]*e.a+t[1]*e.c+_,i[1]=t[0]*e.b+t[1]*e.d+r,i[2]=t[2]*e.a+t[3]*e.c+_,i[3]=t[2]*e.b+t[3]*e.d+r,i[4]=t[4]*e.a+t[5]*e.c+_,i[5]=t[4]*e.b+t[5]*e.d+r,i[6]=t[6]*e.a+t[7]*e.c+_,i[7]=t[6]*e.b+t[7]*e.d+r):(i[0]=t[0]+_,i[1]=t[1]+r,i[2]=t[2]+_,i[3]=t[3]+r,i[4]=t[4]+_,i[5]=t[5]+r,i[6]=t[6]+_,i[7]=t[7]+r)},o.clipedOff=function(){return this._clipRect.width<=0||this._clipRect.height<=0?!0:!1},o.transformQuad=function(t,e,i,_,r,a,n){var s=0;0!=r&&(s=Math.tan(r*Math.PI/180)*_);var o=t+i,h=e+_;this._temp4Points[0]=t+s,this._temp4Points[1]=e,this._temp4Points[2]=o+s,this._temp4Points[3]=e,this._temp4Points[4]=o,this._temp4Points[5]=h,this._temp4Points[6]=t,this._temp4Points[7]=h,this.transform4Points(this._temp4Points,a,n)},o.pushRT=function(){this.addRenderObject(Pe.create(null,$e.pushRT,this))},o.popRT=function(){this.addRenderObject(Pe.create(null,$e.popRT,this)),this.breakNextMerge()},o.useRT=function(t){function e(t){if(!t)throw"error useRT";t.start(),t.clear(0,0,0,0)}this.addRenderObject(Pe.create([t],e,this)),this.breakNextMerge()},o.RTRestore=function(t){function e(t){t.restore()}this.addRenderObject(Pe.create([t],e,this)),this.breakNextMerge()},o.breakNextMerge=function(){this._curSubmit=ve.RENDERBASE},o._repaintSprite=function(){this.sprite&&this.sprite.repaint()},o.drawTextureWithTransform=function(t,i,_,r,a,n,s,o,h){if(!n)return this._drawTextureM(t,i+s,_+o,r,a,null,h,null),void 0;var u=this._curMat;e._tmpMatrix.a=n.a,e._tmpMatrix.b=n.b,e._tmpMatrix.c=n.c,e._tmpMatrix.d=n.d,e._tmpMatrix.tx=n.tx+s,e._tmpMatrix.ty=n.ty+o,e._tmpMatrix._bTransform=n._bTransform,n&&u._bTransform?(v.mul(e._tmpMatrix,u,e._tmpMatrix),n=e._tmpMatrix,n._bTransform=!0):n=e._tmpMatrix,this._drawTextureM(t,i,_,r,a,n,h,null)},o._flushToTarget=function(t,e){Le.worldScissorTest=!1,Se.mainContext.disable(3089);{var i=Le.worldAlpha,_=Le.worldMatrix4,r=Le.worldMatrix;Le.worldShaderDefines}Le.worldMatrix=v.EMPTY,Le.restoreTempArray(),Le.worldMatrix4=Le.TEMPMAT4_ARRAY,Le.worldAlpha=1,Ye.activeShader=null,e.start(),e.clear(0,0,0,0),t._curSubmit=ve.RENDERBASE,t.flush(),t.clear(),e.restore(),t._curSubmit=ve.RENDERBASE,Ye.activeShader=null,Le.worldAlpha=i,Le.worldMatrix4=_,Le.worldMatrix=r},o.drawCanvas=function(t,e,i,_,r){var a,n=t.context;if(n._targets)n._submits._length>0&&(a=Pe.create([n,n._targets],this._flushToTarget,this),this._submits[this._submits._length++]=a),this._drawRenderTexture(n._targets,e,i,_,r,null,1,$e.flipyuv),this._curSubmit=ve.RENDERBASE;else{n.touches&&n.touches.forEach(function(t){t.touch()}),a=Ue.create(n,this._shader2D.ALPHA,this._shader2D.filters),this._submits[this._submits._length++]=a,a._key.clear();var s=_/t.width,o=r/t.height,h=a._matrix;this._curMat.copyTo(h),1!=s&&1!=o&&h.scale(s,o);var u=h.tx,l=h.ty;h.tx=h.ty=0,h.transformPoint(p.TEMP.setTo(e,i)),h.translate(p.TEMP.x+u,p.TEMP.y+l),this._curSubmit=ve.RENDERBASE}},o.drawTarget=function(t,e,i,_,r,a,n,s,o){void 0===o&&(o=-1),this._drawCount++;this.mixRGBandAlpha(this._drawTextureUseColor?this.fillStyle?this.fillStyle.toInt():0:4294967295);if(this._mesh.vertNum+4>65535&&(this._mesh=Ge.getAMesh(),this.meshlist.push(this._mesh)),this.transformQuad(e,i,_,r,0,a||this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,s||W.DEF_UV,4294967295,!0);var h=this._curSubmit=Ce.create(this,this._mesh,n,t);return h.blendType=-1==o?this._nBlendType:o,this.copyClipInfo(h,this._globalClipMatrix),h._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._maxNumEle=Math.max(this._maxNumEle,h._numEle),this._submits[this._submits._length++]=h,this._curSubmit=ve.RENDERBASE,!0}return this._curSubmit=ve.RENDERBASE,!1},o.drawTriangles=function(t,_,r,a,n,s,o,h,u,l){if(!t._getSource())return this.sprite&&i.systemTimer.callLater(this,this._repaintSprite),void 0;this._drawCount++;var c=null,f=!1;u&&(c=this._colorFiler,this._colorFiler=u,this._curSubmit=ve.RENDERBASE,f=c!=u);var d=ie.TOINT[l]||0,E=t.bitmap,A=this._curSubmit._key,D=4===A.submitType&&A.other===E.id&&A.blendShader==d,R=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*h),m=a.length/2,T=s.length;if(this._triangleMesh.vertNum+m>65535&&(this._triangleMesh=Xe.getAMesh(),this.meshlist.push(this._triangleMesh),D=!1),!D){var P=this._curSubmit=We.create(this,this._triangleMesh,Y.create(1,0));P.shaderValue.textureHost=t,P._renderType=10016,P._key.blendShader=d,P._blendFn=this._targets?ie.targetFns[d]:ie.fns[d],P._key.submitType=4,P._key.other=E.id,this.copyClipInfo(P,this._globalClipMatrix),this._submits[this._submits._length++]=P}o?(e._tmpMatrix.a=o.a,e._tmpMatrix.b=o.b,e._tmpMatrix.c=o.c,e._tmpMatrix.d=o.d,e._tmpMatrix.tx=o.tx+_,e._tmpMatrix.ty=o.ty+r):(e._tmpMatrix.a=1,e._tmpMatrix.b=0,e._tmpMatrix.c=0,e._tmpMatrix.d=1,e._tmpMatrix.tx=_,e._tmpMatrix.ty=r),this._drawTriUseAbsMatrix||v.mul(e._tmpMatrix,this._curMat,e._tmpMatrix),this._triangleMesh.addData(a,n,s,e._tmpMatrix,R,this),this._curSubmit._numEle+=T,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),f&&(this._colorFiler=c,this._curSubmit=ve.RENDERBASE)},o.transform=function(t,e,i,_,r,a){se.save(this),v.mul(v.TEMP.setTo(t,e,i,_,r,a),this._curMat,this._curMat),this._curMat._checkTransform()},o._transformByMatrix=function(t,e,i){t.setTranslate(e,i),v.mul(t,this._curMat,this._curMat),t.setTranslate(0,0),this._curMat._bTransform=!0},o.setTransformByMatrix=function(t){t.copyTo(this._curMat)},o.rotate=function(t){se.save(this),this._curMat.rotateEx(t)},o.scale=function(t,e){se.save(this),this._curMat.scaleEx(t,e)},o.clipRect=function(t,i,_,r){ae.save(this),this._clipRect==e.MAXCLIPRECT?this._clipRect=new M(t,i,_,r):(this._clipRect.width=_,this._clipRect.height=r,this._clipRect.x=t,this._clipRect.y=i),e._clipID_Gen++,e._clipID_Gen%=1e4,this._clipInfoID=e._clipID_Gen;var a=this._globalClipMatrix,n=a.tx,s=a.ty,o=n+a.a,h=s+a.d;if(this._clipRect.width>=99999999?(a.a=a.d=99999999,a.b=a.c=a.tx=a.ty=0):this._curMat._bTransform?(a.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,a.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,a.a=this._clipRect.width*this._curMat.a,a.b=this._clipRect.width*this._curMat.b,a.c=this._clipRect.height*this._curMat.c,a.d=this._clipRect.height*this._curMat.d):(a.tx=this._clipRect.x+this._curMat.tx,a.ty=this._clipRect.y+this._curMat.ty,a.a=this._clipRect.width,a.b=a.c=0,a.d=this._clipRect.height),a.a>0&&a.d>0){var u=a.tx+a.a,l=a.ty+a.d;n>=u||s>=l||a.tx>=o||a.ty>=h?(a.a=-.1,a.d=-.1):(a.tx<n&&(a.a-=n-a.tx,a.tx=n),u>o&&(a.a-=u-o),a.ty<s&&(a.d-=s-a.ty,a.ty=s),l>h&&(a.d-=l-h),a.a<=0&&(a.a=-.1),a.d<=0&&(a.d=-.1))}},o.drawMesh=function(t,e,i,_,r,a,n,s,o){void 0===o&&(o=0)},o.addRenderObject=function(t){this._submits[this._submits._length++]=t},o.submitElement=function(t,e){var i=(O._context===this,this._submits),_=i._length;0>e&&(e=i._length);for(var r=ve.RENDERBASE;e>t;)this._renderNextSubmitIndex=t+1,i[t]!==ve.RENDERBASE?(ve.preRender=r,r=i[t],t+=r.renderSubmit()):t++;return _},o.flush=function(){var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset(),De.instance&&De.getInstance().reset(),this._curSubmit=ve.RENDERBASE;for(var e=0,i=this.meshlist.length;i>e;e++){var _=this.meshlist[e];_.canReuse?_.releaseMesh():_.destroy()}return this.meshlist.length=0,this._mesh=Ge.getAMesh(),this._pathMesh=ke.getAMesh(),this._triangleMesh=Xe.getAMesh(),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh),this._flushCnt++,this._flushCnt%600==0&&O._context==this&&he.charbookInst&&he.charbookInst.GC(),t},o.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=k.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},o.beginPath=function(t){void 0===t&&(t=!1);var e=this._getPath();e.beginPath(t)},o.closePath=function(){this._path.closePath()},o.addPath=function(t,e,i,_,r){var a=0,n=this._curMat;if(this._curMat._bTransform)for(var s=0,o=t.length/2;o>s;s++){var h=t[a]+_,u=t[a+1]+r;t[a]=h*n.a+u*n.c+n.tx,t[a+1]=h*n.b+u*n.d+n.ty,a+=2}else if(0!=n.tx||0!=n.ty||_||r)for(s=0,o=t.length/2;o>s;s++){var l=t[a]+_,c=t[a+1]+r;t[a]=l+n.tx,t[a+1]=c+n.ty,a+=2}else;this._getPath().push(t,i)},o.fill=function(){var t=this._getPath(),e=this._curSubmit,i=3===e._key.submitType&&e._key.blendShader===this._submitKey.blendShader;i&&(i=i&&this.isSameClipInfo(e)),i||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var _,r=this.mixRGBandAlpha(this.fillStyle.toInt()),a=0,n=0,s=t.paths.length;s>n;n++){var o=t.paths[n],h=o.path.length/2;if(!(3>h||3==h&&!o.convex)){this._pathMesh.vertNum+h>65535&&(this._curSubmit._numEle+=a,a=0,this._pathMesh=ke.getAMesh(),this._curSubmit=this.addVGSubmit(this._pathMesh));var u=this._pathMesh.vertNum;if(o.convex){var l=h-2;_=new Array(3*l);for(var c=0,f=0;l>f;f++)_[c++]=u,_[c++]=f+1+u,_[c++]=f+2+u}else if(_=me.earcut(o.path,null,2),u>0)for(var d=0;d<_.length;d++)_[d]+=u;this._pathMesh.addVertAndIBToMesh(this,o.path,r,_),a+=_.length}}this._curSubmit._numEle+=a},o.addVGSubmit=function(t){var e=ve.createShape(this,t,0,Y.create(4,0));return e._key.blendShader=this._submitKey.blendShader,e._key.submitType=3,this._submits[this._submits._length++]=e,this.copyClipInfo(e,this._globalClipMatrix),e},o.stroke=function(){if(this.lineWidth>0){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor),e=this._getPath(),i=this._curSubmit,_=3===i._key.submitType&&i._key.blendShader===this._submitKey.blendShader;_&&(_=_&&this.isSameClipInfo(i)),_||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var r=0,a=0,n=e.paths.length;n>a;a++){var s=e.paths[a];if(!(s.path.length<=0)){var o=[],h=[],u=2*s.path.length;2>u||(this._pathMesh.vertNum+u>65535&&(this._curSubmit._numEle+=r,r=0,this._pathMesh=ke.getAMesh(),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),Re.createLine2(s.path,o,this.lineWidth,this._pathMesh.vertNum,h,s.loop,this._curMat),this._pathMesh.addVertAndIBToMesh(this,h,t,o),r+=o.length)}}this._curSubmit._numEle+=r}},o.moveTo=function(t,e,i){void 0===i&&(i=!0);var _=this._getPath();if(_.newPath(),_._lastOriX=t,_._lastOriY=e,i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a+this._curMat.tx,e=this._curMat.b*r+this._curMat.d*a+this._curMat.ty}_.addPoint(t,e)},o.lineTo=function(t,e,i){void 0===i&&(i=!0);var _=this._getPath();if(!(Math.abs(t-_._lastOriX)<.001&&Math.abs(e-_._lastOriY)<.001)){if(_._lastOriX=t,_._lastOriY=e,i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a+this._curMat.tx,e=this._curMat.b*r+this._curMat.d*a+this._curMat.ty}_.addPoint(t,e)}},o.arcTo=function(t,i,_,r,a){var n=0,s=0,o=0,h=this._path._lastOriX-t,u=this._path._lastOriY-i,l=Math.sqrt(h*h+u*u);if(!(1e-6>=l)){var c=h/l,f=u/l,d=_-t,E=r-i,A=d*d+E*E,D=Math.sqrt(A);if(!(1e-6>=D)){var R=d/D,m=E/D,T=c+R,v=f+m,P=Math.sqrt(T*T+v*v);if(!(1e-6>=P)){var p=T/P,C=v/P,M=Math.acos(p*c+C*f),O=Math.PI/2-M;l=a/Math.tan(O);var L=l*c+t,y=l*f+i,S=Math.sqrt(l*l+a*a),g=t+p*S,b=i+C*S,B=c*m-f*R,I=0,x=0,N=0;if(B>=0){I=2*O;var F=I/e.SEGNUM;x=Math.sin(F),N=Math.cos(F)}else I=2*-O,F=I/e.SEGNUM,x=Math.sin(F),N=Math.cos(F);var V=this._path._lastOriX,w=this._path._lastOriY,U=L,W=y;(Math.abs(U-this._path._lastOriX)>.1||Math.abs(W-this._path._lastOriY)>.1)&&(s=this._curMat.a*U+this._curMat.c*W+this._curMat.tx,o=this._curMat.b*U+this._curMat.d*W+this._curMat.ty,V=U,w=W,this._path.addPoint(s,o));var G=L-g,X=y-b;for(n=0;n<e.SEGNUM;n++){var k=G*N+X*x,z=-G*x+X*N;if(s=k+g,o=z+b,Math.abs(V-s)>.1||Math.abs(w-o)>.1){var Y=s,H=o;s=this._curMat.a*Y+this._curMat.c*H+this._curMat.tx,o=this._curMat.b*Y+this._curMat.d*H+this._curMat.ty,this._path.addPoint(s,o),V=s,w=o}G=k,X=z}}}}},o.arc=function(t,e,i,_,r,a,n){void 0===a&&(a=!1),void 0===n&&(n=!0);var s=0,o=0,h=0,u=0,l=0,c=0,f=0,d=0,E=0,A=0,D=0;if(o=r-_,a)if(Math.abs(o)>=2*Math.PI)o=2*-Math.PI;else for(;o>0;)o-=2*Math.PI;else if(Math.abs(o)>=2*Math.PI)o=2*Math.PI;else for(;0>o;)o+=2*Math.PI;var R=this.getMatScaleX(),m=this.getMatScaleY(),T=i*(R>m?R:m),v=2*Math.PI*T;A=0|Math.max(v/10,10),h=o/A/2,u=Math.abs(4/3*(1-Math.cos(h))/Math.sin(h)),a&&(u=-u),D=0;var P=this._getPath();for(E=0;A>=E;E++)if(s=_+o*(E/A),l=Math.cos(s),c=Math.sin(s),f=t+l*i,d=e+c*i,f!=this._path._lastOriX||d!=this._path._lastOriY){var p=f,C=d;f=this._curMat.a*p+this._curMat.c*C+this._curMat.tx,d=this._curMat.b*p+this._curMat.d*C+this._curMat.ty,P.addPoint(f,d)}if(l=Math.cos(r),c=Math.sin(r),f=t+l*i,d=e+c*i,f!=this._path._lastOriX||d!=this._path._lastOriY){var M=f,O=d;f=this._curMat.a*M+this._curMat.c*O+this._curMat.tx,d=this._curMat.b*M+this._curMat.d*O+this._curMat.ty,P.addPoint(f,d)}},o.quadraticCurveTo=function(t,e,i,_){for(var r=n.I,a=r.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,i,_],30,2),s=0,o=a.length/2;o>s;s++)this.lineTo(a[2*s],a[2*s+1]);this.lineTo(i,_)},o.rect=function(t,e,i,_){this._other=this._other.make(),this._other.path||(this._other.path=new re),this._other.path.rect(t,e,i,_)},o.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},o._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},o.strokeRect=function(t,e,i,_,r){if(this.lineWidth>0){var a=this.mixRGBandAlpha(this.strokeStyle._color.numColor),n=this.lineWidth/2;this._fillRect(t-n,e-n,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-n,e-n+_,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-n,e+n,this.lineWidth,_-this.lineWidth,a),this._fillRect(t-n+i,e+n,this.lineWidth,_-this.lineWidth,a)}},o.clip=function(){},o.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},o._getPath=function(){return this._path||(this._path=new re)},a(0,o,"globalCompositeOperation",function(){return ie.NAMES[this._nBlendType]},function(t){var e=ie.TOINT[t];null==e||this._nBlendType===e||(z.save(this,65536,this,!0),this._curSubmit=ve.RENDERBASE,this._nBlendType=e)}),a(0,o,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(z.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=_e.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())}),a(0,o,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){t=Math.floor(1e3*t)/1e3,t!=this._shader2D.ALPHA&&(z.save(this,1,this._shader2D,!1),this._shader2D.ALPHA=t)}),a(0,o,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new $e(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets&&this._targets.destroy(),this._targets=null}),a(0,o,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(z.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=_e.create(t),this._submitKey.other=-this._shader2D.fillStyle.toInt())}),a(0,o,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),z.save(this,32768,this._other,!1),this._other.textAlign=t)}),a(0,o,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),z.save(this,256,this._other,!1),this._other.lineWidth=t)}),a(0,o,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),z.save(this,16384,this._other,!1),this._other.textBaseline=t)}),a(0,o,"font",null,function(){this._other=this._other.make(),z.save(this,8,this._other,!1)}),a(0,o,"canvas",function(){return this._canvas}),e.__init__=function(){s.DEFAULT=new s},e._tempPoint=new p,e._SUBMITVBSIZE=32e3,e._MAXSIZE=99999999,e._MAXVERTNUM=65535,e.MAXCLIPRECT=new M(0,0,99999999,99999999),e._COUNT=0,e._tmpMatrix=new v,e.SEGNUM=32,e._contextcount=0,e._clipID_Gen=0,e.defTexture=null,_(e,["_drawStyleTemp",function(){return this._drawStyleTemp=new _e(null)},"_keyMap",function(){return this._keyMap=new V},"_drawTexToDrawTri_Vert",function(){return this._drawTexToDrawTri_Vert=new Float32Array(8)},"_drawTexToDrawTri_Index",function(){return this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3])},"_charBook",function(){return this._charBook=new he}]),e.__init$=function(){s=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null}r(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},e}(c),Be=function(t){function e(t,i){e.__super.call(this,t,i)}r(e,"laya.webgl.utils.RenderSprite3D",t);var i=e.prototype;return i.onCreate=function(t){switch(t){case 4:return this._fun=this._blend,void 0}},i._mask=function(t,e,i,_){var r=this._next,a=t.mask,n=e;if(a){n.save();var s=n.globalCompositeOperation,o=new M;if(o.copyFrom(a.getBounds()),o.width=Math.round(o.width),o.height=Math.round(o.height),o.x=Math.round(o.x),o.y=Math.round(o.y),o.width>0&&o.height>0){var h=o.width,u=o.height,l=de.getRT(h,u);n.breakNextMerge(),n.pushRT(),n.addRenderObject(Pe.create([n,l,h,u],laya.webgl.utils.RenderSprite3D.tmpTarget,this)),a.render(n,-o.x,-o.y),n.breakNextMerge(),n.popRT(),n.save(),n.clipRect(i+o.x-t.getStyle().pivotX,_+o.y-t.getStyle().pivotY,h,u),r._fun.call(r,t,n,i,_),n.restore(),s=n.globalCompositeOperation,n.addRenderObject(Pe.create(["mask"],laya.webgl.utils.RenderSprite3D.setBlendMode,this));var c=Y.create(1,0),f=W.INV_UV;n.drawTarget(l,i+o.x-t.getStyle().pivotX,_+o.y-t.getStyle().pivotY,h,u,v.TEMP.identity(),c,f,6),n.addRenderObject(Pe.create([l],laya.webgl.utils.RenderSprite3D.recycleTarget,this)),n.addRenderObject(Pe.create([s],laya.webgl.utils.RenderSprite3D.setBlendMode,this))}n.restore()}else r._fun.call(r,t,e,i,_)},i._blend=function(t,e,i,_){var r=t._style,a=this._next;r.blendMode?(e.save(),e.globalCompositeOperation=r.blendMode,a._fun.call(a,t,e,i,_),e.restore()):a._fun.call(a,t,e,i,_)},e.tmpTarget=function(t,e){e.start(),e.clear(0,0,0,0)},e.recycleTarget=function(t){de.releaseRT(t)},e.setBlendMode=function(t){var e=Se.mainContext;ie.targetFns[ie.TOINT[t]](e)},_(e,["tempUV",function(){return this.tempUV=new Array(8)}]),e}(L),Ie=function(t){function e(){this.texcoord=null,this.position=null,this.offsetX=300,this.offsetY=0,e.__super.call(this,512,0);var t=8*Me.BYTES_PE;this.position=[2,5126,!1,t,0],this.texcoord=[2,5126,!1,t,2*Me.BYTES_PE],this.color=[4,5126,!1,t,4*Me.BYTES_PE]}return r(e,"laya.webgl.shader.d2.skinAnishader.SkinSV",t),e}(Y),xe=function(t){function e(){e.__super.call(this,4,0),this._attribLocation=["position",0,"attribColor",1]}return r(e,"laya.webgl.shader.d2.value.PrimitiveSV",t),e}(Y),Ne=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,void 0===t&&(t=0),e.__super.call(this,1,t),this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}r(e,"laya.webgl.shader.d2.value.TextureSV",t);var i=e.prototype;return i.clear=function(){this.texture=null,this.shader=null,this.defines._value=this.subID+(Se.shaderHighPrecision?1024:0)},e}(Y),Fe=function(i){function _(){this.lastScaleX=1,this.lastScaleY=1,this.needResetScale=!1,_.__super.call(this),_.canvas||(_.canvas=t.document.createElement("canvas"),_.canvas.width=512,_.canvas.height=512,_.canvas.style.left="-1000px",_.canvas.style.position="absolute",e.body.appendChild(_.canvas),_.ctx=_.canvas.getContext("2d"))}r(_,"laya.webgl.resource.CharRender_Canvas",i);var a=_.prototype;return a.getWidth=function(t){return _.ctx?(_.ctx._lastFont!=he._curFont&&(_.ctx.font=he._curFont,_.ctx._lastFont=he._curFont),_.ctx.measureText(t).width):0},a.scale=function(t,e){(this.lastScaleX!=t||this.lastScaleY!=e)&&(this.needResetScale&&(_.ctx.restore(),this.lastScaleX=this.lastScaleY=1),_.ctx.save(),this.needResetScale=!0,_.ctx.scale(t,e),this.lastScaleX=t,this.lastScaleY=e)},a.getCharBmp=function(t,e,i,r,a,n,s,o,h,u){if(he.isWan1Wan)return this.getCharCanvas(t,e,i,r,a,n,s,o,h,u);_.ctx.font!=e&&(_.ctx.font=e,_.ctx._lastFont=e),n.width=_.ctx.measureText(t).width;var l=n.width*this.lastScaleX,c=n.height*this.lastScaleY;return l+=(s+h)*this.lastScaleX,c+=(o+u)*this.lastScaleY,_.ctx.clearRect(0,0,l+1,c+1),_.ctx.textBaseline="top",i>0&&(_.ctx.strokeStyle=a,_.ctx.lineWidth=i,_.ctx.strokeText(t,s,o)),_.ctx.fillStyle=r,_.ctx.fillText(t,s,o),he.debug&&(_.ctx.strokeStyle="#ff0000",_.ctx.strokeRect(0,0,l,c),_.ctx.strokeStyle="#00ff00",_.ctx.strokeRect(s,o,n.width,n.height)),_.ctx.getImageData(0,0,0|l,0|c)},a.getCharCanvas=function(t,e,i,r,a,n,s,o,h,u){_.ctx.font!=e&&(_.ctx.font=e,_.ctx._lastFont=e),n.width=_.ctx.measureText(t).width;var l=n.width*this.lastScaleX,c=n.height*this.lastScaleY;return l+=(s+h)*this.lastScaleX,c+=(o+u)*this.lastScaleY,_.canvas.width=l+1,_.canvas.height=c+1,_.ctx.font=e,_.ctx.clearRect(0,0,l+1,c+1),_.ctx.save(),_.ctx.translate(s,o),he.scaleFontWithCtx&&_.ctx.scale(this.lastScaleX,this.lastScaleY),_.ctx.textAlign="left",_.ctx.textBaseline="top",i>0?(_.ctx.strokeStyle=a,_.ctx.fillStyle=r,_.ctx.lineWidth=i,_.ctx.fillAndStrokeText(t,0,0,null,null,null)):(_.ctx.fillStyle=r,_.ctx.fillText(t,0,0)),he.debug&&(_.ctx.strokeStyle="#ff0000",_.ctx.strokeRect(0,0,l,c),_.ctx.strokeStyle="#00ff00",_.ctx.strokeRect(0,0,n.width,n.height)),_.ctx.restore(),_.canvas},_.canvas=null,_.ctx=null,_}(fe),Ve=function(e){function i(){this.lastFont="",i.__super.call(this)}r(i,"laya.webgl.resource.CharRender_Native",e);var _=i.prototype;return _.getWidth=function(e){return t.conchTextCanvas?(this.lastFont!=he._curFont&&(t.conchTextCanvas.font=he._curFont,this.lastFont=he._curFont),t.conchTextCanvas.measureText(e).width):0},_.scale=function(){},_.getCharBmp=function(e,i,_,r,a,n,s,o,h,l){if(!t.conchTextCanvas)return null;this.lastFont!=i&&(t.conchTextCanvas.font=he._curFont,this.lastFont=he._curFont);var c=n.width=t.conchTextCanvas.measureText(e).width,f=n.height;c+=s+h,f+=o+l;var d=u.create(a),E=d.numColor,A=u.create(r),D=A.numColor,R=t.conchTextCanvas.getTextBitmapData(e,D,_>2?2:_,E);return R},i}(fe),we=function(t){function e(){e.__super.call(this,e.__name2int,e.__int2name,e.__int2nameMap)}return r(e,"laya.webgl.shader.d2.ShaderDefines2D",t),e.__init__=function(){e.reg("TEXTURE2D",1),e.reg("PRIMITIVE",4),e.reg("GLOW_FILTER",8),e.reg("BLUR_FILTER",16),e.reg("COLOR_FILTER",32),e.reg("COLOR_ADD",64),e.reg("WORLDMAT",128),e.reg("FILLTEXTURE",256),e.reg("FSHIGHPRECISION",1024)},e.reg=function(t,i){Ae._reg(t,i,e.__name2int,e.__int2name)},e.toText=function(t,e,i){return Ae._toText(t,e,i)},e.toInt=function(t){return Ae._toInt(t,e.__name2int)},e.TEXTURE2D=1,e.PRIMITIVE=4,e.FILTERGLOW=8,e.FILTERBLUR=16,e.FILTERCOLOR=32,e.COLORADD=64,e.WORLDMAT=128,e.FILLTEXTURE=256,e.SKINMESH=512,e.SHADERDEFINE_FSHIGHPRECISION=1024,e.NOOPTMASK=312,e.__name2int={},e.__int2name=[],e.__int2nameMap=[],e}(Ae),Ue=function(t){function e(){this._matrix=new v,this._matrix4=Me.defaultMatrix4.concat(),e.__super.call(this,1e4),this.shaderValue=new Y(0,0)}r(e,"laya.webgl.submit.SubmitCanvas",t);var i=e.prototype;return i.renderSubmit=function(){if(this._ctx_src._targets)return alert("nimei"),1;var t=Le.worldAlpha,e=Le.worldMatrix4,i=Le.worldMatrix,_=Le.worldFilters,r=Le.worldShaderDefines,a=this.shaderValue,n=this._matrix,s=this._matrix4,o=v.TEMP;return v.mul(n,i,o),s[0]=o.a,s[1]=o.b,s[4]=o.c,s[5]=o.d,s[12]=o.tx,s[13]=o.ty,Le.worldMatrix=o.clone(),Le.worldMatrix4=s,Le.worldAlpha=Le.worldAlpha*a.alpha,a.filters&&a.filters.length&&(Le.worldFilters=a.filters,Le.worldShaderDefines=a.defines),this._ctx_src.flush(),Le.worldAlpha=t,Le.worldMatrix4=e,Le.worldMatrix.destroy(),Le.worldMatrix=i,Le.worldFilters=_,Le.worldShaderDefines=r,1},i.releaseRender=function(){if(--this._ref<1){var t=e.POOL;this._ctx_src=null,this._mesh=null,t[t._length++]=this}},i.clone=function(){return null},i.getRenderType=function(){return 10003},e.create=function(t,i,_){var r=e.POOL._length?e.POOL[--e.POOL._length]:new e;r._ctx_src=t,r._ref=1,r._numEle=0;var a=r.shaderValue;return a.alpha=i,a.defines.setValue(0),_&&_.length&&a.setFilters(_),r},e.POOL=(e.POOL=[],e.POOL._length=0,e.POOL),e}(ve),We=function(t){function e(t){void 0===t&&(t=1e4),e.__super.call(this,t)}r(e,"laya.webgl.submit.SubmitTexture",t);var i=e.prototype;return i.clone=function(t,i,_){var r=e._poolSize?e.POOL[--e._poolSize]:new e;return this._cloneInit(r,t,i,_),r},i.releaseRender=function(){--this._ref<1&&(e.POOL[e._poolSize++]=this,this.shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},i.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var i=Se.mainContext;this._mesh.useMesh(i);var _=ve.preRender,r=ve.preRender._key;return 0===this._key.blendShader&&this._key.submitType===r.submitType&&this._key.blendShader===r.blendShader&&Ye.activeShader&&ve.preRender.clipInfoID==this.clipInfoID&&_.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&we.NOOPTMASK)?Ye.activeShader.uploadTexture2D(e):(ie.activeBlendFunction!==this._blendFn&&(ge.setBlend(i,!0),this._blendFn(i),ie.activeBlendFunction=this._blendFn),this.shaderValue.texture=e,this.shaderValue.upload()),i.drawElements(4,this._numEle,5123,this._startIdx),F.drawCall++,F.trianglesFaces+=this._numEle/3,1},e.create=function(t,i,_){var r=e._poolSize?e.POOL[--e._poolSize]:new e(10016);r._mesh=i,r._key.clear(),r._key.submitType=2,r._ref=1,r._startIdx=i.indexNum*Me.BYTES_PIDX,r._numEle=0;var a=t._nBlendType;if(r._key.blendShader=a,r._blendFn=t._targets?ie.targetFns[a]:ie.fns[a],r.shaderValue=_,t._colorFiler){var n=t._colorFiler;_.defines.add(n.type),_.colorMat=n._mat,_.colorAlpha=n._alpha}return r},e._poolSize=0,e.POOL=[],e}(ve),Ge=(function(t){function e(t){e.__super.call(this,laya.webgl.utils.MeshParticle2D.const_stride,4*t*e.const_stride,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshParticle2D._fixattriInfo),this.createQuadIB(t),this._quadNum=t}r(e,"laya.webgl.utils.MeshParticle2D",t);var i=e.prototype;return i.setMaxParticleNum=function(t){this._vb._resizeBuffer(4*t*e.const_stride,!1),this.createQuadIB(t)},i.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshParticle2D._POOL.push(this)},i.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._vb.deleteBuffer()},e.getAMesh=function(t){if(laya.webgl.utils.MeshParticle2D._POOL.length){var i=laya.webgl.utils.MeshParticle2D._POOL.pop();return i.setMaxParticleNum(t),i}return new e(t)},e.const_stride=116,e._POOL=[],_(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5126,3,16,5126,3,28,5126,4,40,5126,4,56,5126,3,72,5126,2,84,5126,4,92,5126,1,108,5126,1,112]}]),e}(Oe),function(t){function e(){e.__super.call(this,laya.webgl.utils.MeshQuadTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshQuadTexture._fixattriInfo),laya.webgl.utils.MeshQuadTexture._fixib?(this._ib=laya.webgl.utils.MeshQuadTexture._fixib,this._quadNum=e._maxIB):(this.createQuadIB(e._maxIB),laya.webgl.utils.MeshQuadTexture._fixib=this._ib)}r(e,"laya.webgl.utils.MeshQuadTexture",t);var i=e.prototype;return i.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshQuadTexture._POOL.push(this)},i.destroy=function(){this._vb.destroy(),this._vb.deleteBuffer()},i.addQuad=function(t,e,i,_){var r=this._vb,a=r._byteLength>>2;r.setByteLength(a+laya.webgl.utils.MeshQuadTexture.const_stride<<2);var n=r._floatArray32||r.getFloat32Array(),s=r._uint32Array,o=a,h=_?255:0;n[o++]=t[0],n[o++]=t[1],n[o++]=e[0],n[o++]=e[1],s[o++]=i,s[o++]=h,n[o++]=t[2],n[o++]=t[3],n[o++]=e[2],n[o++]=e[3],s[o++]=i,s[o++]=h,n[o++]=t[4],n[o++]=t[5],n[o++]=e[4],n[o++]=e[5],s[o++]=i,s[o++]=h,n[o++]=t[6],n[o++]=t[7],n[o++]=e[6],n[o++]=e[7],s[o++]=i,s[o++]=h,r._upload=!0},e.getAMesh=function(){return laya.webgl.utils.MeshQuadTexture._POOL.length?laya.webgl.utils.MeshQuadTexture._POOL.pop():new e},e.const_stride=24,e._fixib=null,e._maxIB=16384,e._POOL=[],_(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]),e}(Oe)),Xe=function(t){function e(){e.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}r(e,"laya.webgl.utils.MeshTexture",t);var i=e.prototype;return i.addData=function(t,i,_,r,a){for(var n=t.length/2,s=this._vb.needSize(n*e.const_stride),o=s>>2,h=this._vb._floatArray32||this._vb.getFloat32Array(),u=this._vb._uint32Array,l=0,c=0;n>c;c++){var f=t[l],d=t[l+1],E=f*r.a+d*r.c+r.tx,A=f*r.b+d*r.d+r.ty;h[o++]=E,h[o++]=A,h[o++]=i[l],h[o++]=i[l+1],l+=2,u[o++]=a,u[o++]=255}this._vb.setNeedUpload();var D=this.vertNum;if(D>0){var R=_.length;R>e.tmpIdx.length&&(e.tmpIdx=new Uint16Array(R));for(var m=0;R>m;m++)e.tmpIdx[m]=_[m]+D;
this._ib.appendU16Array(e.tmpIdx,_.length)}else this._ib.append(_);this._ib.setNeedUpload(),this.vertNum+=n,this.indexNum+=_.length},i.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},i.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},e.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new e},e.const_stride=24,e._POOL=[],_(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),e}(Oe),ke=function(t){function e(){e.__super.call(this,laya.webgl.utils.MeshVG.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshVG._fixattriInfo)}r(e,"laya.webgl.utils.MeshVG",t);var i=e.prototype;return i.addVertAndIBToMesh=function(t,i,_,r){for(var a=this._vb.needSize(i.length/2*e.const_stride),n=a>>2,s=this._vb._floatArray32||this._vb.getFloat32Array(),o=this._vb._uint32Array,h=0,u=i.length/2,l=0;u>l;l++)s[n++]=i[h],s[n++]=i[h+1],h+=2,o[n++]=_;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(r)),this._ib.setNeedUpload(),this.vertNum+=u,this.indexNum+=r.length},i.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshVG._POOL.push(this)},i.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},e.getAMesh=function(){return laya.webgl.utils.MeshVG._POOL.length?laya.webgl.utils.MeshVG._POOL.pop():new e},e.const_stride=12,e._POOL=[],_(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5121,4,8]}]),e}(Oe),ze=function(t){function e(){this._customRenderCmd=null,this._customCmds=null,this._x=0,this._y=0,this._renderType=0,this._bRepaintCanvas=!1,this._lastContext=null,e.__super.call(this)}r(e,"laya.layagl.ConchSpriteAdpt",t);var a=e.prototype;return a.createData=function(){var t=308;this._conchData=new ParamData(t,!1),this._datai32=this._conchData._int32Data,this._dataf32=this._conchData._float32Data,this._dataf32[4]=1,this._datai32[3]=-1,this._datai32[1]=0,this._datai32[2]=0,this._datai32[22]=4294967295,this._datai32[5]=1,this._dataf32[8]=0,this._dataf32[9]=0,this._dataf32[10]=1,this._dataf32[11]=1,this._dataf32[16]=1,this._dataf32[17]=0,this._dataf32[18]=0,this._dataf32[19]=1,this._dataf32[20]=0,this._dataf32[21]=0,this._datai32[24]=-1,this._datai32[25]=-1,this._datai32[27]=-1,this._datai32[28]=0,this._datai32[29]=0,this._datai32[30]=1e6,this._datai32[31]=1e6,this._datai32[63]=0,this._datai32[71]=1,this._datai32[72]=771,this._datai32[68]=-1},a._createTransform=function(){return ee.create(new Float32Array(6))},a._setTransform=function(t){var e=this._conchData._float32Data;e[15]=0,e[16]=t.a,e[17]=t.b,e[18]=t.c,e[19]=t.d,e[20]=t.tx,e[21]=t.ty},a._setGraphics=function(t){this._datai32[23]=t._commandEncoder.getPtrID()},a._setGraphicsCallBack=function(){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(5,this.updateParticleFromNative.bind(this)),this._datai32[68]=5},a._setCacheAs=function(){H.createCommandEncoder(),this._drawCanvasParamData||(this._drawCanvasParamData=new ParamData(132,!0)),this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._canvasBeginCmd||(this._canvasBeginCmd=K.instance.createCommandEncoder(128,64,!1)),this._canvasEndCmd||(this._canvasEndCmd=K.instance.createCommandEncoder(128,64,!1)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(1,this.canvasBeginRenderFromNative.bind(this)),this._callbackFuncObj.addCallbackFunc(2,this.canvasEndRenderFromNative.bind(this)),this._datai32[56]=1,this._datai32[57]=2,this._datai32[58]=this._canvasBeginCmd.getPtrID(),this._datai32[59]=this._canvasEndCmd.getPtrID(),this._datai32[60]=H._DRAW_CANVAS_CMD_ENCODER_.getPtrID(),this._datai32[61]=this._drawCanvasParamData.getPtrID()},a._setX=function(t){this._x=this._dataf32[6]=t,this._renderType|=2,this._setRenderType(this._renderType),this._dataf32[15]=1},a._setY=function(t){this._y=this._dataf32[7]=t,this._renderType|=2,this._setRenderType(this._renderType),this._dataf32[15]=1},a._setPivotX=function(t){this._renderType|=2,this._dataf32[8]=t,this._dataf32[15]=1},a._getPivotX=function(){return this._dataf32[8]},a._setPivotY=function(t){this._renderType|=2,this._dataf32[9]=t,this._dataf32[15]=1},a._getPivotY=function(){return this._dataf32[9]},a._setAlpha=function(t){var e=this.getStyle();e.alpha=t,t=t>1?1:t,t=0>t?0:t;var i=this._datai32[22],_=i>>24;_=255*t,i=16777215&i|_<<24,this._datai32[22]=i,1!==t?this._renderType|=1:this._renderType&=-2,this._setRenderType(this._renderType),this.parentRepaint()},a._setRenderType=function(t){this._datai32[0]=t,J.GLS[t]||J.createByRenderType(t),J.GLSE[t]||J.createByRenderTypeEnd(t)},a.parentRepaint=function(){},a._getAlpha=function(){return(this._datai32[22]>>>24)/255},a._setScaleX=function(t){this._style.scaleX=this._dataf32[10]=t,this._dataf32[15]=1},a._setScaleY=function(t){this._style.scaleY=this._dataf32[11]=t,this._dataf32[15]=1},a._setSkewX=function(t){this._style.skewX=this._dataf32[12]=t,this._dataf32[15]=1},a._setSkewY=function(t){this._style.skewY=this._dataf32[13]=t,this._dataf32[15]=1},a._setRotation=function(t){this._style.rotation=this._dataf32[14]=t,this._dataf32[15]=1},a._setBgStyleColor=function(t,e,i,_,r){var a=null,n=null;this._drawSimpleRectParamData||(this._drawSimpleRectParamData=new ParamData(104,!0)),a=this._drawSimpleRectParamData._float32Data,n=this._drawSimpleRectParamData._int32Data;var s=u.create(r),o=s.numColor;n[0]=1,n[1]=96;var h=2;a[h++]=t,a[h++]=e,a[h++]=0,a[h++]=0,n[h++]=o,a[h++]=4294967295,a[h++]=t+i,a[h++]=e,a[h++]=0,a[h++]=0,n[h++]=o,a[h++]=4294967295,a[h++]=t+i,a[h++]=e+_,a[h++]=0,a[h++]=0,n[h++]=o,a[h++]=4294967295,a[h++]=t,a[h++]=e+_,a[h++]=0,a[h++]=0,n[h++]=o,a[h++]=4294967295,this._datai32[74]=this._drawSimpleRectParamData.getPtrID(),K.syncBufferToRenderThread(this._drawSimpleRectParamData),this._datai32[73]=te._SIMPLE_RECT_CMDENCODER_.getPtrID()},a._setBorderStyleColor=function(t,e,i,_,r,a){var n=null,s=null;this._drawRectBorderParamData||(this._drawRectBorderParamData=new ParamData(236,!0)),n=this._drawRectBorderParamData._float32Data,s=this._drawRectBorderParamData._int32Data;var o=[],h=[],l=[];o.push(t),o.push(e),o.push(t+i),o.push(e),o.push(t+i),o.push(e+_),o.push(t),o.push(e+_),o.push(t),o.push(e-a/2),Re.createLine2(o,h,a,0,l,!1);var c=o.length;n=this._drawRectBorderParamData._float32Data,s=this._drawRectBorderParamData._int32Data;var f=this._drawRectBorderParamData._int16Data,d=u.create(r),E=d.numColor;s[0]=0,s[1]=120,s[2]=0,s[3]=2*h.length,s[4]=0;for(var A=5,D=0;c>D;D++)n[A++]=l[2*D],n[A++]=l[2*D+1],s[A++]=E;A=70;for(var R=0;R<h.length;R++)f[A++]=h[R];this._datai32[76]=this._drawRectBorderParamData.getPtrID(),K.syncBufferToRenderThread(this._drawRectBorderParamData),this._datai32[75]=te._RECT_BORDER_CMD_ENCODER_.getPtrID()},a._setTextureEx=function(t,e){var i=null,_=null;if(!this._drawSimpleImageData){this._drawSimpleImageData=new ParamData(116,!0),i=this._drawSimpleImageData._float32Data,_=this._drawSimpleImageData._int32Data,_[0]=3,_[1]=33984,_[2]=e?t.bitmap._glTexture.id:0,_[3]=1,_[4]=96;var r=t.uv;i[5]=0,i[6]=0,i[7]=r[0],i[8]=r[1],_[9]=4294967295,_[10]=4294967295,i[11]=0,i[12]=0,i[13]=r[2],i[14]=r[3],_[15]=4294967295,_[16]=4294967295,i[17]=0,i[18]=0,i[19]=r[4],i[20]=r[5],_[21]=4294967295,_[22]=4294967295,i[23]=0,i[24]=0,i[25]=r[6],i[26]=r[7],_[27]=4294967295,_[28]=4294967295}i=this._drawSimpleImageData._float32Data,_=this._drawSimpleImageData._int32Data,_[2]=e?t.bitmap._glTexture.id:0;var a=e?t.width:0,n=e?t.height:0;i[11]=i[17]=a,i[18]=i[24]=n;var s=this._drawSimpleImageData.getPtrID();this._datai32[25]=s,K.syncBufferToRenderThread(this._drawSimpleImageData),this._datai32[24]=te._SIMPLE_TEXTURE_CMDENCODER_.getPtrID()},a._setTexture=function(t){t&&(t.getIsReady()?this._setTextureEx(t,!0):(this._setTextureEx(t,!1),t.on("ready",this,this._setTextureEx,[t,!0])))},a._setCustomRender=function(){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._customCmds=[],this._callbackFuncObj.addCallbackFunc(0,this.customRenderFromNative.bind(this)),this._customRenderCmd=K.instance.createCommandEncoder(128,64,!0),this._datai32[54]=this._callbackFuncObj.id,this._datai32[55]=0,this._datai32[27]=this._customRenderCmd.getPtrID()},a._setScrollRect=function(t){this._dataf32[28]=0,this._dataf32[29]=0,this._dataf32[30]=t.width,this._dataf32[31]=t.height,this._dataf32[32]=-t.x,this._dataf32[33]=-t.y},a._setColorFilter=function(){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._filterBeginCmd||(this._filterBeginCmd=K.instance.createCommandEncoder(128,64,!1)),this._filterEndCmd||(this._filterEndCmd=K.instance.createCommandEncoder(128,64,!0)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(3,this.filterBeginRenderFromNative.bind(this)),this._callbackFuncObj.addCallbackFunc(4,this.filterEndRenderFromNative.bind(this)),this._datai32[65]=3,this._datai32[64]=this._filterBeginCmd.getPtrID(),this._datai32[67]=4,this._datai32[66]=this._filterEndCmd.getPtrID()},a._setMask=function(t){t.cacheAs="bitmap",this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._maskCmd||(this._maskCmd=K.instance.createCommandEncoder(128,64,!1)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(6,this.maskRenderFromNative.bind(this)),this._datai32[69]=6,this._datai32[70]=this._maskCmd.getPtrID()},a._adjustTransform=function(){var t=this._transform||(this._transform=this._createTransform());t._bTransform=!0,K.instance.calcMatrixFromScaleSkewRotation(this._conchData._data._ptrID,60,64,24,28,32,36,40,44,48,52,56);var e=this._conchData._float32Data;return t.a=e[16],t.b=e[17],t.c=e[18],t.d=e[19],t.tx=0,t.ty=0,t},a._setBlendMode=function(t){switch(t){case"normal":this._datai32[71]=1,this._datai32[72]=771;break;case"add":case"lighter":this._datai32[71]=1,this._datai32[72]=772;break;case"multiply":this._datai32[71]=774,this._datai32[72]=771;break;case"screen":this._datai32[71]=1,this._datai32[72]=1;break;case"overlay":this._datai32[71]=1,this._datai32[72]=769;break;case"light":this._datai32[71]=1,this._datai32[72]=1;break;case"mask":this._datai32[71]=0,this._datai32[72]=770;break;case"destination-out":this._datai32[71]=0,this._datai32[72]=0;break;default:alert("_setBlendMode Unknown type")}},a.customRenderFromNative=function(){var t=K.instance.getCurrentContext();this._customRenderCmd.beginEncoding(),this._customRenderCmd.clearEncoding(),t._commandEncoder=this._customRenderCmd,t._customCmds=this._customCmds;for(var e=0,i=this._customCmds.length;i>e;e++)this._customCmds[e].recover();this._customCmds.length=0,this.customRender(t,0,0),this._customRenderCmd.endEncoding()},a.canvasBeginRenderFromNative=function(){var t=K.instance,i=null,_=null,r=this._cacheStyle;if(r.canvas&&0==this._datai32[4])i=r.canvas,0!=this._bRepaintCanvas&&(this.setChildrenNativeVisible(!1),this._bRepaintCanvas=!1),this._datai32[63]=1;else{if(this._canvasBeginCmd.beginEncoding(),this._canvasBeginCmd.clearEncoding(),i=laya.layagl.ConchSpriteAdpt.buildCanvas(this,0,0)){this._datai32[63]=0,this._lastContext=t.getCurrentContext(),_=i.context;var a=_._targets;H.setParamData(this._drawCanvasParamData,a,-16,-16,a.width,a.height),t.setCurrentContext(_),_.beginRT(),t.save(),e._tempFloatArrayMatrix[0]=1,e._tempFloatArrayMatrix[1]=0,e._tempFloatArrayMatrix[2]=0,e._tempFloatArrayMatrix[3]=1,e._tempFloatArrayMatrix[4]=16,e._tempFloatArrayMatrix[5]=16,t.setGlobalValue(te.GLOBALVALUE_MATRIX32,8,e._tempFloatArrayMatrix),1!=this._bRepaintCanvas&&(this.setChildrenNativeVisible(!0),this._bRepaintCanvas=!0)}this._canvasBeginCmd.endEncoding()}},a.setChildrenNativeVisible=function(t){for(var e,i=this._children,_=i.length,r=0;_>r;++r)e=i[r],e._datai32[5]=t?1:0,e.setChildrenNativeVisible(t)},a.canvasEndRenderFromNative=function(){var t=K.instance;if(this._canvasEndCmd.beginEncoding(),this._canvasEndCmd.clearEncoding(),this._bRepaintCanvas){var e=K.instance.getCurrentContext();t.restore(),t.setCurrentContext(this._lastContext),t.commitContextToGPU(e),e.endRT(),t.blendFunc(1,771)}this._canvasEndCmd.endEncoding()},a.filterBeginRenderFromNative=function(){var t=this,i=K.instance;this._filterBeginCmd.beginEncoding(),this._filterBeginCmd.clearEncoding();{var _=this._getCacheStyle().filters;_.length}if(_[0]instanceof laya.filters.ColorFilter){i.addShaderMacro(te.SHADER_MACRO_COLOR_FILTER);var r=_[0];i.setGlobalValue(te.GLOBALVALUE_COLORFILTER_COLOR,8,r._mat),i.setGlobalValue(te.GLOBALVALUE_COLORFILTER_ALPHA,8,r._alpha)}else{var a=p.TEMP,n=v.create(),s=0,o=0,h=t._isHaveGlowFilter();h&&(s=50,o=25);var u=new M;u.copyFrom(t.getSelfBounds()),u.x+=t.x,u.y+=t.y,u.x-=t.pivotX+4,u.y-=t.pivotY+4;var l=u.x,c=u.y;if(u.width+=s+8,u.height+=s+8,a.x=u.x*n.a+u.y*n.c,a.y=u.y*n.d+u.x*n.b,u.x=a.x,u.y=a.y,a.x=u.width*n.a+u.height*n.c,a.y=u.height*n.d+u.width*n.b,u.width=a.x,u.height=a.y,u.width<=0||u.height<=0)return;var f=t._getCacheStyle().filterCache;f&&de.releaseRT(f),f=de.getRT(u.width,u.height),t._getCacheStyle().filterCache=f,e.useRenderTarget(f),e._tempFloatArrayMatrix[0]=1,e._tempFloatArrayMatrix[1]=0,e._tempFloatArrayMatrix[2]=0,e._tempFloatArrayMatrix[3]=1,e._tempFloatArrayMatrix[4]=t.x-l+o,e._tempFloatArrayMatrix[5]=t.y-c+o,i.setGlobalValue(te.GLOBALVALUE_MATRIX32,8,e._tempFloatArrayMatrix)}this._filterBeginCmd.endEncoding()},a.filterEndRenderFromNative=function(){this._filterEndCmd.beginEncoding(),this._filterEndCmd.clearEncoding();var t=K.instance,_=this._getCacheStyle().filters;if(_[0]instanceof laya.filters.ColorFilter);else{t.restore();var r=K.instance.getCurrentContext(),a=$e.currentActive;if($e.popRT(),_[0]instanceof i.BlurFilter){t.addShaderMacro(te.SHADER_MACRO_BLUR_FILTER);var n=_[0];e._tempFloatArrayBuffer2[0]=a.width,e._tempFloatArrayBuffer2[1]=a.height,t.setGlobalValue(te.GLOBALVALUE_BLURFILTER_BLURINFO,8,e._tempFloatArrayBuffer2),t.setGlobalValue(te.GLOBALVALUE_BLURFILTER_STRENGTH,8,n.getStrenth_sig2_2sig2_native()),r.drawTarget(this._filterEndCmd,a,-4,-4,0,0)}else if(_[0]instanceof i.GlowFilter){var s=a.width,o=a.height,h=de.getRT(s,o);e.useRenderTarget(h),t.addShaderMacro(te.SHADER_MACRO_GLOW_FILTER);var u=_[0],l=u.getBlurInfo2Native();l[0]=s,l[1]=o,t.setGlobalValue(te.GLOBALVALUE_GLOWFILTER_COLOR,8,u.getColorNative()),t.setGlobalValue(te.GLOBALVALUE_GLOWFILTER_BLURINFO1,8,u.getBlurInfo1Native()),t.setGlobalValue(te.GLOBALVALUE_GLOWFILTER_BLURINFO2,8,l),r.drawTarget(this._filterEndCmd,a,-16,-16,0,0),t.restore(),$e.popRT(),r.drawTarget(this._filterEndCmd,h,-29,-29,0,0),r.drawTarget(this._filterEndCmd,a,-29,-29,0,0)}}this._filterEndCmd.endEncoding(),K.syncBufferToRenderThread(this._filterEndCmd)},a.maskRenderFromNative=function(){this._maskCmd.beginEncoding(),this._maskCmd.clearEncoding();var t=K.instance,i=t.getCurrentContext(),_=this.mask;_&&(_._children.length>0?(t.blockStart(_._conchData),_._renderChilds(i),t.blockEnd(_._conchData)):t.block(_._conchData)),e._tempInt1[0]=772,t.setGlobalValue(te.GLOBALVALUE_BLENDFUNC_SRC,8,e._tempInt1),e._tempInt1[0]=0,t.setGlobalValue(te.GLOBALVALUE_BLENDFUNC_DEST,8,e._tempInt1),this._maskCmd.endEncoding()},a.updateParticleFromNative=function(){this.tempCmd.updateParticle()},e.createMatrix=function(t,e,i,_,r,a,n){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===_&&(_=1),void 0===r&&(r=0),void 0===a&&(a=0),new ee(t,e,i,_,r,a,n)},e.init=function(){j.__init__(),Q.__init__();var t=x.prototype,i=e.prototype,_=["_createTransform","_setTransform","_setGraphics","_setGraphicsCallBack","_setCacheAs","_setX","_setY","_setPivotX","_getPivotX","_setPivotY","_getPivotY","_setAlpha","_getAlpha","_setScaleX","_setScaleY","_setSkewX","_setSkewY","_setRotation","_adjustTransform","_setRenderType","_setTexture","_setTextureEx","_setCustomRender","_setScrollRect","_setColorFilter","customRenderFromNative","canvasBeginRenderFromNative","canvasEndRenderFromNative","setChildrenNativeVisible","filterBeginRenderFromNative","filterEndRenderFromNative","updateParticleFromNative","_setMask","maskRenderFromNative","_setBlendMode","_setBgStyleColor","_setBorderStyleColor"],r=0,a=0;a=_.length;var n;for(r=0;a>r;r++)n=_[r],t[n]=i[n];t.createGLBuffer=i.createData,v._createFun=e.createMatrix;t.render=t.renderToNative=je.prototype.renderToNative,t.repaint=t.repaintForNative=je.prototype.repaintForNative,t.parentRepaint=t.parentRepaintForNative=je.prototype.parentRepaintForNative,t._renderChilds=je.prototype._renderChilds},e.useRenderTarget=function(t){var i=K.instance;$e.pushRT(),t.start(),i.clearColor(0,0,0,0),i.clear(17664),i.save(),e._tempFloatArrayBuffer2[0]=t.width,e._tempFloatArrayBuffer2[1]=t.height,i.setGlobalValue(te.GLOBALVALUE_VIEWS,8,e._tempFloatArrayBuffer2)},e.buildCanvas=function(t,e,i){var _,r,a,n,s,o,h,u,l,c=t._cacheStyle,f=c.canvas,d=c.cacheAs;return l=c._calculateCacheRect(t,d,e,i),h=l.x,u=l.y,n=c.cacheRect,s=n.width*h,o=n.height*u,r=n.x,a=n.y,"bitmap"===d&&(s>2048||o>2048)?(alert("cache bitmap size larger than 2048,cache ignored"),c.releaseContext(),null):(f||(c.createContext(),f=c.canvas),_=f.context,f.context.sprite=t,(f.width!=s||f.height!=o)&&(f.size(s,o),_._targets&&(_._targets.destroy(),_._targets=null)),"bitmap"===d?f.context.asBitmap=!0:"normal"===d&&(f.context.asBitmap=!1),"normal"===d&&(_.touches=[]),f)},_(e,["_tempFloatArrayBuffer2",function(){return this._tempFloatArrayBuffer2=new Float32Array(2)},"_tempFloatArrayMatrix",function(){return this._tempFloatArrayMatrix=new Float32Array(6)},"_tempInt1",function(){return this._tempInt1=new Int32Array(1)}]),e}(P),Ye=function(t){function e(){e.__super.call(this)}return r(e,"laya.webgl.shader.BaseShader",t),e.activeShader=null,e.bindShader=null,e}(y),He=function(t){function e(t,i,_){this.texture=null,this._source=null,this._used=null,this._startFindPos=0,this._texW=0,this._texH=0,this._gridNum=0,this.charMaps=[],this._score=0,this._scoreTick=0,this.__destroyed=!1,this._discardTm=0,e.__super.call(this),this._texW=t,this._texH=i,this._gridNum=_,this.texture=new ue(this),this.setGridNum(_),this.lock=!0}r(e,"laya.webgl.resource.CharPageTexture",t);var _=e.prototype;return _.findAGrid=function(){for(var t=this._startFindPos;t<this._gridNum;t++)if(0==this._used[t])return this._startFindPos=t+1,this._used[t]=1,t;return-1},_.removeGrid=function(t){this._used[t]=0,t<this._startFindPos&&(this._startFindPos=t)},_.removeOld=function(t){for(var e=0,i=null,_=0,r=this.charMaps.length;r>_;_++)if(i=this.charMaps[_]){var a=this;i.forEach(function(i,_,r){i&&i.touchTick<t&&(console.log("remove char "+_),a.removeGrid(i.pos),r.delete(_),e++)})}return e},_.reset=function(){this._discardTm=i.stage.getFrameTm(),this._startFindPos=0,this.charMaps=[],this._score=0,this._scoreTick=0,this.__destroyed=!0},_.setGridNum=function(t){if(this._used&&this._used.length==this._gridNum)if(this._used.fill)this._used.fill(0);else for(var e=0;e<this._used.length;e++)this._used[e]=0;else this._used=new Uint8Array(t)},_.recreateResource=function(){if(!this._source){var t=O.isConchApp?K.instance.getDefaultCommandEncoder():Se.mainContext,e=this._source=t.createTexture();this.texture.bitmap._glTexture=this._source,ge.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._texW,this._texH,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)}},_.addChar=function(t,e,i){if(he.isWan1Wan)return this.addCharCanvas(t,e,i),void 0;!this._source&&this.recreateResource();var _=O.isConchApp?K.instance.getDefaultCommandEncoder():Se.mainContext;ge.bindTexture(_,3553,this._source),!O.isConchApp&&_.pixelStorei(37441,!0);var r=t.data;t.data instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer)),_.texSubImage2D(3553,0,e,i,t.width,t.height,6408,5121,r),!O.isConchApp&&_.pixelStorei(37441,!1)},_.addCharCanvas=function(t,e,i){!this._source&&this.recreateResource();var _=O.isConchApp?K.instance.getDefaultCommandEncoder():Se.mainContext;ge.bindTexture(_,3553,this._source),!O.isConchApp&&_.pixelStorei(37441,!0),_.texSubImage2D(3553,0,e,i,6408,5121,t),!O.isConchApp&&_.pixelStorei(37441,!1)},_.destroy=function(){console.log("destroy CharPageTexture"),this.__destroyed=!0;var t=O.isConchApp?K.instance.getDefaultCommandEncoder():Se.mainContext;this._source&&t.deleteTexture(this._source),this._source=null},e}(y),Ze=function(t){function e(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,e.__super.call(this),this._glBuffer=K.instance.createBuffer()}r(e,"laya.webgl.utils.Buffer",t);var i=e.prototype;return i._bindForVAO=function(){},i.bind=function(){return!1},i._disposeResource=function(){this._glBuffer&&(K.instance.deleteBuffer(this._glBuffer),this._glBuffer=null),this._setGPUMemory(0)},a(0,i,"bufferUsage",function(){return this._bufferUsage}),e._bindedVertexBuffer=null,e._bindedIndexBuffer=null,e}(y),je=function(t){function e(){e.__super.call(this)}r(e,"laya.layagl.ConchSprite",t);var i=e.prototype;return i.parentRepaintForNative=function(t){void 0===t&&(t=2);var e=this._parent;e&&(e._conchData._int32Data[4]&t)!=t&&(e._conchData._int32Data[4]|=t,e.parentRepaintForNative(t))},i.renderToNative=function(t){var e=t.gl,i=K.getFrameCount()-1,_=this._conchData._int32Data,r=_[4];this._children.length>0?i!=_[3]||r>0&&1==(1&r)?(e.blockStart(this._conchData),this._renderChilds(t),e.blockEnd(this._conchData)):e.copyCmdBuffer(this._conchData._int32Data[1],this._conchData._int32Data[2]):e.block(this._conchData)},i._renderChilds=function(t){var e,i=this._children,_=0,r=i.length,a=this._style;if(a.viewport)for(var n=a.viewport,s=n.x,o=n.y,h=n.right,u=n.bottom,l=0/0,c=0/0;r>_;++_)(e=i[_])._visible&&(l=e._x)<h&&l+e.width>s&&(c=e._y)<u&&c+e.height>o&&e.renderToNative(t);else for(;r>_;++_)(e=i[_])._visible&&e.renderToNative(t)},i.repaintForNative=function(t){void 0===t&&(t=2),(this._conchData._int32Data[4]&t)!=t&&(this._conchData._int32Data[4]|=t,this.parentRepaintForNative(t))},e}(x),Qe=function(t){function e(t,i){e.__super.call(this),this._wrapModeU=0,this._wrapModeV=0,this._filterMode=1,this._readyed=!1,this._width=-1,this._height=-1,this._format=t,this._mipmap=i,this._anisoLevel=1,this._glTexture=K.instance.createTexture()}r(e,"laya.webgl.resource.BaseTexture",t);var i=e.prototype;return i._isPot=function(t){return 0===(t&t-1)},i._getGLFormat=function(){var t=0;switch(this._format){case 0:t=6407;break;case 1:t=6408;break;case 2:t=6406;break;case 3:if(!ge._compressedTextureS3tc)throw"BaseTexture: not support DXT1 format.";t=ge._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case 4:if(!ge._compressedTextureS3tc)throw"BaseTexture: not support DXT5 format.";t=ge._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 5:if(!ge._compressedTextureEtc1)throw"BaseTexture: not support ETC1RGB format.";t=ge._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;break;case 9:if(!ge._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_2BPPV format.";t=ge._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 10:if(!ge._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";t=ge._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 11:if(!ge._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_4BPPV format.";t=ge._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 12:if(!ge._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";t=ge._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:throw"BaseTexture: unknown texture format."}return t},i._setFilterMode=function(t){var e=K.instance;switch(ge.bindTexture(e,this._glTextureType,this._glTexture),t){case 0:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9984):e.texParameteri(this._glTextureType,10241,9728),e.texParameteri(this._glTextureType,10240,9728);break;case 1:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9985):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;case 2:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9987):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;default:throw new Error("BaseTexture:unknown filterMode value.")}},i._setWarpMode=function(t,e){var i=K.instance;if(ge.bindTexture(i,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(e){case 0:i.texParameteri(this._glTextureType,t,10497);break;case 1:i.texParameteri(this._glTextureType,t,33071)}else i.texParameteri(this._glTextureType,t,33071)},i._setAnisotropy=function(t){t=Math.max(t,1);var e=K.instance;ge.bindTexture(e,this._glTextureType,this._glTexture);var i=ge._extTextureFilterAnisotropic;i&&(t=Math.min(e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t),e.texParameterf(this._glTextureType,i.TEXTURE_MAX_ANISOTROPY_EXT,t))},i._disposeResource=function(){this._glTexture&&(K.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))},i._getSource=function(){return this._readyed?this._glTexture:null},a(0,i,"wrapModeU",function(){return this._wrapModeU},function(t){this._wrapModeU!==t&&(this._wrapModeU=t,-1!==this._width&&this._setWarpMode(10242,t))}),a(0,i,"mipmap",function(){return this._mipmap}),a(0,i,"format",function(){return this._format}),a(0,i,"wrapModeV",function(){return this._wrapModeV},function(t){this._wrapModeV!==t&&(this._wrapModeV=t,-1!==this._height&&this._setWarpMode(10243,t))}),a(0,i,"defaulteTexture",function(){throw"BaseTexture:must override it."}),a(0,i,"filterMode",function(){return this._filterMode},function(t){t!==this._filterMode&&(this._filterMode=t,-1!==this._width&&-1!==this._height&&this._setFilterMode(t))}),a(0,i,"anisoLevel",function(){return this._anisoLevel},function(t){t!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,t)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(t))}),e.WARPMODE_REPEAT=0,e.WARPMODE_CLAMP=1,e.FILTERMODE_POINT=0,e.FILTERMODE_BILINEAR=1,e.FILTERMODE_TRILINEAR=2,e.FORMAT_R8G8B8=0,e.FORMAT_R8G8B8A8=1,e.FORMAT_ALPHA8=2,e.FORMAT_DXT1=3,e.FORMAT_DXT5=4,e.FORMAT_ETC1RGB=5,e.FORMAT_PVRTCRGB_2BPPV=9,e.FORMAT_PVRTCRGBA_2BPPV=10,e.FORMAT_PVRTCRGB_4BPPV=11,e.FORMAT_PVRTCRGBA_4BPPV=12,e.FORMAT_DEPTH_16=0,e.FORMAT_STENCIL_8=1,e.FORMAT_DEPTHSTENCIL_16_8=2,e.FORMAT_DEPTHSTENCIL_NONE=3,e}(s),Ke=function(t){function e(t,i,_,r,a){if(this._attribInfo=null,this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},e.__super.call(this),!t||!i)throw"Shader Error";this._attribInfo=a,O.isConchApp&&(this.customCompile=!0),this._id=++e._count,this._vs=t,this._ps=i,this._nameMap=r?r:{},null!=_&&(e.sharders[_]=this),this.recreateResource(),this.lock=!0}r(e,"laya.webgl.shader.Shader",t);var i=e.prototype;return i.recreateResource=function(){this._compile(),this._setGPUMemory(0)},i._disposeResource=function(){Se.mainContext.deleteShader(this._vshader),Se.mainContext.deleteShader(this._pshader),Se.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0},i._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var t;this.customCompile&&(t=ye.preGetParams(this._vs,this._ps));var i=Se.mainContext;this._program=i.createProgram(),this._vshader=e._createShader(i,this._vs,35633),this._pshader=e._createShader(i,this._ps,35632),i.attachShader(this._program,this._vshader),i.attachShader(this._program,this._pshader);var _,r,a=0,n=0,s=this._attribInfo?this._attribInfo.length:0;for(a=0;s>a;a+=2)i.bindAttribLocation(this._program,this._attribInfo[a+1],this._attribInfo[a]);if(i.linkProgram(this._program),!this.customCompile&&!i.getProgramParameter(this._program,35714))throw i.getProgramInfoLog(this._program);var o=this.customCompile?t.uniforms.length:i.getProgramParameter(this._program,35718);for(a=0;o>a;a++){var h=this.customCompile?t.uniforms[a]:i.getActiveUniform(this._program,a);r=i.getUniformLocation(this._program,h.name),_={vartype:"uniform",glfun:null,ivartype:1,location:r,name:h.name,type:h.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},_.name.indexOf("[0]")>0&&(_.name=_.name.substr(0,_.name.length-3),_.isArray=!0,_.location=i.getUniformLocation(this._program,_.name)),this._params.push(_)}for(a=0,n=this._params.length;n>a;a++)switch(_=this._params[a],_.indexOfParams=a,_.index=1,_.value=[_.location,null],_.codename=_.name,_.name=this._nameMap[_.codename]?this._nameMap[_.codename]:_.codename,this._paramsMap[_.name]=_,_._this=this,_.uploadedValue=[],_.type){case 5124:_.fun=_.isArray?this._uniform1iv:this._uniform1i;break;case 5126:_.fun=_.isArray?this._uniform1fv:this._uniform1f;break;case 35664:_.fun=_.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:_.fun=_.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:_.fun=_.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:_.fun=this._uniform_sampler2D;break;case 35680:_.fun=this._uniform_samplerCube;break;case 35676:_.glfun=i.uniformMatrix4fv,_.fun=this._uniformMatrix4fv;break;case 35670:_.fun=this._uniform1i;break;case 35674:case 35675:throw new Error("compile shader err!");default:throw new Error("compile shader err!")}}},i.getUniform=function(t){return this._paramsMap[t]},i._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(Se.mainContext.uniform1f(t.location,i[0]=e),1):0},i._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(Se.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return Se.mainContext.uniform1fv(t.location,e),1},i._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(Se.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(Se.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return Se.mainContext.uniform2fv(t.location,e),1},i._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(Se.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3v=function(t,e){return Se.mainContext.uniform3fv(t.location,e),1},i._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(Se.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4v=function(t,e){return Se.mainContext.uniform4fv(t.location,e),1},i._uniformMatrix2fv=function(t,e){return Se.mainContext.uniformMatrix2fv(t.location,!1,e),1},i._uniformMatrix3fv=function(t,e){return Se.mainContext.uniformMatrix3fv(t.location,!1,e),1},i._uniformMatrix4fv=function(t,e){return Se.mainContext.uniformMatrix4fv(t.location,!1,e),1},i._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(Se.mainContext.uniform1i(t.location,i[0]=e),1):0},i._uniform1iv=function(t,e){return Se.mainContext.uniform1iv(t.location,e),1},i._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(Se.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_ivec2v=function(t,e){return Se.mainContext.uniform2iv(t.location,e),1},i._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(Se.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3vi=function(t,e){return Se.mainContext.uniform3iv(t.location,e),1
},i._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(Se.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4vi=function(t,e){return Se.mainContext.uniform4iv(t.location,e),1},i._uniform_sampler2D=function(t,e){var i=Se.mainContext,_=t.uploadedValue;return null==_[0]?(_[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),ge.activeTexture(i,33984+this._curActTexIndex),ge.bindTexture(i,3553,e),this._curActTexIndex++,1):(ge.activeTexture(i,33984+_[0]),ge.bindTexture(i,3553,e),0)},i._uniform_samplerCube=function(t,e){var i=Se.mainContext,_=t.uploadedValue;return null==_[0]?(_[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),ge.activeTexture(i,33984+this._curActTexIndex),ge.bindTexture(i,34067,e),this._curActTexIndex++,1):(ge.activeTexture(i,33984+_[0]),ge.bindTexture(i,34067,e),0)},i._noSetValue=function(t){console.log("no....:"+t.name)},i.uploadOne=function(t,e){ge.useProgram(Se.mainContext,this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},i.uploadTexture2D=function(t){var e=ge;e._activeTextures[0]!==t&&(e.bindTexture(Se.mainContext,e.TEXTURE_2D,t),e._activeTextures[0]=t)},i.upload=function(t,e){Ye.activeShader=Ye.bindShader=this;var i=Se.mainContext;ge.useProgram(i,this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var _,r,a=e.length,n=0,s=0;a>s;s++)_=e[s],null!==(r=t[_.name])&&(n+=_.fun.call(this,_,r));F.shaderCall+=n},i.uploadArray=function(t,e,i){Ye.activeShader=this,Ye.bindShader=this,ge.useProgram(Se.mainContext,this._program);for(var _,r,a=(this._params,0),n=e-2;n>=0;n-=2)r=this._paramsMap[t[n]],r&&(_=t[n+1],null!=_&&(i&&i[r.name]&&i[r.name].bind(),a+=r.fun.call(this,r,_)));F.shaderCall+=a},i.getParams=function(){return this._params},i.setAttributesLocation=function(t){this._attribInfo=t},e.getShader=function(t){return e.sharders[t]},e.create=function(t,i,_,r,a){return new e(t,i,_,r,a)},e.withCompile=function(t,i,_,r){if(_&&e.sharders[_])return e.sharders[_];var a=e._preCompileShader[2e-4*t];if(!a)throw new Error("withCompile shader err!"+t);return a.createShader(i,_,r,null)},e.withCompile2D=function(t,i,_,r,a,n){if(r&&e.sharders[r])return e.sharders[r];var s=e._preCompileShader[2e-4*t+i];if(!s)throw new Error("withCompile shader err!"+t+" "+i);return s.createShader(_,r,a,n)},e.addInclude=function(t,e){ye.addInclude(t,e)},e.preCompile=function(t,i,_,r){var a=2e-4*t;e._preCompileShader[a]=new ye(i,_,r)},e.preCompile2D=function(t,i,_,r,a){var n=2e-4*t+i;e._preCompileShader[n]=new ye(_,r,a)},e._createShader=function(t,e,i){var _=t.createShader(i);return t.shaderSource(_,e),t.compileShader(_),t.getShaderParameter(_,35713)?_:(console.log(t.getShaderInfoLog(_)),null)},e._count=0,e._preCompileShader={},e.SHADERNAME2ID=2e-4,e.sharders=new Array(32),_(e,["nameKey",function(){return this.nameKey=new V}]),e}(Ye),qe=function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,this._bufferSize=0,this._u8Array=null,e.__super.call(this),this.lock=!0}r(e,"laya.webgl.utils.Buffer2D",t);var i=e.prototype;return i.setByteLength=function(t){this._byteLength!==t&&(t<=this._bufferSize||this._resizeBuffer(2*t+256,!0),this._byteLength=t)},i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._bufferSize||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),F.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._setGPUMemory(this._buffer.byteLength),this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,K.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this._setGPUMemory(this._uploadSize)),K.instance.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),F.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._setGPUMemory(this._buffer.byteLength),this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,K.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this._setGPUMemory(this._uploadSize)),e||i){var _=this._buffer.slice(e,i);K.instance.bufferSubData(this._bufferType,t,_)}else K.instance.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_uploadForVAO=function(){return this._upload?(this._upload=!1,this._bindForVAO(),this._bufferData(),!0):!1},i._bind_upload=function(){return this._upload?(this._upload=!1,this.bind(),this._bufferData(),!0):!1},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._upload?(this._upload=!1,this.bind(),this._bufferSubData(t,e,i),!0):!1},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this._setGPUMemory(t),e&&this._buffer&&this._buffer.byteLength>0){var i=new ArrayBuffer(t),_=this._u8Array&&this._u8Array.buffer==this._buffer?this._u8Array:new Uint8Array(this._buffer);this._u8Array=new Uint8Array(i),this._u8Array.set(_,0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this._bufferSize=this._buffer.byteLength,this},i.append=function(t){this._upload=!0;var e,i=0;i=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+i,!0),e=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+i,!0),e=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+i,!0),e=new Float32Array(this._buffer,this._byteLength)),e.set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),_=0;e>_;_++)i[_]=t[_];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i,_=0;_=t.byteLength,this._resizeBuffer(this._byteLength+_,!0),i=new e(this._buffer,this._byteLength),i.set(t,0),this._byteLength+=_,this._checkArrayUse()},i.appendEx2=function(t,e,i,_){void 0===_&&(_=1),this._upload=!0;var r,a=0;a=i*_,this._resizeBuffer(this._byteLength+a,!0),r=new e(this._buffer,this._byteLength);var n=0;for(n=0;i>n;n++)r[n]=t[n];this._byteLength+=a,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return K.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(Ze._bindedVertexBuffer=null),34963==this._bufferType&&(Ze._bindedIndexBuffer=null),Ye.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var _=this._bind_subUpload();return K.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(Ze._bindedVertexBuffer=null),34963==this._bufferType&&(Ze._bindedIndexBuffer=null),Ye.activeShader=null,_},i._disposeResource=function(){t.prototype._disposeResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},a(0,i,"bufferLength",function(){return this._buffer.byteLength}),a(0,i,"byteLength",null,function(t){this.setByteLength(t)}),e.__int__=function(){},e.FLOAT32=4,e.SHORT=2,e}(Ze),$e=function(t){function e(t,i,_,r){this._mgrKey=0,void 0===_&&(_=0),void 0===r&&(r=0),e.__super.call(this,_,!1),this._glTextureType=3553,this._width=t,this._height=i,this._depthStencilFormat=r,this._create(t,i)}r(e,"laya.webgl.resource.RenderTexture2D",t);var i=e.prototype;return i._create=function(t,e){var i=K.instance;this._frameBuffer=i.createFramebuffer(),ge.bindTexture(i,this._glTextureType,this._glTexture);var _=this._getGLFormat();if(i.texImage2D(this._glTextureType,0,_,t,e,0,_,5121,null),this._setGPUMemory(t*e*4),i.bindFramebuffer(36160,this._frameBuffer),i.framebufferTexture2D(36160,36064,3553,this._glTexture,0),3!==this._depthStencilFormat)switch(this._depthStencilBuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:i.renderbufferStorage(36161,33189,t,e),i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:i.renderbufferStorage(36161,36168,t,e),i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:i.renderbufferStorage(36161,34041,t,e),i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:console.log("RenderTexture: unkonw depth format.")}i.bindFramebuffer(36160,null),i.bindRenderbuffer(36161,null),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()},i.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,K.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))},i.start=function(){var t=K.instance;K.instance.bindFramebuffer(36160,this._frameBuffer),e._currentActive=this,this._readyed=!0,t.viewport(0,0,this._width,this._height),this._lastWidth=Le.width,this._lastHeight=Le.height,Le.width=this._width,Le.height=this._height,Ye.activeShader=null},i.end=function(){K.instance.bindFramebuffer(36160,null),e._currentActive=null,this._readyed=!0},i.restore=function(){var t=K.instance;this._lastRT!=e._currentActive&&(K.instance.bindFramebuffer(36160,this._lastRT?this._lastRT._frameBuffer:null),e._currentActive=this._lastRT),this._readyed=!0,t.viewport(0,0,this._lastWidth,this._lastHeight),Le.width=this._lastWidth,Le.height=this._lastHeight,Ye.activeShader=null},i.clear=function(t,e,i,_){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===_&&(_=1);var r=K.instance;r.clearColor(t,e,i,_);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}r.clear(a)},i.getData=function(t,e,i,_){var r=K.instance;r.bindFramebuffer(36160,this._frameBuffer);var a=36053===r.checkFramebufferStatus(36160);if(!a)return r.bindFramebuffer(36160,null),null;var n=new Uint8Array(this._width*this._height*4),s=this._getGLFormat();return r.readPixels(t,e,i,_,s,5121,n),r.bindFramebuffer(36160,null),n},i._disposeResource=function(){if(this._frameBuffer){var t=K.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}},a(0,i,"depthStencilFormat",function(){return this._depthStencilFormat}),a(0,i,"defaulteTexture",function(){return Je.grayTexture}),a(1,e,"currentActive",function(){return e._currentActive},laya.webgl.resource.BaseTexture._$SET_currentActive),e.pushRT=function(){e.rtStack.push({rt:e._currentActive,w:Le.width,h:Le.height})},e.popRT=function(){var t=K.instance,i=e.rtStack.pop();i&&(e._currentActive!=i.rt&&(K.instance.bindFramebuffer(36160,i.rt?i.rt._frameBuffer:null),e._currentActive=i.rt),t.viewport(0,0,i.w,i.h),Le.width=i.w,Le.height=i.h)},e._currentActive=null,e.rtStack=[],_(e,["defuv",function(){return this.defuv=[0,0,1,0,1,1,0,1]},"flipyuv",function(){return this.flipyuv=[0,1,1,1,1,0,0,0]}]),e}(Qe),Je=function(t){function e(t,i,_,r,a){void 0===t&&(t=0),void 0===i&&(i=0),void 0===_&&(_=1),void 0===r&&(r=!0),void 0===a&&(a=!1),e.__super.call(this,_,r),this._glTextureType=3553,this._width=t,this._height=i,this._canRead=a,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),l.is2DPixelArtGame&&(this._filterMode=0),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel)}r(e,"laya.webgl.resource.Texture2D",t);var _=e.prototype;return _._calcualatesCompressedDataSize=function(t,e,i){switch(t){case 3:case 5:return(e+3>>2)*(i+3>>2)*8;case 4:return(e+3>>2)*(i+3>>2)*16;case 11:case 12:return Math.floor((Math.max(e,8)*Math.max(i,8)*4+7)/8);case 9:case 10:return Math.floor((Math.max(e,16)*Math.max(i,8)*2+7)/8);default:return 0}},_._pharseDDS=function(t){var e=827611204,i=894720068,_=4,r=131072,a=542327876,n=31,s=0,o=1,h=2,u=3,l=4,c=7,f=20,d=21,E=new Int32Array(t,0,n);if(E[s]!=a)throw"Invalid magic number in DDS header";if(!(E[f]&_))throw"Unsupported format, must contain a FourCC code";var A=E[d];switch(this._format){case 3:if(A!==e)throw"the FourCC code is not same with texture format.";break;case 4:if(A!==i)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var D=1;if(E[h]&r){if(D=Math.max(1,E[c]),!this._mipmap)throw"the mipmap is not same with Texture2D."}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var R=E[l],m=E[u];if(this._width!==R||this._height!==m)throw"the width or height is not same with Texture2D.";var T=E[o]+4;this._upLoadCompressedTexImage2D(t,R,m,D,T,0)},_._pharseKTX=function(t){var e=13,i=4,_=7,r=6,a=11,n=12,s=new Uint8Array(t,0,12);if(171!=s[0]||75!=s[1]||84!=s[2]||88!=s[3]||32!=s[4]||49!=s[5]||49!=s[6]||187!=s[7]||13!=s[8]||10!=s[9]||26!=s[10]||10!=s[11])throw"Invalid fileIdentifier in KTX header";var o=new Int32Array(s.buffer,s.length,e),h=o[i],u=this._getGLFormat();switch(this._format){case 5:if(h!==u)throw"the format  is not same with texture format FORMAT_ETC1RGB.";break;default:throw"unknown texture format."}var l=o[a],c=o[r],f=o[_];if(this._width!==c||this._height!==f)throw"the width or height is not same with Texture2D.";var d=64+o[n];this._upLoadCompressedTexImage2D(t,c,f,l,d,4)},_._pharsePVR=function(t){var e=0,i=1,_=2,r=3,a=6,n=55727696,s=13,o=0,h=2,u=6,l=7,c=11,f=12,d=new Int32Array(t,0,s);if(d[o]!=n)throw"Invalid magic number in PVR header";var E=d[h];switch(this._format){case 5:if(E!==a)throw"the format  is not same with texture format FORMAT_ETC1RGB.";break;case 9:if(E!==e)throw"the format  is not same with texture format FORMAT_PVRTCRGB_2BPPV.";break;case 11:if(E!==_)throw"the format  is not same with texture format FORMAT_PVRTCRGB_4BPPV.";break;case 10:if(E!==i)throw"the format  is not same with texture format FORMAT_PVRTCRGBA_2BPPV.";break;case 12:if(E!==r)throw"the format  is not same with texture format FORMAT_PVRTCRGBA_4BPPV.";break;default:throw"unknown texture format."}var A=d[c],D=d[l],R=d[u];if(this._width!==D||this._height!==R)throw"the width or height is not same with Texture2D.";var m=d[f]+52;this._upLoadCompressedTexImage2D(t,D,R,A,m,0)},_._upLoadCompressedTexImage2D=function(t,e,i,_,r,a){var n=K.instance,s=this._glTextureType;ge.bindTexture(n,s,this._glTexture);for(var o=this._getGLFormat(),h=r,u=0;_>u;u++){h+=a;var l=this._calcualatesCompressedDataSize(this._format,e,i),c=new Uint8Array(t,h,l);n.compressedTexImage2D(s,u,o,e,i,0,c),e>>=1,i>>=1,h+=l}var f=h;this._setGPUMemory(f),this._readyed=!0,this._activeResource()},_.loadImageSource=function(t,e){void 0===e&&(e=!1);var i=t.width,_=t.height;this._width=i,this._height=_,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode);var r=K.instance;ge.bindTexture(r,this._glTextureType,this._glTexture);var a=this._getGLFormat();O.isConchApp?(t.setPremultiplyAlpha(e),r.texImage2D(this._glTextureType,0,6408,6408,5121,t)):(e&&r.pixelStorei(37441,!0),r.texImage2D(this._glTextureType,0,a,a,5121,t),e&&r.pixelStorei(37441,!1)),this._mipmap&&this._isPot(i)&&this._isPot(_)?(r.generateMipmap(this._glTextureType),this._setGPUMemory(i*_*4*(1+1/3))):this._setGPUMemory(i*_*4),this._canRead&&(O.isConchApp?this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,i,_)):(o.canvas.size(i,_),o.canvas.clear(),o.context.drawImage(t,0,0,i,_),this._pixels=new Uint8Array(o.context.getImageData(0,0,i,_).data.buffer))),this._readyed=!0,this._activeResource()},_.setPixels=function(t,e){if(void 0===e&&(e=0),!t)throw"Texture2D:pixels can't be null.";var i=this._width,_=this._height,r=K.instance,a=this._glTextureType;ge.bindTexture(r,a,this._glTexture);var n=this._getGLFormat();r.texImage2D(a,e,n,i,_,0,n,5121,t),this._mipmap&&this._isPot(i)&&this._isPot(_)?(r.generateMipmap(a),this._setGPUMemory(i*_*4*(1+1/3))):this._setGPUMemory(i*_*4),this._canRead&&(this._pixels=t),this._readyed=!0,this._activeResource()},_.setCompressData=function(t){switch(this._format){case 3:case 4:this._pharseDDS(t);break;case 5:this._pharseKTX(t);break;case 9:case 10:case 11:case 12:this._pharsePVR(t);break;default:throw"Texture2D:unkonwn format."}},_._recoverResource=function(){},_.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},a(0,_,"defaulteTexture",function(){return laya.webgl.resource.Texture2D.grayTexture}),e.__init__=function(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,e.grayTexture=new e(1,1,0,!1,!1),e.grayTexture.setPixels(t),e.grayTexture.lock=!0},e._parse=function(t,i,_){var r=_?new e(_[0],_[1],_[2],_[3],_[4]):new e(0,0);switch(i&&(r.wrapModeU=i.wrapModeU,r.wrapModeV=i.wrapModeV,r.filterMode=i.filterMode,r.anisoLevel=i.anisoLevel),r._format){case 0:case 1:r.loadImageSource(t);break;case 3:case 4:case 5:case 9:case 10:case 11:case 12:r.setCompressData(t);break;default:throw"Texture2D:unkonwn format."}return r},e.load=function(t,e){i.loader.create(t,e,null,"TEXTURE2D")},e.grayTexture=null,e}(Qe),ti=function(t){function e(t,i,_,r,a){this._params2dQuick2=null,this._shaderValueWidth=0,this._shaderValueHeight=0,e.__super.call(this,t,i,_,r,a)}r(e,"laya.webgl.shader.d2.Shader2X",t);var i=e.prototype;return i._disposeResource=function(){t.prototype._disposeResource.call(this),this._params2dQuick2=null},i.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},i._make2dQuick2=function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var t,e=this._params,i=0,_=e.length;_>i;i++)t=e[i],"size"!==t.name&&this._params2dQuick2.push(t)}return this._params2dQuick2},e.create=function(t,i,_,r,a){return new e(t,i,_,r,a)},e}(Ke),ei=function(t){function e(t){this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,this._buffer=new ArrayBuffer(8)}r(e,"laya.webgl.utils.IndexBuffer2D",t);var i=e.prototype;return i._checkArrayUse=function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i._bindForVAO=function(){K.instance.bindBuffer(34963,this._glBuffer)},i.bind=function(){return Ze._bindedIndexBuffer!==this._glBuffer?(K.instance.bindBuffer(34963,this._glBuffer),Ze._bindedIndexBuffer=this._glBuffer,!0):!1},i.destory=function(){this._uint16Array=null,this._buffer=null},i.disposeResource=function(){this._disposeResource()},e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(qe),ii=function(t){function e(t,i){this._floatArray32=null,this._uint32Array=null,this._vertexStride=0,e.__super.call(this),this._vertexStride=t,this._bufferUsage=i,this._bufferType=34962,this._buffer=new ArrayBuffer(8),this._floatArray32=new Float32Array(this._buffer),this._uint32Array=new Uint32Array(this._buffer)}r(e,"laya.webgl.utils.VertexBuffer2D",t);var i=e.prototype;return i.getFloat32Array=function(){return this._floatArray32},i.appendArray=function(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+4*t.length);var i=this.getFloat32Array();i.set(t,e),this._upload=!0},i._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))},i.deleteBuffer=function(){this._disposeResource()},i._bindForVAO=function(){K.instance.bindBuffer(34962,this._glBuffer)},i.bind=function(){return Ze._bindedVertexBuffer!==this._glBuffer?(K.instance.bindBuffer(34962,this._glBuffer),Ze._bindedVertexBuffer=this._glBuffer,!0):!1},i.destroy=function(){laya.resource.Resource.prototype.destroy.call(this),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},a(0,i,"vertexStride",function(){return this._vertexStride}),e.create=function(t,i){return void 0===i&&(i=35048),new e(t,i)},e}(qe);i.__init([he,be,ye,re])}(window,document,Laya);