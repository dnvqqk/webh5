var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function r(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(){function t(e,a,r){function n(o,s){if(!a[o]){if(!e[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=a[o]={exports:{}};e[o][0].call(h.exports,function(t){return n(e[o][1][t]||t)},h,h.exports,t,e,a,r)}return a[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}return t}()({1:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=function(){function t(){}return t.init=function(){},t.width=640,t.height=1136,t.scaleMode="fixedwidth",t.screenMode="none",t.startScene="",t.sceneRoot="",t.debug=!1,t.stat=!0,t.physicsDebug=!1,t.exportSceneToJson=!0,t}();a.default=r,r.init()},{}],2:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=t("./GameConfig"),n=t("./wmyUtilsH5/d3/WmyUtils3D"),i=t("./wmyUtilsH5/Wmy_Load_Mag"),o=t("./tar/WmyTar");new(function(){function t(){window.Laya3D?Laya3D.init(r.default.width,r.default.height):Laya.init(r.default.width,r.default.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=Laya.Stage.SCALE_SHOWALL,Laya.stage.screenMode=r.default.screenMode,Laya.stage.alignH="center",Laya.stage.alignV="middle",Laya.URL.exportSceneToJson=r.default.exportSceneToJson,(r.default.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),r.default.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),r.default.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,o.default.getThis.init();null!=window&&null!=window.wmyVTime&&window.wmyVTime}return t.prototype.onVersionLoaded=function(){Laya.stage.addChild(fairygui.GRoot.inst.displayObject);var t=Laya.ResourceVersion.addVersionPrefix("res/loadInfo.json");i.Wmy_Load_Mag.getThis.onLoadWetData(t,Laya.Handler.create(this,this.onLoadLoad))},t.prototype.onLoadLoad=function(){var t=i.Wmy_Load_Mag.getThis.getResObj("load");null!=t&&i.Wmy_Load_Mag.getThis.onload(t,new Laya.Handler(this,this.onLoadMain))},t.prototype.onLoadMain=function(){this._loadView=fairygui.UIPackage.createObject("load","Load").asCom,fairygui.GRoot.inst.addChild(this._loadView),this._bar=this._loadView.getChild("bar").asProgress,i.Wmy_Load_Mag.getThis.onAutoLoadAll(new Laya.Handler(this,this.onLoadOk),new Laya.Handler(this,this.onLoading))},t.prototype.onLoading=function(t){this._bar.value=t},t.prototype.onLoadOk=function(t,e){var a=this;if(this._u3dArr=e,Laya.timer.once(400,this,function(){a.onMain(),fairygui.GRoot.inst.removeChild(a._loadView),a._loadView=null,a._bar=null}),null!=e[0]){var r=e[0].urlList[0];this.scene3D=Laya.loader.getRes(r),n.WmyUtils3D.setShaderAll(this.scene3D,"res/mats/","res/shaders/")}},t.prototype.onMain=function(){if(this._mainView=fairygui.UIPackage.createObject("main","Main").asCom,null!=this._mainView){fairygui.GRoot.inst.addChild(this._mainView);var t=this._mainView.getChild("_Main").asCom.getChild("d3").asCom;null!=this.scene3D&&t.displayObject.addChild(this.scene3D)}},t}())},{"./GameConfig":1,"./tar/WmyTar":3,"./wmyUtilsH5/Wmy_Load_Mag":5,"./wmyUtilsH5/d3/WmyUtils3D":9}],3:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=function(){function t(){}return Object.defineProperty(t,"getThis",{get:function(){return null==t._this&&(t._this=new t),t._this},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t=this;this._render=new TAR.Render,this._ar=new TAR.AR,this._engine=new TAR.Engine,this._render.init(),TAR.ENV.IOS?this.ARInit():TAR.ENV.ANDROID&&(TAR.TARUtils.STATUS_CHANGE(null,null,function(){},function(){console.log("Init AR fail. Platform android. download engine error")}),TAR.AR.initAREngine({type:2},function(){t._ar.setEngineDownload(!0),console.log("Init AR success. Platform android. AR Engine download success, you can use ability of tar ")},function(){console.log("Init AR fail. Platform android. init fail")}),this.ARInit())},t.prototype.ARInit=function(){var t=this;this._ar.load().then(function(e){t._render.setVRDisplay(e),t._engine.create("Laya"),t._engine.load(e,null,function(){})}).catch(function(t){console.log("exception = "+t)})},t}();a.default=r},{}],4:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=function(t){function e(){var e=t.call(this)||this;return e._eventList=new Array,Laya.stage.on(laya.events.Event.MOUSE_DOWN,e,e.__onTouchDown),Laya.stage.on(laya.events.Event.MOUSE_UP,e,e.__onTouchUp),Laya.stage.on(laya.events.Event.MOUSE_MOVE,e,e.__OnMouseMOVE),Laya.stage.on(Laya.Event.RESIZE,e,e.__onResize),e}return __extends(e,t),Object.defineProperty(e,"getThis",{get:function(){return null==e._this&&(e._this=new e),e._this},enumerable:!0,configurable:!0}),e.prototype.convertColorToColorFiltersMatrix=function(t,a,r,n){return e.COLOR_FILTERS_MATRIX[0]=t,e.COLOR_FILTERS_MATRIX[6]=a,e.COLOR_FILTERS_MATRIX[12]=r,e.COLOR_FILTERS_MATRIX[18]=n||1,e.COLOR_FILTERS_MATRIX},e.prototype.applyColorFilters=function(t,e){t.filters=null,16777215!=e&&(t.filters=[new Laya.ColorFilter(this.convertColorToColorFiltersMatrix((e>>16&255)/255,(e>>8&255)/255,(255&e)/255))])},e.prototype.applyColorFilters1=function(t,e,a,r,n){t.filters=null,(e<1||a<1||r<1||n<1)&&(t.filters=[new Laya.ColorFilter(this.convertColorToColorFiltersMatrix(e,a,r,n))])},e.prototype.isPc=function(){return!(this.versions().android||this.versions().iPhone||this.versions().ios)&&(this.versions().iPad,!0)},e.prototype.versions=function(){var t=navigator.userAgent;navigator.appVersion;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/)||!!t.match(/AppleWebKit/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari")}},e.getUrlV=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(e);return a?decodeURIComponent(a[2]):null},e.prototype.onNavigate=function(t,e){void 0===e&&(e=!1),e?window.location.replace(t):window.location.href=t},e.prototype.__onTouchDown=function(t){this._eventList.indexOf(t)<0&&this._eventList.push(t)},e.prototype.__onTouchUp=function(t){this._eventList.indexOf(t)>=0&&this._eventList.splice(this._eventList.indexOf(t),1)},e.prototype.__onResize=function(){this._eventList.forEach(function(t){t.type=Laya.Event.MOUSE_UP,Laya.stage.event(Laya.Event.MOUSE_UP,t)}),this._eventList=new Array},e.prototype.__OnMouseMOVE=function(t){(t.stageX<=10||t.stageX>=Laya.stage.width-10||t.stageY<=10||t.stageY>=Laya.stage.height-10)&&(t.type=Laya.Event.MOUSE_UP,Laya.stage.event(Laya.Event.MOUSE_UP,t))},e.onNumTo=function(t,e){return void 0===e&&(e=2),(t+"").indexOf(".")>=0&&(t=parseFloat(t.toFixed(e))),t},e.getR_XY=function(t,e){var a=e*Math.PI/180,r=t*Math.cos(a),n=t*Math.sin(a);return new Laya.Point(r,n)},e.string2buffer=function(t){for(var e="",a=0;a<t.length;a++)""===e?e=t.charCodeAt(a).toString(16):e+=","+t.charCodeAt(a).toString(16);return new Uint8Array(e.match(/[\da-f]{2}/gi).map(function(t){return parseInt(t,16)})).buffer},e.replaceAll=function(t,e,a){var r="";return(r=t.replace(e,a)).indexOf(e)>=0&&(r=this.replaceAll(r,e,a)),r},e.toCase=function(t,e){void 0===e&&(e=!1);return e?t.toUpperCase():t.toLowerCase()},e.getDistance=function(t,e){var a=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y),n=Math.sqrt(Math.pow(a,2)+Math.pow(r,2));return n=parseFloat(n.toFixed(2))},e.getXyToR=function(t,e){var a=Math.atan2(t,e),r=180/Math.PI*a;return r=this.onNumTo(r)},e.storage=function(t,e,a){void 0===e&&(e="?"),void 0===a&&(a=!0);var r=a?localStorage:sessionStorage;if("?"==e){return r.getItem(t)}return null!=e?(r.setItem(t,e),e):(r.removeItem(t),null)},e.playFuiSound=function(t,e,a,r,n){if(void 0===e&&(e=.2),void 0===r&&(r=0),void 0===n&&(n=1),!(e<=0)){var i=fairygui.UIPackage.getItemByURL(t).file;Laya.SoundManager.playSound(i,n,a,null,r),Laya.SoundManager.setSoundVolume(e,i)}},e.COLOR_FILTERS_MATRIX=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],e}(laya.events.EventDispatcher);a.WmyUtils=r},{}],5:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=t("./WmyUtils"),n=t("./d3/WmyLoad3d"),i=t("./d3/WmyLoadMats"),o=function(){function t(){this._wetData={},this.resUrl="",this._resDataArr=[],this._callbackOk=[],this._callbackProgress=[]}return Object.defineProperty(t,"getThis",{get:function(){return null==t._this&&(t._this=new t),t._this},enumerable:!0,configurable:!0}),t.prototype.getWetData=function(t){return this._wetData[t]},t.prototype.setWetData=function(t,e){if(""==this.resUrl){this.resUrl=e;try{JSON.parse(t)}catch(t){}}null==e&&(e=this.resUrl),this._wetData[e]=t},t.prototype.getResObj=function(t,e){var a;if(null==e&&(e=this.resUrl),null==(a=this.getWetData(e)))return console.warn("空数据"),null;var r=null;if(a instanceof Array&&(r=a),null==r)try{r=JSON.parse(a)}catch(t){return console.warn("加载材料数据错误",a),null}for(var n=null,i=0;i<r.length;i++){var o=r[i];if(o.resName==t){n=o;break}}return n},t.prototype.onLoadWetData=function(t,e){if(""!=t){if(null==this.getWetData(t)){return Laya.loader.load(t,new Laya.Handler(this,function(a){this.setWetData(a,t),e.runWith([this._wetData[t]])}))}e.runWith([this.getWetData(t)])}},t.prototype.onload=function(t,e,a){var n=t.resName;if(null!=this._resDataArr[n])this._resDataArr[n].runWith([this._resDataArr[n]]);else{if(null!=this._callbackOk[n])return this._callbackOk[n].push(e),null!=a&&this._callbackProgress[n].push(a),!0;var i=t.Resres,o={},s=t.resData;if(null!=s&&""!=s)try{o=JSON.parse(s)}catch(t){console.warn("加载材料数据错误",s)}for(var l,u=[],h=0;h<i.length;h++){var d=i[h].resUrl;if(null!=d){var c=d=r.WmyUtils.toCase(d);c.indexOf(".txt")>=0?(u.push({url:c,type:Laya.Loader.BUFFER}),l=d):c.indexOf(".jpg")>=0||c.indexOf(".png")>=0?u.push({url:c,type:Laya.Loader.IMAGE}):c.indexOf(".mp3")>=0||c.indexOf(".wav")>=0?u.push({url:c,type:Laya.Loader.SOUND}):u.push({url:c})}}if(u.length<=0)return!1;this._callbackOk[n]=[],this._callbackOk[n].push(e),this._callbackProgress[n]=[],null!=a&&this._callbackProgress[n].push(a),Laya.loader.load(u,Laya.Handler.create(this,this.onAssetConmplete,[n,l,o]),Laya.Handler.create(this,this.onAssetProgress,[n],!1))}return!0},t.prototype.onload3d=function(t,e,a){var r=t.resName;if(null!=this._resDataArr[r])this._resDataArr[r].runWith([this._resDataArr[r]]);else{if(null!=this._callbackOk[r])return this._callbackOk[r].push(e),null!=a&&this._callbackProgress[r].push(a),!0;var i=t.Resres,o={},s=t.resData;if(null!=s&&""!=s)try{o=JSON.parse(s)}catch(t){console.warn("加载材料数据错误",s)}for(var l=[],u=[],h=0;h<i.length;h++){var d=i[h].resUrl;if(null!=d){var c=d;d.indexOf(".ls")>=0&&(l.push({url:c}),u.push(c))}}if(l.length<=0)return!1;this._callbackOk[r]=[],this._callbackOk[r].push(e),this._callbackProgress[r]=[],null!=a&&this._callbackProgress[r].push(a),o.urlList=u,n.WmyLoad3d.getThis.onload3d(l,Laya.Handler.create(this,this.onAssetConmplete,[r,void 0,o]),Laya.Handler.create(this,this.onAssetProgress,[r],!1))}return!0},t.prototype.onAssetProgress=function(t,e){for(var a=this._callbackProgress[t],r=0;r<a.length;r++){a[r].runWith([e])}},t.prototype.onAssetConmplete=function(t,e,a){var r=this._callbackOk[t];if(null!=e){var n=Laya.loader.getRes(e),i=e.replace(".txt","");try{fairygui.UIPackage.addPackage(i,n)}catch(t){console.warn("FUI-出错:",i)}var o=i.split("/");a.bName=o[o.length-1],this._resDataArr[t]=a}for(var s=0;s<r.length;s++){r[s].runWith([a])}this._callbackOk[t]=null,this._callbackProgress[t]=null},t.prototype.onAutoLoadAll=function(t,e){var a=this.getWetData(this.resUrl);if(null==a)return console.warn("空数据"),null;var r=null;if(a instanceof Array&&(r=a),null==r)try{r=JSON.parse(a)}catch(t){return console.warn("加载材料数据错误",a),null}this._autoLoadrCallbackOk=t,this._autoLoadrCallbackProgress=e,this._autoLoadInfoArr={},this._autoLoadInfoArr.num=0,this._autoLoadInfoArr.cNum=0,this._autoLoadInfoArr.uiArr=[],this._autoLoadInfoArr.u3dArr=[];for(var n=0;n<r.length;n++){var i=r[n],o=i.resName,s=i.type;null!=o&&""!=o&&null!=s&&""!=s&&this.onAutoLoadObj(s,o)}},t.prototype.onAutoLoadObj=function(t,e){var a=this,r=this.getResObj(e);if(null!=r){var n=this._autoLoadInfoArr.num;this._autoLoadInfoArr[n]={},this._autoLoadInfoArr[n].n=e,this._autoLoadInfoArr[n].t=t;var o=!1;if("ui"==t)o=this.onload(r,new Laya.Handler(this,this.onLoadOk,[n]),new Laya.Handler(this,this.onLoading,[n])),this._autoLoadInfoArr.num+=1,o||(console.warn("ui-出错:",e),Laya.timer.once(100,null,function(t){a.onLoadOk(t)},[n]));else if("u3d"==t)o=this.onload3d(r,new Laya.Handler(this,this.onLoadOk,[n]),new Laya.Handler(this,this.onLoading,[n])),this._autoLoadInfoArr.num+=1,o||(console.warn("u3d-出错:",e),Laya.timer.once(100,null,function(t){a.onLoadOk(t)},[n]));else if("mats"==t){for(var s=r.Resres,l=[],u=0;u<s.length;u++){h=(d=s[u]).resUrl;if(null!=(h=Laya.ResourceVersion.addVersionPrefix(h))){c=h;l.push(c)}}l.length>0&&(i.WmyLoadMats.getThis.onload3d(l,new Laya.Handler(this,this.onLoadOk,[n]),new Laya.Handler(this,this.onLoading,[n])),o=!0),this._autoLoadInfoArr.num+=1,o||(console.warn("mats-出错:",e),Laya.timer.once(100,null,function(t){a.onLoadOk(t)},[n]))}else if("cubeMap"==t)for(var s=r.Resres,u=0;u<s.length;u++){var h,d=s[u],c=h=d.resUrl;Laya.TextureCube.load(c,null)}else"audio"==t&&(o=this.onload(r,new Laya.Handler(this,this.onLoadOk,[n]),new Laya.Handler(this,this.onLoading,[n])),this._autoLoadInfoArr.num+=1,o||(console.warn("audio-出错:",e),Laya.timer.once(100,null,function(t){a.onLoadOk(t)},[n])))}},t.prototype.getCube=function(t,e){var a=this.getResObj(t);if(null!=a){for(var r=a.Resres,n=[],i=0;i<r.length;i++){var o=r[i].resUrl,s=o=Laya.ResourceVersion.addVersionPrefix(o);Laya.TextureCube.load(s,new Laya.Handler(this,function(t){n[i]=t,e.runWith([t,i])}))}return n}},t.prototype.onLoading=function(t,e){this._autoLoadInfoArr[t].p=e;for(var a=this._autoLoadInfoArr.num,r=0,n=0;n<a;n++){var i=this._autoLoadInfoArr[n].p;null!=i&&(r+=i)}var o=r/this._autoLoadInfoArr.num*100;isNaN(o)&&(o=0),null!=this._autoLoadrCallbackProgress&&this._autoLoadrCallbackProgress.runWith([o])},t.prototype.onLoadOk=function(t,e){this._autoLoadInfoArr.cNum+=1,"ui"==this._autoLoadInfoArr[t].t?this._autoLoadInfoArr.uiArr.push(e):"u3d"==this._autoLoadInfoArr[t].t&&this._autoLoadInfoArr.u3dArr.push(e),this._autoLoadInfoArr.cNum>=this._autoLoadInfoArr.num&&null!=this._autoLoadrCallbackOk&&this._autoLoadrCallbackOk.runWith([this._autoLoadInfoArr.uiArr,this._autoLoadInfoArr.u3dArr])},t}();a.Wmy_Load_Mag=o},{"./WmyUtils":4,"./d3/WmyLoad3d":6,"./d3/WmyLoadMats":7}],6:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=function(){function t(){this._mArr=[],this._mNum=0,this._mP=0,this._mP2=0}return Object.defineProperty(t,"getThis",{get:function(){return null==t._this&&(t._this=new t),t._this},enumerable:!0,configurable:!0}),t.prototype.onload3d=function(t,e,a){var r=this,n=[];this._callbackOk=e,this._callbackProgress=a;for(var i=0;i<t.length;i++){var o=t[i];o=Laya.ResourceVersion.addVersionPrefix(o),n.push(o)}var s=0;Laya.loader.create(n,new Laya.Handler(null,function(){null!=r._callbackOk&&r._callbackOk.run()}),Laya.Handler.create(null,function(t){(s+=.01)>1&&(s=1),null!=r._callbackProgress&&r._callbackProgress.runWith([s])},null,!1))},t.prototype.__onlsUrlArrOk=function(t){for(o=0;o<t.length;o++){var e=t[o].url,a=e.split("/"),r=e.replace(a[a.length-1],""),n=Laya.loader.getRes(e),i=JSON.parse(n);this.__tiQuUrl(i.data,r)}for(var o=0;o<this._mArr.length;o++)e=this._mArr[o],Laya.loader.create(e,Laya.Handler.create(this,this.__onArrOk),Laya.Handler.create(this,this.__onArrP))},t.prototype.__onArrP=function(t){(e=t*(this._mNum+1))>this._mP&&(this._mP=e),this._mP2=this._mP/this._mArr.length;var e=.98*this._mP2;null!=this._callbackProgress&&this._callbackProgress.runWith([e])},t.prototype.__onArrOk=function(){var t=this;this._mNum+=1,this._mNum>=this._mArr.length&&Laya.loader.create(this._urlList,Laya.Handler.create(this,function(){null!=t._callbackOk&&t._callbackOk.run()}))},t.prototype.__tiQuUrl=function(t,e){if(void 0===e&&(e=""),null!=t.props&&null!=t.props.meshPath){var a=e+t.props.meshPath;this._mArr.indexOf(a)<0&&this._mArr.push(a);var r=t.props.materials;if(null!=r)for(var n=0;n<r.length;n++){var i=e+r[n].path;this._mArr.indexOf(i)<0&&this._mArr.push(i)}}if(null!=t.components){var o=t.components;if(o.length>0)for(var s=0;s<o.length;s++){var l=o[s];if(null!=l.avatar){var u=e+l.avatar.path;this._mArr.indexOf(u)<0&&this._mArr.push(u)}if(null!=l.layers)for(var h=l.layers,d=0;d<h.length;d++)for(var c=h[d].states,f=0;f<c.length;f++){var _=e+c[f].clipPath;this._mArr.indexOf(_)<0&&this._mArr.push(_)}}}var y=t.child;if(null!=y&&y.length>0)for(var g=0;g<y.length;g++)this.__tiQuUrl(y[g],e)},t}();a.WmyLoad3d=r},{}],7:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=function(){function t(){this._matsUrlArr=[],this._matOk=!1,this._matNum=0,this._matP=0,this._matP2=0}return Object.defineProperty(t,"getThis",{get:function(){return null==t._this&&(t._this=new t),t._this},enumerable:!0,configurable:!0}),t.prototype.onload3d=function(t,e,a){this._callbackOk=e,this._callbackProgress=a,Laya.loader.load(t,Laya.Handler.create(this,this.__onUrlArrOk,[t]))},t.prototype.__onUrlArrOk=function(t){for(u=0;u<t.length;u++){var e=t[u],a=Laya.loader.getRes(e),r=e.split("/"),n=e.replace(r[r.length-1],""),i=[];try{i=a.mats}catch(t){}for(var o=0;o<i.length;o++){var s=i[o];if(""!=s.targetName){var l=n+s.matUrl;this._matsUrlArr.push(l)}}}for(var u=0;u<this._matsUrlArr.length;u++)e=this._matsUrlArr[u],Laya.loader.create(e,Laya.Handler.create(this,this.__onMatArrOk),Laya.Handler.create(this,this.__onMatArrP))},t.prototype.__onMatArrP=function(t){var e=t*(this._matNum+1);e>this._matP&&(this._matP=e),this._matP2=this._matP/this._matsUrlArr.length,null!=this._callbackProgress&&this._callbackProgress.runWith([this._matP2])},t.prototype.__onMatArrOk=function(){this._matNum+=1,this._matNum>=this._matsUrlArr.length&&null!=this._callbackOk&&this._callbackOk.run()},t}();a.WmyLoadMats=r},{}],8:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=function(){function t(){}return t.setShader=function(t,e,a,r,n){void 0===r&&(r=!1);var i,o;if(t instanceof Laya.SkinnedMeshSprite3D){if(null==(i=t.skinnedMeshRenderer))return;o=i.sharedMaterial}else{if(null==(i=t.meshRenderer))return;o=i.sharedMaterial}r&&(o=o.clone(),i.sharedMaterial=o);for(var s in e)try{o[s]=e[s]}catch(t){}return Laya.loader.load(a,Laya.Handler.create(this,this.shaderConmplete,[o,n])),o},t.shaderConmplete=function(t,e,a){if(null!=a){var r=null;try{r=Laya.Utils.parseXMLFromString(a)}catch(t){return}var n,i,o,s,l,u,h=r.documentElement,d=this.getAttributesValue(h,"name"),c={},f=this.getNode(h,"attributeMap"),_=this.getNodeArr(f,"data");for(n=0;n<_.length;n++)i=_[n],o=this.getAttributesValue(i,"name"),s=this.getAttributesValue(i,"v0"),c[o]=this.getV(s,"int");var y={},g=this.getNode(h,"uniformMap"),p=this.getNodeArr(g,"data"),L=t.wmyValues;if(null!=L&&null!=L.cube){var v=L.cube;null!=e&&null!=e.cubeFun&&e.cubeFun(t,v)}for(n=0;n<p.length;n++){u=null,i=p[n],o=this.getAttributesValue(i,"name"),s=this.getAttributesValue(i,"v0"),l=this.getAttributesValue(i,"v1");var m=[];if(m[0]=this.getV(s,"int"),m[1]=this.getV(l,"int"),y[o]=m,null!=L&&(u=L[o]),null!=u)if(4==(u=u.split(",")).length)t._shaderValues.setVector(m[0],new Laya.Vector4(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])));else if(3==u.length)t._shaderValues.setVector(m[0],new Laya.Vector3(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])));else if(2==u.length)t._shaderValues.setVector(m[0],new Laya.Vector2(parseFloat(u[0]),parseFloat(u[1])));else if(1==u.length)if(isNaN(parseFloat(u[0]))){if("tex"==u[0]+""){var A=t[o];t._shaderValues.setTexture(m[0],A)}}else t._shaderValues.setNumber(m[0],parseFloat(u[0]))}var b=Laya.SkinnedMeshSprite3D.shaderDefines,O=Laya.BlinnPhongMaterial.shaderDefines;null!=e&&(null!=e.spriteDefines&&(b=e.spriteDefines),null!=e.materialDefines&&(O=e.materialDefines));var w=Laya.Shader3D.add(d,c,y,b,O),M=this.getNode(h,"SubShader"),P=this.getNode(h,"renderMode");if(null!=P){var k=this.getAttributesValue(P,"v");null!=k&&(t.renderMode=this.getV(k))}var R=this.getNodeArr(M,"Pass");for(n=0;n<R.length;n++){var S=R[n],U=this.getNode(S,"VERTEX").textContent;U=U.replace(/(\r)/g,"");var C=this.getNode(S,"FRAGMENT").textContent;if(C=C.replace(/(\r)/g,""),n>0){var x=t.getRenderState(0).clone();t._renderStates.push(x)}var T=this.getNode(S,"cull");if(null!=T){var D=this.getAttributesValue(T,"v");null==D&&""==D||(t.getRenderState(n).cull=this.getV(D))}w.addShaderPass(U,C)}t._shader=w}},t.getV=function(t,e){void 0===e&&(e="null");var a,r,n;for("Laya"===(a=t.split("."))[0]?r=Laya:"laya"===a[0]&&(r=laya),n=1;n<a.length;n++)r=r[a[n]];return null!=r?r:"null"!=e?"int"==e?parseInt(t):t:null},t.colorStringToUint=function(t){return Number("0x"+t.replace("#",""))},t.getAttributesValue=function(t,e){for(var a=null,r=t.attributes,n=0;n<r.length;n++){var i=r[n];if(i.name==e){a=i.nodeValue;break}}return a},t.getNode=function(t,e){for(var a=t.childNodes,r=null,n=0;n<a.length;n++){var i=a[n];if(i.nodeName==e){r=i;break}}return r},t.getNodeArr=function(t,e){for(var a=t.childNodes,r=[],n=0;n<a.length;n++){var i=a[n];i.nodeName==e&&r.push(i)}return r},t}();a.WmyShaderMsg=r},{}],9:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=t("../Wmy_Load_Mag"),n=t("./WmyShaderMsg"),i=function(){function t(){}return t.getObj3d=function(t,e){if(null==t)return null;if(t.name==e)return t;for(var a=0;a<t._children.length;a++){var r=t._children[a];if(r._children.length<=0){if(r.name==e)return r}else{var n=this.getObj3d(r,e);if(null!=n)return n}}return null},t.getChildrenComponent=function(t,e,a){if(null==t)return null;null==a&&(a=[]);var r=t.getComponent(e);null==r&&t instanceof e&&(r=t),null!=r&&a.push(r);for(var n=0;n<t._children.length;n++){var i=t._children[n];this.getChildrenComponent(i,e,a)}return a},t.setShaderAll=function(e,a,i){var o=this,s=a+"wmyMats.json",l=i;Laya.loader.load(s,Laya.Handler.create(this,function(a,i,l){if(null!=l)for(var u=l.mats,h=0;h<u.length;h++){var d=u[h];if(""!=d.targetName){var c=t.getObj3d(e,d.targetName);if(null!=c){var f=a+d.matUrl,_=i+d.shaderName+".txt";Laya.BaseMaterial.load(f,Laya.Handler.create(o,function(t,e,a){var i={};i.cubeFun=function(t,e){r.Wmy_Load_Mag.getThis.getCube(e,new Laya.Handler(o,function(e,a){0==a&&t._shaderValues.setTexture(Laya.Scene3D.REFLECTIONTEXTURE,e)}))},n.WmyShaderMsg.setShader(t,a,e,!1,i),null!=t&&null!=t.parent&&t.parent.removeChild(t)},[c,_]))}}}else console.warn("wmyMats-出错:",s)},[a,l]),null,Laya.Loader.JSON)},t.aniPlay=function(t,e,a){var r=this.getObj3d(t,e).getComponent(Laya.Animator);return r.play(a),r},t.onShadow=function(t,e,a,r,n){void 0===e&&(e=512),void 0===a&&(a=1),void 0===r&&(r=100),void 0===n&&(n=!0),t.shadow=n,t.shadowDistance=r,t.shadowResolution=e,t.shadowPCFType=a},t.onCastShadow=function(t,e,a,r){if(void 0===e&&(e=0),void 0===a&&(a=!0),void 0===r&&(r=!0),t instanceof Laya.MeshSprite3D){var n=t;0==e?n.meshRenderer.receiveShadow=a:1==e?n.meshRenderer.castShadow=a:2==e&&(n.meshRenderer.receiveShadow=a,n.meshRenderer.castShadow=a)}if(t instanceof Laya.SkinnedMeshSprite3D){var i=t;0==e?i.skinnedMeshRenderer.receiveShadow=a:1==e&&(i.skinnedMeshRenderer.castShadow=a)}if(r)for(var o=0;o<t.numChildren;o++){var s=t.getChildAt(o);this.onCastShadow(s,e,a)}},t.rgb2hex=function(t,e,a){return("#"+this.hex(t)+this.hex(e)+this.hex(a)).toUpperCase()},t.hex=function(t){return t=this.onNumTo(t),("0"+parseInt(t).toString(16)).slice(-2)},t.onNumTo=function(t){return(t+"").indexOf(".")>=0&&(t=parseFloat(t.toFixed(2))),t},t.lerpF=function(t,e,a){return t+(e-t)*a},t}();a.WmyUtils3D=i},{"../Wmy_Load_Mag":5,"./WmyShaderMsg":8}]},{},[2]);